<!DOCTYPE html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="d3.js画地图项目总结">




  <meta name="keywords" content="d3">










  <link rel="alternate" href="/atom.xml" title="Tiankai's Blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1">



<link rel="canonical" href="http://www.tiankai.party/posts/17900/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1">



  
  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?661158ab1e0fccea66251d60f7dae96a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









<script>
  window.config = {"leancloud":{"app_id":"","app_key":""},"toc":true,"fancybox":true,"pjax":true};
</script>

    <title> d3.js画地图项目总结 - Tiankai's Blog </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Tiankai's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
      <a href="/comments">
        <li class="mobile-menu-item">
          
          
            留言板
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Tiankai's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/comments">
            
            
              留言板
            
          </a>
        </li>
      
    </ul>
  
</nav>
<a href="https://github.com/tiakia"><img style="position:fixed;top:0;right:0;" width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_red_aa0000.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>


      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          d3.js画地图项目总结
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
        2018-03-12
        </span>
        
          <span class="post-category">
            
              <a href="/categories/javascript/">javascript</a>
            
          </span>
        
        <span class="post-counts">
          Count: 2k 字
        </span>
        <span class="post-times">
          Time: 8 分钟
        </span>
        <!-- <span class="post-visits leancloud-visitors" -->
        <!--      data-url="/posts/17900/" -->
        <!--      data-title="d3.js画地图项目总结" -->
        <!--      id="/posts/17900/" -->
        <!--      data-flag-title="d3.js画地图项目总结"> -->
        <!--   阅读次数 0 -->
        <!--    <i class="leancloud-visitors-count"></i> -->
        <!-- </span> -->
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#项目背景"><span class="toc-text">项目背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#技术栈"><span class="toc-text">技术栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目历程"><span class="toc-text">项目历程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#拖拽"><span class="toc-text">拖拽</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#缩放"><span class="toc-text">缩放</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#地图"><span class="toc-text">地图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#几个关于-projection-和-path-的应用技巧"><span class="toc-text">几个关于 projection 和 path 的应用技巧</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#地图数据的获取"><span class="toc-text">地图数据的获取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#福利网站"><span class="toc-text">福利网站</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#路径增加运动点"><span class="toc-text">路径增加运动点</span></a></li></ol></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <p><img src="/../images/d3hangyou.png" alt="航油"></p>
<a id="more"></a>
<h3 id="项目背景"><a href="#项目背景" class="headerlink" title="项目背景"></a>项目背景</h3><p>需要展示中国地图和世界地图，并且在地图上标点，画线路图，然后需要点击效果。<br>地图需要有拖拽和缩放的功能。<br>展示的设备为 ipad 只需要适配一个固定的 pad 设备。</p>
<h3 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h3><p>d3/react</p>
<h3 id="项目历程"><a href="#项目历程" class="headerlink" title="项目历程"></a>项目历程</h3><p>项目刚开始只是先用<code>d3+jq</code>试验了一下，以前用 d3 做个树状图没做过地图，把基本的功能弄出来后，就找了个<code>react</code>的脚手架来开始使用<code>react</code>来开发，github 上找到一个 react-d3 但是遗憾的是没有地图的封装，然后就自己半 d3 半 react 的开始开发了。<br>开发的时候<code>svg</code>的知识很重要，遇到解决的难题多搜搜 svg 的相关知识。<br>记录一下开发过程遇到的坑，地图的数据是在网上找好的，开发过程中参考了一个大神的博客，包括地图的显示，标点，线路图，拖拽和缩放功能的实现。</p>
<h4 id="拖拽"><a href="#拖拽" class="headerlink" title="拖拽"></a>拖拽</h4><p>开发前期用时最长的就是拖拽的功能，地图的拖拽和<code>circle</code>、<code>rect</code>的拖拽不一样，他们有具体的坐标来规定显示的位置，而地图是生成的<code>path</code>，外层套一个<code>g</code>，你在调用<code>drag</code>事件的时候可以获取到鼠标当前的坐标，但是你给<code>g</code>设置了坐标不会起作用，所以选择了一个给外层的<code>g</code>设置<code>translate</code>，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dragListener = d3.behavior</span><br><span class="line">  .drag() <span class="comment">//开启拖拽行为</span></span><br><span class="line">  .on(<span class="string">"dragstart"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//开始拖拽</span></span><br><span class="line">    d3.event.sourceEvent.stopPropagation();</span><br><span class="line">  &#125;)</span><br><span class="line">  .on(<span class="string">"drag"</span>, dragmove); <span class="comment">//拖拽过程</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragmove</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">  (x = d3.event.x - startX), (y = d3.event.y - startY);</span><br><span class="line"></span><br><span class="line">  d3.select(<span class="keyword">this</span>).attr(<span class="string">"transform"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`translate(<span class="subst">$&#123;x&#125;</span>, <span class="subst">$&#123;y&#125;</span>)`</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一次做的时候是在拖动开始的时候，获取鼠标的位置设置给 <code>startX</code>, 然后在拖动过程中，获取当前鼠标的位置再减去开始位置，设置给外层的<code>g</code>,这样做的话在拖动开始的时候会有一个卡顿，这是因为你在拖动开始的时候，获取的坐标会有一个偏差，最终你获取到的坐标不是你最开始的时候想要获取的，解决方法就是监听鼠标按下事件，在鼠标按下的时候获取坐标，然后就可以了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g.attr(<span class="string">"transform"</span>, <span class="string">"translate(0,0)"</span>)</span><br><span class="line">  .on(<span class="string">"mousedown"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    startX = d3.mouse(<span class="keyword">this</span>)[<span class="number">0</span>];</span><br><span class="line">    startY = d3.mouse(<span class="keyword">this</span>)[<span class="number">1</span>];</span><br><span class="line">  &#125;)</span><br><span class="line">  .call(dragListener);</span><br></pre></td></tr></table></figure>
<p>在 pc 端可以了，但是在 pad 上的时候出现了问题，pad 上需要绑定触摸事件,后来找到了一个很棒的代替拖拽的事件，<code>zoom</code>缩放事件，自带拖拽功能，如果是整体拖拽的话缩放事件完全可以。</p>
<h4 id="缩放"><a href="#缩放" class="headerlink" title="缩放"></a>缩放</h4><p>缩放事件和拖拽差不多，在你开启缩放事件后，d3 会自动记录下你当前缩放的参数，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">translate_x = d3.event.transform.x;</span><br><span class="line">translate_y = d3.event.transform.y;</span><br><span class="line">scale_cur = d3.event.transform.k;</span><br><span class="line"><span class="comment">//设置拖拽的参数</span></span><br><span class="line">d3.select(<span class="string">".group"</span>).attr(</span><br><span class="line">  <span class="string">"transform"</span>,</span><br><span class="line">  <span class="string">`translate(<span class="subst">$&#123;translate_x&#125;</span>,<span class="subst">$&#123;translate_y&#125;</span>)scale(<span class="subst">$&#123;scale_cur&#125;</span>,<span class="subst">$&#123;scale_cur&#125;</span>)`</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>缩放事件还有一个<code>scaleExtent([1,10])</code>方法可以设置放到最大和最小的级别<br>完整的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zoom = d3</span><br><span class="line">  .zoom()</span><br><span class="line">  .scaleExtent([<span class="number">1</span>, <span class="number">10</span>])</span><br><span class="line">  .on(<span class="string">"zoom"</span>, () =&gt; &#123;</span><br><span class="line">    translate_x = d3.event.transform.x;</span><br><span class="line">    translate_y = d3.event.transform.y;</span><br><span class="line">    scale_cur = d3.event.transform.k;</span><br><span class="line">    d3.select(<span class="string">".group"</span>).attr(</span><br><span class="line">      <span class="string">"transform"</span>,</span><br><span class="line">      <span class="string">`translate(<span class="subst">$&#123;translate_x&#125;</span>,<span class="subst">$&#123;translate_y&#125;</span>)scale(<span class="subst">$&#123;scale_cur&#125;</span>,<span class="subst">$&#123;scale_cur&#125;</span>)`</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">d3.select(<span class="string">".rootSvg"</span>).call(zoom);</span><br></pre></td></tr></table></figure>
<p>关键的是最后调用的这个<code>zoom</code>的元素,调用 zoom 的元素不是包裹 path 的 g,而是最外层的 svg,这样缩放行为才能实现。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">"rootSvg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">g</span> <span class="attr">class</span>=<span class="string">"group"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>svg 比 canvas 方便的一点就是我可以用操作 dom 的方式来操作我画出来的图形，我还可以给我的图形加<code>class</code>，然后通过<code>class</code>来设置图形的显示</p>
<h3 id="地图"><a href="#地图" class="headerlink" title="地图"></a>地图</h3><p>d3.js 绘制地图需要用到它封装好的投影功能，项目中使用的墨卡托投影</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> projection = d3</span><br><span class="line">  .geoMercator() <span class="comment">//设置地图的二维投影</span></span><br><span class="line">  .center(center) <span class="comment">//设置地图的中心点</span></span><br><span class="line">  .scale(scale) <span class="comment">//设置地图的初始缩放级别</span></span><br><span class="line">  .translate([viewWidth / <span class="number">2</span>, viewHeight / <span class="number">2</span>]); <span class="comment">//设置地图平移距离</span></span><br><span class="line"><span class="keyword">const</span> path = d3</span><br><span class="line">  .geoPath() <span class="comment">//地理路径生成器</span></span><br><span class="line">  .projection(projection);</span><br></pre></td></tr></table></figure>
<h4 id="几个关于-projection-和-path-的应用技巧"><a href="#几个关于-projection-和-path-的应用技巧" class="headerlink" title="几个关于 projection 和 path 的应用技巧"></a>几个关于 projection 和 path 的应用技巧</h4><ul>
<li>projection 可以将地图的坐标 转换为像素坐标并且在地图上显示出来<br>利用这个可以在地图上渲染出点，添加图片或者显示文字都可以</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//d.cp是点坐标数组，经度在前，纬度在后</span></span><br><span class="line"><span class="comment">//经度转换为x坐标</span></span><br><span class="line">projection(d.cp)[<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
<ul>
<li>path 可以获取中心，也可以渲染 geoJson 数据直接渲染成 path 图形，比如说渲染出中国地图，部分代码如下<br>利用这个可以直接生成地理路径，</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">g.selectAll(<span class="string">"path"</span>)</span><br><span class="line">  .data(geoData) <span class="comment">//geoJson的数据</span></span><br><span class="line">  .enter() <span class="comment">//遍历所有数据</span></span><br><span class="line">  .append(<span class="string">"g"</span>) <span class="comment">//把所有的path都添加到这个g中</span></span><br><span class="line">  .attr(<span class="string">"class"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//设置g的class</span></span><br><span class="line">    <span class="keyword">return</span> d.properties.ename || d.properties.name;</span><br><span class="line">  &#125;)</span><br><span class="line">  .append(<span class="string">"path"</span>) <span class="comment">//在g中添加path</span></span><br><span class="line">  .attr(<span class="string">"stroke"</span>, <span class="string">"#858384"</span>) <span class="comment">//path描边</span></span><br><span class="line">  .attr(<span class="string">"stroke-dasharray"</span>, <span class="string">"5,5"</span>) <span class="comment">//path描虚线</span></span><br><span class="line">  .attr(<span class="string">"stroke-width"</span>, <span class="number">1</span>) <span class="comment">//path描边的宽度</span></span><br><span class="line">  .attr(<span class="string">"fill"</span>, fillColor) <span class="comment">//path填充的颜色 各个省份的填充颜色 可以通过class设置 fill</span></span><br><span class="line">  .attr(<span class="string">"fill-opacity"</span>, <span class="string">".8"</span>)</span><br><span class="line">  .attr(<span class="string">"d"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> path(d); <span class="comment">//通过path函数直接渲染出路径图形来 d必须是geoJson格式的数据</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="keyword">if</span> (fillColor == <span class="string">"none"</span>) &#123;</span><br><span class="line">  g.append(<span class="string">"g"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"townName"</span>)</span><br><span class="line">    .selectAll(<span class="string">"text"</span>)</span><br><span class="line">    .data(geoData)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"transform"</span>, d =&gt; &#123;</span><br><span class="line">      <span class="comment">//path.centroid(d)可以获取路经的中心点，比如说获取山西省的中心点，然后把text平移到中心点，显示省份名称</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">`translate(<span class="subst">$&#123;path.centroid(d)[<span class="number">0</span>]&#125;</span>,<span class="subst">$&#123;path.centroid(d)[<span class="number">1</span>]&#125;</span>)`</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .text(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (d.properties.ename == <span class="string">"taiwan"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="regexp">/[区,县]/g</span>.test(d.properties.name)) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.properties.name;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">"font-size"</span>, <span class="string">"10px"</span>)</span><br><span class="line">    .attr(<span class="string">"fill"</span>, <span class="string">"#A9A9A9"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>渲染出地图来了，然后说一下地图的数据</p>
<h3 id="地图数据的获取"><a href="#地图数据的获取" class="headerlink" title="地图数据的获取"></a>地图数据的获取</h3><p>这里有俩种数据格式，<code>geoJson</code>和<code>topoJson</code>的数据格式,topoJson 的数据小，但是需要引入<code>import * as topojson from &#39;topojson&#39;;</code>然后在渲染的时候调用 topojson 提供的方法把 topojson 格式的数据转换成 geojson 的数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//china_top.json 是由 china_geo.json 文件转换成的 topojson</span></span><br><span class="line">chinaData = <span class="built_in">require</span>(<span class="string">"./../data/common/china_top.json"</span>);</span><br><span class="line"><span class="comment">//在使用数据前需要转换成 geoJson 格式的数据 进行渲染</span></span><br><span class="line">geoData = topojson.feature(chinaData, chinaData.objects.china_geo).features;</span><br></pre></td></tr></table></figure>
<h4 id="福利网站"><a href="#福利网站" class="headerlink" title="福利网站"></a>福利网站</h4><p><a href="http://mapshaper.org/" target="_blank" rel="noopener">geoJson 和 topojson 数据转换</a> GeoJson 和 topojson 数据的转换<br><a href="https://geojson-maps.ash.ms/" target="_blank" rel="noopener">geoJson 地图数据的获取</a> 这个网站可以获取到地图的 geojson 数据<br><a href="http://geojson.io/#map=2/20.0/0.0" target="_blank" rel="noopener">地图上线路图和国家名称数据的制作</a> 如果中国地图划分了大区显示，需要显示大区名称，或者需要在地图上显示从太原到北京的路线图，真心推荐这个网站，你可以在地图上画线 标点，然后 网站会给你自动生成数据，再然后你就可以开心通过<code>path(d)</code>渲染出来了，不用再苦逼的去找坐标点。<br><img src="/../images/d3oliSource.png" alt="来油方式路线图"><br>项目中最开心的事情就是用 nodejs 做各种处理数据的事情了，各种操作，然后在生成一个新的文件，过程简直爽的不要不要的，比如说我拿到的是中国各个省份的数据，我需要把各个省份的数据合并到一起，并且还需要给各个县市加上省份的名称，用 nodejs 只需要写写逻辑，运行一下代码，就可以拿到自己想要的数据。</p>
<h4 id="路径增加运动点"><a href="#路径增加运动点" class="headerlink" title="路径增加运动点"></a>路径增加运动点</h4><p>这里就需要用到 svg 的一个运动图标的知识了<code>animateMotion</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">circle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">animateMotion</span> <span class="attr">dur</span>=<span class="string">"3s"</span> <span class="attr">repeatCount</span>=<span class="string">"indefinite"</span> <span class="attr">rotate</span>=<span class="string">"auto"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mpath</span> <span class="attr">href</span>=<span class="string">"pathId"</span>&gt;</span><span class="tag">&lt;/<span class="name">mpath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">animationMotion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>外层可以是 circle 也可以是 图片 是运动的图标</li>
<li>animateMotion 属性 dur 运动的时间<br>repeatCount 重复次数<br>rotate 运动时 外层运动图标的朝向</li>
<li>mpath 这个元素的 href 属性放置的是路径 path 的 id<br>如果有一个已经定义好的 path，那么外层的 circle 就会沿着这个 path 运动</li>
</ul>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>文章标题: </span>
      <a href="http://www.tiankai.party/posts/17900/">d3.js画地图项目总结</a>
    </p>
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="http://www.tiankai.party">tiankai</a>
    </p>
    <p class="copyright-item">
      <span>发表时间: </span>
      <span>
        2018-03-12, 11:03:00
      </span>
    </p>
    <p class="copyright-item">
      <span>最后更新: </span>
      <span>
        2019-07-04, 15:07:28
      </span>
    </p>

    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="http://www.tiankai.party/posts/17900/">http://www.tiankai.party/posts/17900/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>


      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden>
    <label class="reward-button" for="reward">赞赏支持</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/imgs/wechat.jpg" title="wechat">
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/imgs/ali.jpg" title="alipay">
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/js/">js</a>
            
              <a href="/tags/d3/">d3</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/posts/43983/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">js原型链新理解</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/posts/3341/">
        <span class="next-text nav-default">Http请求之预检请求</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
    <div id="gitalk-container"></div>
    
  </div>
  

        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:tiankai0426@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/tiakia" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">tiankai</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  
  
  <script>
     (function() {
         function render() {
             new Gitalk({
                 clientID: "d45abc7a6db571b50af9",
                 clientSecret: "15ab54f8f528045cdf07d8dbb2d4c0faa69f9462",
                 owner: 'tiakia',
                 repo: 'tiakiaBlogComment',
                 admin: ['tiakia'],
                 id: decodeURI(location.pathname)
             }).render('gitalk-container')
         }
         var gc = document.createElement('script');
         gc.type = 'text/javascript';
         gc.src = '//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js';
         gc.charset = 'UTF-8';
         gc.onload = render;
         gc.async = true;
         document.querySelector('body').appendChild(gc);
         var gcs = document.createElement('link');
         gcs.href = '//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css';
         gcs.type = 'text/css';
         gcs.rel = 'stylesheet';
         gcs.media = 'screen,print';
         document.querySelector('head').appendChild(gcs);
     })();
    </script>

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
