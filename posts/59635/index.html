<!DOCTYPE html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="umi+dva的使用">




  <meta name="keywords" content="umi,dva">










  <link rel="alternate" href="/atom.xml" title="Tiankai's Blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1">



<link rel="canonical" href="http://www.tiankai.party/posts/59635/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1">



  
  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?661158ab1e0fccea66251d60f7dae96a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>





  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "APUSn00FXLoznLkguOHkVcM5-gzGzoHsz",
      appKey: "CgbpSHg5AJ62DOSsKHts1uph"
    });
  </script>





<script>
  window.config = {"leancloud":{"app_id":"APUSn00FXLoznLkguOHkVcM5-gzGzoHsz","app_key":"CgbpSHg5AJ62DOSsKHts1uph"},"toc":true,"fancybox":true,"pjax":true};
</script>

    <title> umi+dva的使用 - Tiankai's Blog </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Tiankai's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
      <a href="/comments">
        <li class="mobile-menu-item">
          
          
            留言板
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Tiankai's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/comments">
            
            
              留言板
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          umi+dva的使用
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-11-15
        </span>
        
          <span class="post-category">
            
              <a href="/categories/javascript/">javascript</a>
            
          </span>
        
        <span class="post-visits">
          1.3k 字
        </span>
        <span class="post-visits">
          5 分钟
        </span>
        
        <span class="post-visits" data-url="/posts/59635/" data-title="umi+dva的使用">
          阅读次数 0
        </span>
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#dva"><span class="toc-text">dva</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#umi"><span class="toc-text">umi</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#webapck-chain配置"><span class="toc-text">webapck-chain配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#umi-和-dva-架构对比"><span class="toc-text">umi 和 dva 架构对比</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <p><code>umi</code>和<code>dva</code>都是阿里出的简化<code>react</code>开发的架构，以前都是直接开发的没使用这套，后来接触下来以后发现，开发感觉挺舒适的，刚开始使用的<code>dva</code>，有一个缺陷就是基于<code>roadhog</code>搭建的<code>webpack</code>架子，给我们自定义的接口实在有限,后来<code>umi</code>加入了<code>webpack-chain</code>可以自己添加、修改<code>webpack</code>的配置，值得一试。</p>
<a id="more"></a>
<p><code>umi+dva</code> 的架构中，<code>dva</code>被当成了数据流，集合了<code>redux</code>/<code>redux-saga</code>，处理异步操作,而且还有个方便的是集合了<code>dva-loading</code>这个插件，不用我们去手动的写<code>loading</code>状态的<code>show/hide</code>了</p>
<h3 id="dva"><a href="#dva" class="headerlink" title="dva"></a>dva</h3><p><code>dva</code> 首先是一个基于 <code>redux</code> 和 <code>redux-saga</code> 的数据流方案，然后为了简化开发体验，<code>dva</code> 还额外内置了 <code>react-router</code> 和 <code>fetch</code>，所以也可以理解为一个轻量级的应用框架。<br>我们只是用他集合<code>redux</code>和<code>redux-saga</code>的部分，其他的我们使用<code>umi</code>的就行，<code>dva</code> 将文件分为了<code>model</code>、<code>services</code>，<code>model</code>文件夹下建立的就是我们的 <code>redux</code> 文件，<code>services</code>下建立的是我们的<code>api</code>接口，我们看一下<code>dva</code>的<code>model</code>文件</p>
<figure class="highlight javascript"><figcaption><span>models/login.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; queryLogin &#125; <span class="keyword">from</span> <span class="string">"../services/login"</span>; <span class="comment">//导入loginService API 接口</span></span><br><span class="line"><span class="keyword">import</span> &#123; Toast &#125; <span class="keyword">from</span> <span class="string">"antd-mobile"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// namespace 用来标识reducer文件，connect的时候使用</span></span><br><span class="line">  <span class="comment">// 类似redux整合所有reducer文件中的key值</span></span><br><span class="line">  namespace: <span class="string">"login"</span>,</span><br><span class="line"></span><br><span class="line">  state: &#123;</span><br><span class="line">    <span class="comment">//相当于redux的InitialState</span></span><br><span class="line">    login: <span class="string">""</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  subscriptions: &#123;</span><br><span class="line">    <span class="comment">//可以在这里进行监听</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//这里进行的就是异步操作了，集成了 redux-saga</span></span><br><span class="line">  effects: &#123;</span><br><span class="line">    *fetch(&#123; payload, callback &#125;, &#123; call, put &#125;) &#123;</span><br><span class="line">      <span class="comment">// eslint-disable-line</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">yield</span> call(queryLogin, payload);</span><br><span class="line">        <span class="keyword">if</span> (response.code === <span class="string">"0000"</span>) &#123;</span><br><span class="line">          <span class="keyword">yield</span> put(&#123; <span class="attr">type</span>: <span class="string">"save"</span>, <span class="attr">payload</span>: response.data &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> errorObj = <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">          errorObj.msg = response.data.msg;</span><br><span class="line">          <span class="keyword">throw</span> errorObj;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Error</span>(e));</span><br><span class="line">        Toast.fail(e.msg || <span class="string">"登录请求失败，请重试"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// redux的 reducer 函数</span></span><br><span class="line">  reducers: &#123;</span><br><span class="line">    save(state, action) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, ...action.payload &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在组件中使用<code>dva</code>的<code>model</code>,只显示主要代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">  login = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; dispatch, form &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    form.validateFields(<span class="keyword">async</span> (err, fieldsValues) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123; phone, password &#125; = fieldsValues;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> handleError(err, fieldsValues);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> dispatch(&#123;</span><br><span class="line">          type: <span class="string">"login/fetch"</span>,</span><br><span class="line">          payload: &#123;</span><br><span class="line">            user_no: phone,</span><br><span class="line">            user_pass: password</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      loading: &#123; effects &#125;</span><br><span class="line">    &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        ...</span><br><span class="line">        &lt;WingBlank className=&#123;styles.logbox&#125;&gt;</span><br><span class="line">          &lt;Button</span><br><span class="line">            type=<span class="string">"primary"</span></span><br><span class="line">            className=&#123;styles.login&#125;</span><br><span class="line">            onClick=&#123;() =&gt; &#123;</span><br><span class="line">              <span class="keyword">this</span>.login();</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            登录</span><br><span class="line">          &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>WingBlank&gt;</span><br><span class="line">        &lt;ActivityIndicator</span><br><span class="line">          toast</span><br><span class="line">          text=<span class="string">"登录中..."</span></span><br><span class="line">          animating=&#123;effects[<span class="string">"login/fetch"</span>] || <span class="literal">false</span>&#125;</span><br><span class="line">        /&gt;&#123;<span class="string">" "</span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect((&#123; login, loading &#125;) =&gt; (&#123;</span></span><br><span class="line"><span class="regexp">  login,</span></span><br><span class="line"><span class="regexp">  loading</span></span><br><span class="line"><span class="regexp">&#125;))(createForm()(Login));</span></span><br></pre></td></tr></table></figure>
<ul>
<li>首先和<code>redux</code>一样我们需要<code>connect</code>组件注入你需要使用的<code>model</code>这里我们注入了<code>login</code>和<code>loading</code></li>
<li>在<code>connect</code>注入了<code>login</code>模块后，点击登录时，会调用 <code>login/fetch</code>的异步操作（调用 loginModels 下面的 fetch 方法），如此完成一次完整的流程操作</li>
<li>这个组件中我们可以看到<code>dva-loading</code>的使用，用户在点击登录后会调用<code>login</code>中的<code>fetch</code>异步操作，在<code>dva-loading</code>中就会自动监听这个 effects 直到他完成，我们就可以直接判断<code>effects[loing/fetch]</code>来监听这个异步操作是否完成，十分的方便</li>
</ul>
<h3 id="umi"><a href="#umi" class="headerlink" title="umi"></a>umi</h3><p>对与<code>umi</code>来说，最大的优势就是采用了 <code>next.js</code> 的约定式路由，文件目录即路由， 省却了我们自己去配置路由了，对与之前我们的路由这样的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> RouteConfig = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/"</span>,</span><br><span class="line">    component: Index,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/home"</span>,</span><br><span class="line">    component: Home,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/home/detail"</span>,</span><br><span class="line">    component: NoticeDetail,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/home/card"</span>,</span><br><span class="line">    component: CardListDetail,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/news"</span>,</span><br><span class="line">    component: NewScheduleList,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/type/:type"</span>, <span class="comment">//重点关注这，umi处理动态路由</span></span><br><span class="line">    component: TypeList,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>而现在我们只需要在<code>page</code>文件夹下创建相应的文件就可以了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+ pages/</span><br><span class="line">  + home/</span><br><span class="line">    - index.js <span class="comment"># Home.js</span></span><br><span class="line">    + detail/</span><br><span class="line">      - index.js <span class="comment"># NoticeDetail.js</span></span><br><span class="line">    + card/</span><br><span class="line">      - index.js <span class="comment"># CardListDetail.js</span></span><br><span class="line">  + news/</span><br><span class="line">     - index.js <span class="comment"># NewScheduleList.js</span></span><br><span class="line">  + <span class="built_in">type</span>/</span><br><span class="line">    - <span class="variable">$type</span>.js <span class="comment"># TypeList.js 文件名加$标识是个动态路由</span></span><br><span class="line">  - index.js <span class="comment"># Index.js</span></span><br></pre></td></tr></table></figure>
<p>其他具体的路由约定规则，可以参考<a href="https://umijs.org/zh/guide/router.html#%E7%BA%A6%E5%AE%9A%E5%BC%8F%E8%B7%AF%E7%94%B1" target="_blank" rel="noopener">umi 官网</a></p>
<h4 id="webapck-chain配置"><a href="#webapck-chain配置" class="headerlink" title="webapck-chain配置"></a><code>webapck-chain</code>配置</h4><p>umi 最大的优点我觉得就是加入了<code>webapck-chain</code>可以自己扩展<code>webpack</code>配置，配置的地方在根目录的<code>config.js</code>或者<code>.umirc.js</code><br>具体的配置如下：</p>
<figure class="highlight javascript"><figcaption><span>.umirc.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ref: https://umijs.org/config/</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">"path"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// ref: https://umijs.org/plugin/umi-plugin-react.html</span></span><br><span class="line">    [</span><br><span class="line">      <span class="string">"umi-plugin-react"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        antd: <span class="literal">true</span>,</span><br><span class="line">        dva: &#123;</span><br><span class="line">          immer: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        title: <span class="string">"answers-mobile"</span>,</span><br><span class="line">        dll: <span class="literal">true</span>,</span><br><span class="line">        routes: &#123;</span><br><span class="line">          exclude: []</span><br><span class="line">        &#125;,</span><br><span class="line">        hardSource: <span class="literal">true</span>,</span><br><span class="line">        fastClick: <span class="literal">true</span>,</span><br><span class="line">        library: <span class="string">"react"</span>,</span><br><span class="line">        dynamicImport: &#123;</span><br><span class="line">          loadingComponent: <span class="string">"./components/Loading.js"</span>,</span><br><span class="line">          webpackChunkName: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  theme: &#123;&#125;,</span><br><span class="line">  alias: &#123;</span><br><span class="line">    src: path.resolve(__dirname, <span class="string">"src"</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//添加 webpack-bundle-analyzer 插件</span></span><br><span class="line">  <span class="comment">//更多的添加方式请查看 webpack-chain</span></span><br><span class="line">  chainWebpack(config, &#123; webpack &#125;) &#123;</span><br><span class="line">    config.merge(&#123;</span><br><span class="line">      plugin: &#123;</span><br><span class="line">        bundleAnalyzer: &#123;</span><br><span class="line">          plugin: <span class="built_in">require</span>(<span class="string">"webpack-bundle-analyzer"</span>).BundleAnalyzerPlugin,</span><br><span class="line">          args: [&#123; <span class="attr">analyzerPort</span>: <span class="number">9999</span> &#125;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="umi-和-dva-架构对比"><a href="#umi-和-dva-架构对比" class="headerlink" title="umi 和 dva 架构对比"></a>umi 和 dva 架构对比</h3><p>dva 项目之前通常都是这种扁平的组织方式，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ models</span><br><span class="line">  - global.js</span><br><span class="line">  - a1.js</span><br><span class="line">  - a2.js</span><br><span class="line">  - b.js</span><br><span class="line">+ services</span><br><span class="line">  - a.js</span><br><span class="line">  - b.js</span><br><span class="line">+ routes</span><br><span class="line">  - PageA.js</span><br><span class="line">  - PageB.js</span><br></pre></td></tr></table></figure>
<p>用了 umi 后，可以按页面维度进行组织，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ models/global.js</span><br><span class="line">+ pages</span><br><span class="line">  + a</span><br><span class="line">    - index.js</span><br><span class="line">    + models</span><br><span class="line">      - a1.js</span><br><span class="line">      - a2.js</span><br><span class="line">    + services</span><br><span class="line">      - a.js</span><br><span class="line">  + b</span><br><span class="line">    - index.js</span><br><span class="line">    - model.js</span><br><span class="line">    - service.js</span><br></pre></td></tr></table></figure>
<p>好处是更加结构更加清晰了，减少耦合，一删全删，方便 copy 和共享。</p>
<blockquote>
<p>参考链接</p>
</blockquote>
<p><a href="https://dvajs.com/guide/" target="_blank" rel="noopener">dva 官网</a><br><a href="https://umijs.org/zh/config/#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">umi 配置</a><br><a href="https://github.com/sorrycc/blog/issues/66" target="_blank" rel="noopener">umi 和 dva 更配</a><br><a href="https://github.com/neutrinojs/webpack-chain" target="_blank" rel="noopener">webpack-chain</a></p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="http://www.tiankai.party">tiankai</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="http://www.tiankai.party/posts/59635/">http://www.tiankai.party/posts/59635/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>

      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden>
    <label class="reward-button" for="reward">赞赏支持</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/imgs/wechat.jpg" title="wechat">
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/imgs/ali.jpg" title="alipay">
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/umi/">umi</a>
            
              <a href="/tags/dva/">dva</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/posts/23140/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">nvmw管理node版本排坑</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/posts/37168/">
        <span class="next-text nav-default">js中的事件执行机制</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
    <div id="gitalk-container"></div>
    
  </div>
  

        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:tiankai0426@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/tiakia" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">tiankai</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  
  
  <script>
     (function() {
         function render() {
             new Gitalk({
                 clientID: "d45abc7a6db571b50af9",
                 clientSecret: "15ab54f8f528045cdf07d8dbb2d4c0faa69f9462",
                 owner: 'tiakia',
                 repo: 'tiakiaBlogComment',
                 admin: ['tiakia'],
                 id: decodeURI(location.pathname)
             }).render('gitalk-container')
         }
         var gc = document.createElement('script');
         gc.type = 'text/javascript';
         gc.src = '//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js';
         gc.charset = 'UTF-8';
         gc.onload = render;
         gc.async = true;
         document.querySelector('body').appendChild(gc);
         var gcs = document.createElement('link');
         gcs.href = '//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css';
         gcs.type = 'text/css';
         gcs.rel = 'stylesheet';
         gcs.media = 'screen,print';
         document.querySelector('head').appendChild(gcs);
     })();
    </script>

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
