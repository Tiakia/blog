<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tiankai&#39;s Blog</title>
  
  <subtitle>或碌碌无为,或轰轰烈烈</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.tiankai.party/"/>
  <updated>2019-02-05T12:40:12.372Z</updated>
  <id>http://www.tiankai.party/</id>
  
  <author>
    <name>tiankai</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>前端导出Excel文件</title>
    <link href="http://www.tiankai.party/posts/4824/"/>
    <id>http://www.tiankai.party/posts/4824/</id>
    <published>2019-01-30T06:53:30.000Z</published>
    <updated>2019-02-05T12:40:12.372Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在做项目的过程中遇到一个需求，需要把前端页面的表格导出到本地生成<code>Excel</code>文件，一直以为需要靠后端的协助，后来发现了一个非常棒的工具库<code>js-xlsx</code>，可以在不依靠后端的情况下，前端自己来生成<code>Excel</code>文件，后端只要返回前端表格需要的数据就可以，不需要在进行一次请求，在这里记录一下这个库的使用过程。</p><a id="more"></a><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install xlsx</span><br></pre></td></tr></table></figure><p><code>js-xlsx</code>库很强大，既能导出 EXCEL 文件，也可以将数据导出为 EXCEL，就是官方文档不太友好，这里推荐阅读文末的参考链接</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlsx <span class="keyword">from</span> <span class="string">"xlsx"</span>;</span><br></pre></td></tr></table></figure><h4 id="xlsx-utils"><a href="#xlsx-utils" class="headerlink" title="xlsx.utils"></a>xlsx.utils</h4><p><code>xlsx.utils</code>提供的工具函数</p><ul><li><code>json_to_sheet</code>: 把一个 JSON 数据转换为<code>sheet</code>数据</li><li><code>table_to_sheet</code>: 把表格 DOM 元素转换成可导出的<code>sheet</code>数据</li><li><code>aoa_to_sheet</code>: 这个工具类最强大也最实用了，将一个二维数组转成 <code>sheet</code>，会自动处理 <code>number</code>、<code>string</code>、<code>boolean</code>、<code>date</code> 等类型数据；</li><li><code>sheet_add_aoa</code>: 将一个二维数组添加到已经存在的工作表中</li><li><code>sheet_add_json</code>: 将 JSON 数据添加到已经存在的工作表中</li></ul><p>后俩种很少用到，本文的实例中使用的是<code>json_to_sheet</code>，同样的还有将表格文件导出为数据的，<code>sheet_to_json</code>/<code>sheet_to_csv</code>/<code>sheet_to_txt</code>/<code>sheet_to_html</code>/<code>sheet_to_formulae</code>这些见名知意，就不详细的描述了</p><h4 id="xlsx-read-读取表格"><a href="#xlsx-read-读取表格" class="headerlink" title="xlsx.read 读取表格"></a><code>xlsx.read</code> 读取表格</h4><p><code>xlsx.read(data,{type:type})</code>,返回一个叫 WorkBook 的对象，type 主要取值如下：</p><blockquote><ul><li><code>base64</code>: 以 base64 方式读取</li><li><code>binary</code>: BinaryString 格式(byte n is data.charCodeAt(n))</li><li><code>string</code>: UTF8 编码的字符串</li><li><code>buffer</code>: nodejs Buffer</li><li><code>array</code>: Uint8Array，8 位无符号数组</li><li><code>file</code>: 文件的路径（仅 nodejs 下支持）；</li></ul></blockquote><h4 id="WorkBook对象"><a href="#WorkBook对象" class="headerlink" title="WorkBook对象"></a><code>WorkBook</code>对象</h4><p>返回的 workBook 对象我们只需关注俩个重要的属性<code>SheetName</code>和<code>Sheets</code></p><ul><li><code>SheetName</code> 里存放的是表格的名字，例如：sheet1,sheet2</li><li><code>Sheets</code> 数组存放的是对应 <code>SheetName</code> 中每个表格的数据，也就是我们要获取的表格数据,表格数据的具体表现形式请参考文末的参考链接，这里就不赘述了，因为工具库<code>xlsx.utils</code>已经给我们封装好了处理函数，获取到表格数据后我们就可以转换为我们需要的数据形式，比如<code>sheet_to_json</code>,直接就可以获得我们需要的 JSON 数据</li></ul><h4 id="xlsx-write-导出表格"><a href="#xlsx-write-导出表格" class="headerlink" title="xlsx.write 导出表格"></a><code>xlsx.write</code> 导出表格</h4><p>这里是本文的重点,划重点—使用<code>json_to_sheet</code>将后端返回的 JSON 数据转换成我们需要的表格数据，然后生成<code>Blob</code>格式的文件，下载，实现导出表格数据功能。</p><p>封装了一个工具函数</p><figure class="highlight javascript"><figcaption><span>src/utils/exportExcel.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlsx <span class="keyword">from</span> <span class="string">"xlsx"</span>;</span><br><span class="line"><span class="keyword">const</span> jsonToSheet = xlsx.utils.json_to_sheet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">exportExcel</span>(<span class="params">sheetData, saveName, sheetName = <span class="string">"sheet1"</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sheet = jsonToSheet(sheetData, &#123;</span><br><span class="line">    skipHeader: <span class="literal">true</span> <span class="comment">//忽略第一行，表格导出的时候不会显示第一行的数据</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//可以在这里处理单元格合并</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    sheet['!merge'] = [</span></span><br><span class="line"><span class="comment">        // 设置A1-C1的单元格合并</span></span><br><span class="line"><span class="comment">        // s表示开始， e表示结束</span></span><br><span class="line"><span class="comment">        // r表示行， c表示列</span></span><br><span class="line"><span class="comment">        &#123;s: &#123;r: 0, c: 0&#125;, e: &#123;r: 0, c: 2&#125;&#125;</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">let</span> workbook = &#123;</span><br><span class="line">    SheetNames: [sheetName], <span class="comment">//表格的名字</span></span><br><span class="line">    Sheets: &#123;&#125; <span class="comment">//表格数据</span></span><br><span class="line">  &#125;;</span><br><span class="line">  workbook.Sheets[sheetName] = sheet;</span><br><span class="line">  <span class="comment">//第一种方法：</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  // 生成excel的配置项</span></span><br><span class="line"><span class="comment">  let wopts = &#123;</span></span><br><span class="line"><span class="comment">    bookType: 'xlsx', // 要生成的文件类型</span></span><br><span class="line"><span class="comment">    bookSST: false, // 是否生成Shared String Table，官方解释是，如果开启生成速度会下降，但在低版本IOS设备上有更好的兼容性</span></span><br><span class="line"><span class="comment">    type: 'binary',</span></span><br><span class="line"><span class="comment">  &#125;;</span></span><br><span class="line"><span class="comment">  let wbout = xlsx.write(workbook, wopts);</span></span><br><span class="line"><span class="comment">  let blob = new Blob([s2ab(wbout)], &#123; type: 'application/octet-stream' &#125;);</span></span><br><span class="line"><span class="comment">  // 字符串转ArrayBuffer</span></span><br><span class="line"><span class="comment">  function s2ab(s) &#123;</span></span><br><span class="line"><span class="comment">    let buf = new ArrayBuffer(s.length);</span></span><br><span class="line"><span class="comment">    let view = new Uint8Array(buf);</span></span><br><span class="line"><span class="comment">    for (let i = 0; i !== s.length; ++i) view[i] = s.charCodeAt(i) &amp; 0xff;</span></span><br><span class="line"><span class="comment">    return buf;</span></span><br><span class="line"><span class="comment">  &#125;*/</span></span><br><span class="line">  <span class="comment">//第二种方法：</span></span><br><span class="line">  <span class="comment">// 生成excel的配置项</span></span><br><span class="line">  <span class="keyword">let</span> wopts = &#123;</span><br><span class="line">    bookType: <span class="string">"xlsx"</span>, <span class="comment">// 要生成的文件类型</span></span><br><span class="line">    bookSST: <span class="literal">false</span>, <span class="comment">// 是否生成Shared String Table，官方解释是，如果开启生成速度会下降，但在低版本IOS设备上有更好的兼容性</span></span><br><span class="line">    type: <span class="string">"array"</span> <span class="comment">// 返回一个ArrayBuffer</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> wbout = xlsx.write(workbook, wopts);</span><br><span class="line">  <span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([wbout], &#123;</span><br><span class="line">    type: <span class="string">"text/plain"</span> <span class="comment">//创建一个装填ArrayBuffer对象的Blob对象</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//第二种方法比较方便，直接创建一个ArrayBuffer的Blob对象</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> blob == <span class="string">"object"</span> &amp;&amp; blob <span class="keyword">instanceof</span> Blob) &#123;</span><br><span class="line">    blob = URL.createObjectURL(blob); <span class="comment">// 创建blob地址</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> aLink = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>);</span><br><span class="line">  aLink.href = blob;</span><br><span class="line">  <span class="comment">// HTML5新增的属性，指定保存文件名，可以不要后缀，注意，file:///模式下不会生效</span></span><br><span class="line">  aLink.download = saveName || <span class="string">"导出.xlsx"</span>;</span><br><span class="line">  <span class="comment">//可以在这里给aLink增加点击事件</span></span><br><span class="line">  <span class="comment">/* aLink.click(); */</span></span><br><span class="line">  <span class="keyword">let</span> event;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.MouseEvent) &#123;</span><br><span class="line">    event = <span class="keyword">new</span> MouseEvent(<span class="string">"click"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    event = <span class="built_in">document</span>.createEvent(<span class="string">"MouseEvents"</span>);</span><br><span class="line">    event.initMouseEvent(</span><br><span class="line">      <span class="string">"click"</span>,</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="built_in">window</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="literal">null</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//自定义事件的触发dispatchEvent</span></span><br><span class="line">  <span class="comment">//也可以直接给aLink添加点击事件</span></span><br><span class="line">  aLink.dispatchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用封装的工具函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">exportSheet = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    speedMarket: &#123; archiveDetail &#125;</span><br><span class="line">  &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">  <span class="keyword">let</span> sheetData = [</span><br><span class="line">    &#123;</span><br><span class="line">      id: <span class="string">"序号"</span>,</span><br><span class="line">      cust_name: <span class="string">"客户姓名"</span>,</span><br><span class="line">      certificate_type: <span class="string">"证件类型"</span>,</span><br><span class="line">      certificate_no: <span class="string">"证件号码"</span>,</span><br><span class="line">      cust_sex: <span class="string">"性别"</span>,</span><br><span class="line">      credit_no: <span class="string">"卡号"</span>,</span><br><span class="line">      teller_no: <span class="string">"柜员号"</span>,</span><br><span class="line">      teller_name: <span class="string">"柜员姓名"</span>,</span><br><span class="line">      ab_user: <span class="string">"客户经理号"</span>,</span><br><span class="line">      ab_name: <span class="string">"客户经理姓名"</span>,</span><br><span class="line">      card_status: <span class="string">"卡片状态"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...archiveDetail.map(<span class="function">(<span class="params">val, idx</span>) =&gt;</span> &#123;</span><br><span class="line">      val.id = idx + <span class="number">1</span>; <span class="comment">//原始数据中增加序号一列</span></span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;)</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">await</span> exportExcel(sheetData, <span class="string">"快速营销-绩效详情表.xlsx"</span>);</span><br><span class="line">  message.info(<span class="string">"导出成功"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>参考链接</p></blockquote><ul><li><a href="https://github.com/SheetJS/js-xlsx" target="_blank" rel="noopener">js-xlsx</a></li><li><a href="https://www.cnblogs.com/liuxianan/p/js-excel.html#%E5%AF%BC%E5%87%BAexcel" target="_blank" rel="noopener">如何使用 JavaScript 实现纯前端读取和导出 excel 文件</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在做项目的过程中遇到一个需求，需要把前端页面的表格导出到本地生成&lt;code&gt;Excel&lt;/code&gt;文件，一直以为需要靠后端的协助，后来发现了一个非常棒的工具库&lt;code&gt;js-xlsx&lt;/code&gt;，可以在不依靠后端的情况下，前端自己来生成&lt;code&gt;Excel&lt;/code&gt;文件，后端只要返回前端表格需要的数据就可以，不需要在进行一次请求，在这里记录一下这个库的使用过程。&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://www.tiankai.party/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>axios封装笔记</title>
    <link href="http://www.tiankai.party/posts/48591/"/>
    <id>http://www.tiankai.party/posts/48591/</id>
    <published>2019-01-30T06:50:37.000Z</published>
    <updated>2019-02-14T02:02:21.940Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在写 react-redux-app 脚手架的时候就已经封装好了，一直没记录，后来在使用过程中又参考了<code>antd-design-pro</code>的报错机制，重新封装了一下，这里记录一下封装的代码，以免遗失</p><a id="more"></a><h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  功能：封装 axios</span></span><br><span class="line"><span class="comment"> *  create by tiankai on 05/16/18 17:15:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; stringify &#125; <span class="keyword">from</span> <span class="string">"qs"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; api &#125; <span class="keyword">from</span> <span class="string">"src/defaultSettings"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Modal &#125; <span class="keyword">from</span> <span class="string">"antd"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getWeekLocalStorage &#125; <span class="keyword">from</span> <span class="string">"./storage"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> codeMessage = &#123;</span><br><span class="line">  <span class="number">200</span>: <span class="string">"服务器成功返回请求的数据。"</span>,</span><br><span class="line">  <span class="number">201</span>: <span class="string">"新建或修改数据成功。"</span>,</span><br><span class="line">  <span class="number">202</span>: <span class="string">"一个请求已经进入后台排队（异步任务）。"</span>,</span><br><span class="line">  <span class="number">204</span>: <span class="string">"删除数据成功。"</span>,</span><br><span class="line">  <span class="number">400</span>: <span class="string">"发出的请求有错误，服务器没有进行新建或修改数据的操作。"</span>,</span><br><span class="line">  <span class="number">401</span>: <span class="string">"用户没有权限（令牌、用户名、密码错误）。"</span>,</span><br><span class="line">  <span class="number">403</span>: <span class="string">"用户得到授权，但是访问是被禁止的。"</span>,</span><br><span class="line">  <span class="number">404</span>: <span class="string">"发出的请求针对的是不存在的记录，服务器没有进行操作。"</span>,</span><br><span class="line">  <span class="number">406</span>: <span class="string">"请求的格式不可得。"</span>,</span><br><span class="line">  <span class="number">410</span>: <span class="string">"请求的资源被永久删除，且不会再得到的。"</span>,</span><br><span class="line">  <span class="number">422</span>: <span class="string">"当创建一个对象时，发生一个验证错误。"</span>,</span><br><span class="line">  <span class="number">500</span>: <span class="string">"服务器发生错误，请检查服务器。"</span>,</span><br><span class="line">  <span class="number">502</span>: <span class="string">"网关错误。"</span>,</span><br><span class="line">  <span class="number">503</span>: <span class="string">"服务不可用，服务器暂时过载或维护。"</span>,</span><br><span class="line">  <span class="number">504</span>: <span class="string">"网关超时。"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkStatus</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!response) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"response is undefined"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (response.status &gt;= <span class="number">200</span> &amp;&amp; response.status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> errorText = codeMessage[response.status] || response.statusText;</span><br><span class="line">  <span class="keyword">const</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>(errorText);</span><br><span class="line">  error.name = response.status;</span><br><span class="line">  error.response = response;</span><br><span class="line">  error.text = errorText;</span><br><span class="line">  <span class="keyword">throw</span> error;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="comment">//`baseURL` 将自动加在 `url` 前面，除非 `url` 是一个绝对 URL。</span></span><br><span class="line">  <span class="comment">// 它可以通过设置一个 `baseURL` 便于为 axios 实例的方法传递相对 URL</span></span><br><span class="line">  baseURL: api,</span><br><span class="line">  <span class="comment">// 在请求发送前，可以根据实际要求，是否要对请求的数据进行转换</span></span><br><span class="line">  <span class="comment">// 仅应用于 post、put、patch 请求</span></span><br><span class="line">  transformRequest: [</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">data, headers</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Do whatever you want to transform the data</span></span><br><span class="line">      <span class="comment">// console.log(headers);</span></span><br><span class="line">      <span class="keyword">return</span> stringify(data);</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  `transformResponse` 在传递给 then/catch 前，允许修改响应数据</span></span><br><span class="line">  <span class="comment">// it is passed to then/catch</span></span><br><span class="line">  transformResponse: [</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Do whatever you want to transform the data</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 请求头信息</span></span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="comment">// 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8;',</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 设置超时时间</span></span><br><span class="line">  timeout: <span class="number">1000</span>,</span><br><span class="line">  <span class="comment">// 携带凭证</span></span><br><span class="line">  withCredentials: <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = axios.create(config);</span><br><span class="line"></span><br><span class="line"><span class="comment">//请求拦截器</span></span><br><span class="line">instance.interceptors.request.use(</span><br><span class="line">  config =&gt; &#123;</span><br><span class="line">    <span class="comment">// Do something before request is sent</span></span><br><span class="line">    <span class="comment">// 可以在这里做一些事情在请求发送前</span></span><br><span class="line">    <span class="comment">// config.headers['TOKEN']=''// 在这里设置请求头与携带token信息;</span></span><br><span class="line">    <span class="keyword">const</span> token = getWeekLocalStorage(<span class="string">"token"</span>);</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      config.headers[<span class="string">"AUTHORIZATION"</span>] = token;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (config.method === <span class="string">"post"</span>) &#123;</span><br><span class="line">      config.headers[<span class="string">"Content-Type"</span>] =</span><br><span class="line">        <span class="string">"application/x-www-form-urlencoded;charset=UTF-8"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    <span class="comment">// Do something whit request error</span></span><br><span class="line">    <span class="comment">// 请求失败可以做一些事情</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//响应拦截器</span></span><br><span class="line">instance.interceptors.response.use(</span><br><span class="line">  response =&gt; &#123;</span><br><span class="line">    <span class="comment">// Do something with response data</span></span><br><span class="line">    <span class="comment">// 在这里你可以判断后台返回数据携带的请求码</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    <span class="comment">// Do something whit response error</span></span><br><span class="line">    <span class="comment">// 根据 错误码返回信息</span></span><br><span class="line">    <span class="keyword">return</span> checkStatus(error.response);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* method GET/POST/PUT</span></span><br><span class="line"><span class="comment"> * url</span></span><br><span class="line"><span class="comment"> * params/data</span></span><br><span class="line"><span class="comment"> * headers &#123; 'content-type': 'application/x-www-form-urlencoded'&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> ajax = <span class="function"><span class="params">options</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    instance(options)</span><br><span class="line">      .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        resolve(response);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.dir(error);</span><br><span class="line">        Modal.error(&#123;</span><br><span class="line">          title: <span class="string">"请求错误"</span>,</span><br><span class="line">          content: error.message</span><br><span class="line">        &#125;);</span><br><span class="line">        reject(error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ajax;</span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ajax <span class="keyword">from</span> <span class="string">"src/utils/axios"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取客户营销报表</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchClientMarket</span>(<span class="params">payload</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ajax(&#123;</span><br><span class="line">    method: <span class="string">"GET"</span>,</span><br><span class="line">    url: <span class="string">`/report/clientMarket/clientMarketStatistics`</span>,</span><br><span class="line">    params: payload</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /report/login 平台登录接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">payload</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ajax(&#123;</span><br><span class="line">    method: <span class="string">"POST"</span>,</span><br><span class="line">    url: <span class="string">"/report/login"</span>,</span><br><span class="line">    data: payload</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在写 react-redux-app 脚手架的时候就已经封装好了，一直没记录，后来在使用过程中又参考了&lt;code&gt;antd-design-pro&lt;/code&gt;的报错机制，重新封装了一下，这里记录一下封装的代码，以免遗失&lt;/p&gt;
    
    </summary>
    
    
      <category term="axios,http" scheme="http://www.tiankai.party/tags/axios-http/"/>
    
  </entry>
  
  <entry>
    <title>react-hooks使用体验</title>
    <link href="http://www.tiankai.party/posts/56237/"/>
    <id>http://www.tiankai.party/posts/56237/</id>
    <published>2019-01-30T06:48:52.000Z</published>
    <updated>2019-02-12T03:54:12.951Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>react-hooks</code>使用必须把<code>react</code>/<code>react-dom</code>的版本更新到<code>16.7.0-alpha.2</code><br>如果<code>node</code>版本过低的话建议更新一下，windows 可以使用<a href="https://github.com/tiakia/nvmw-china" target="_blank" rel="noopener">nvmw</a>来管理<code>node</code>版本<br><code>react-hooks</code>的出现是为了解决在无状态的组件中（函数类组件）使用<code>state</code>和生命周期，在<code>class</code>组件中不能使用</p><a id="more"></a><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react@16.7.0-alpha.2 react-dom@16.7.0-alpha.2 --save</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add react@16.7.0-alpha.2 react-dom@16.7.0-alpha.2</span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="state-hook"><a href="#state-hook" class="headerlink" title="state hook"></a>state hook</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;Click me&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><code>useState</code>就是一个 Hooks,他返回一个数组，第一个是<code>state</code>的名字<code>count</code>，第二个是设置<code>count state</code>的方法，<code>useState</code>的参数就是初始的<code>state</code>，换成 class 类型的组件就是：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      count: <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;You clicked &#123;<span class="keyword">this</span>.state.count&#125; times&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt;</span></span><br><span class="line"><span class="regexp">          Click me</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>在一个<code>function</code>组件中可以使用多个<code>useState</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExampleWithManyStates</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Declare multiple state variables!</span></span><br><span class="line">  <span class="keyword">const</span> [age, setAge] = useState(<span class="number">42</span>);</span><br><span class="line">  <span class="keyword">const</span> [fruit, setFruit] = useState(<span class="string">"banana"</span>);</span><br><span class="line">  <span class="keyword">const</span> [todos, setTodos] = useState([&#123; <span class="attr">text</span>: <span class="string">"Learn Hooks"</span> &#125;]);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="effect-hook"><a href="#effect-hook" class="headerlink" title="effect hook"></a>effect hook</h4><p>Effect Hook 用来处理一些带有副作用的操作，例如，变更 DOM，请求数据，因为它们会影响其他组件，并且在渲染中无法进行。<code>useEffect hook</code> 类似于类组件中 <code>componentDidMount</code>、<code>componentDidUpdate</code>、<code>componentWillUnmount</code> 的统一。<br><code>useEffect</code>的带有副作用的操作通常会在渲染之后进行，包括第一次渲染。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = useState(<span class="built_in">window</span>.innerWith);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleResize = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setWidth(<span class="built_in">window</span>.innerWith);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>, handleResize);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt; <span class="built_in">window</span> width is &#123;width&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>useEffect</code>可以传入第二个操作来避免性能的损耗，如果第二个参数数组中的成员变量没有变化则会跳过此次改变。如果传入一个空数组 ，那么该 effect 只会在组件 mount 和 unmount 时期执行。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = useState(<span class="built_in">window</span>.innerWith);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleResize = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setWidth(<span class="built_in">window</span>.innerWith);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>, handleResize);</span><br><span class="line">  &#125;, [width]); <span class="comment">//width 没有变化则不处理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt; <span class="built_in">window</span> width is &#123;width&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>useEffect</code>可以通过返回一个函数来进行清理操作，这些操作会在组件<code>unmounts</code>时运行。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = useState(<span class="built_in">window</span>.innerWith);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleResize = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setWidth(<span class="built_in">window</span>.innerWith);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>, handleResize);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.removeEventListener(<span class="string">"resize"</span>); <span class="comment">//取消监听窗口宽度变化</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt; <span class="built_in">window</span> width is &#123;width&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;react-hooks&lt;/code&gt;使用必须把&lt;code&gt;react&lt;/code&gt;/&lt;code&gt;react-dom&lt;/code&gt;的版本更新到&lt;code&gt;16.7.0-alpha.2&lt;/code&gt;&lt;br&gt;如果&lt;code&gt;node&lt;/code&gt;版本过低的话建议更新一下，windows 可以使用&lt;a href=&quot;https://github.com/tiakia/nvmw-china&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;nvmw&lt;/a&gt;来管理&lt;code&gt;node&lt;/code&gt;版本&lt;br&gt;&lt;code&gt;react-hooks&lt;/code&gt;的出现是为了解决在无状态的组件中（函数类组件）使用&lt;code&gt;state&lt;/code&gt;和生命周期，在&lt;code&gt;class&lt;/code&gt;组件中不能使用&lt;/p&gt;
    
    </summary>
    
    
      <category term="react" scheme="http://www.tiankai.party/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>金额的表达正则</title>
    <link href="http://www.tiankai.party/posts/32506/"/>
    <id>http://www.tiankai.party/posts/32506/</id>
    <published>2018-12-25T06:12:00.000Z</published>
    <updated>2019-01-02T02:33:01.311Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>这个真的是有点意思，这里记录一下，大体的意思就是给你一串数字，然后你用三个一逗号的形式把数字表达出来，比如： <code>50153855514.7667</code> 表达出来就是 <code>50,153,855,514.7667</code></p><a id="more"></a><p>第一想法都是使用正则来匹配，我以为使用一个正则就能出来了，后来发现想的太简单了，头疼了好一会，又是正向肯定匹配又是反向否定匹配的弄了半天，后来想了个法子，从小数点分割开，然后再用俩次正则来达到效果。</p><figure class="highlight javascript"><figcaption><span>formateMoney.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formateMoney</span>(<span class="params">money</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (money &amp;&amp; money &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> moneyFormate = (money + <span class="string">""</span>).split(<span class="string">"."</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      moneyFormate[<span class="number">0</span>].replace(<span class="regexp">/(\d&#123;3&#125;)+$/gi</span>, (match, $<span class="number">1</span>, $<span class="number">2</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> result = match.replace(<span class="regexp">/(\d&#123;3&#125;)/gi</span>, (_match, _$<span class="number">1</span>) =&gt; <span class="string">","</span> + _$<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> $<span class="number">2</span> !== <span class="number">0</span></span><br><span class="line">          ? result</span><br><span class="line">          : result.replace(<span class="regexp">/,([,|\d]+)/gi</span>, (__match, $<span class="number">11</span>) =&gt; $<span class="number">11</span>);</span><br><span class="line">      &#125;) +</span><br><span class="line">      <span class="string">"."</span> +</span><br><span class="line">      moneyFormate[<span class="number">1</span>]</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> money;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>result</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> money1 = <span class="number">12942222.22</span>;</span><br><span class="line"><span class="built_in">console</span>.log(formateMoney(money1)); <span class="comment">//12,942,222.22</span></span><br><span class="line"><span class="keyword">let</span> money2 = <span class="number">914874.2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(formateMoney(money2)); <span class="comment">//914,874.20</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这个真的是有点意思，这里记录一下，大体的意思就是给你一串数字，然后你用三个一逗号的形式把数字表达出来，比如： &lt;code&gt;50153855514.7667&lt;/code&gt; 表达出来就是 &lt;code&gt;50,153,855,514.7667&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.tiankai.party/categories/javascript/"/>
    
    
      <category term="正则" scheme="http://www.tiankai.party/tags/%E6%AD%A3%E5%88%99/"/>
    
  </entry>
  
  <entry>
    <title>react路由控制权限</title>
    <link href="http://www.tiankai.party/posts/45622/"/>
    <id>http://www.tiankai.party/posts/45622/</id>
    <published>2018-12-25T06:09:00.000Z</published>
    <updated>2019-01-04T02:33:09.359Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>react 中可以通过路由来控制用户权限访问，主要使用的 <code>react-router</code> 的 <code>switch</code> 这里有个实用的例子</p><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RouterConfig</span>(<span class="params">&#123; history &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Router history=&#123;history&#125; basename=&#123;config.basename&#125;&gt;</span><br><span class="line">      &lt;Switch&gt;</span><br><span class="line">        &#123;<span class="comment">/* onEnter=&#123;authenticated(history)&#125; */</span>&#125;</span><br><span class="line">        &#123;<span class="comment">/*-----------------------------*/</span>&#125;</span><br><span class="line">        &#123;<span class="comment">/*renderRoutes(RouteConfig)*/</span>&#125;</span><br><span class="line">        &#123;<span class="comment">/*-----------------------------*/</span>&#125;</span><br><span class="line">        &lt;Route path=<span class="string">"/login"</span> exact component=&#123;Login&#125; /&gt;</span><br><span class="line">        &lt;Authorized</span><br><span class="line">          component=&#123;Routes&#125;</span><br><span class="line">          path=<span class="string">"/"</span></span><br><span class="line">          noMatch=<span class="string">"/login"</span></span><br><span class="line">          history=&#123;history&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Router&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样用户在刚进入的时候，如果访问的不是<code>/login</code>那么会进入<code>/</code>对应的 <code>Authorized</code>组件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Authorized = <span class="function">(<span class="params">&#123; component: Component, history, noMatch, ...rest &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;Route</span><br><span class="line">    &#123;...rest&#125;</span><br><span class="line">    render=&#123;props =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> token = authenticated(history); <span class="comment">//获取 token</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"-----------"</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(token);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"-----authorized------"</span>);</span><br><span class="line">      <span class="keyword">return</span> token ? &lt;Component &#123;...props&#125; /&gt; : &lt;Redirect to=&#123;noMatch&#125; /&gt;;</span><br><span class="line">    &#125;&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>在<code>Authorized</code>组件中，获取<code>token</code>,如果<code>token</code>存在那么就渲染对应的组件，如果<code>token</code>不存在就重定向到<code>/login</code>路径,<code>Authorized</code>组件渲染的 <code>Component</code>是所有的路由集合</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Routes = <span class="function">(<span class="params">&#123; history &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">history</span>=<span class="string">&#123;history&#125;</span>&gt;</span>&#123;renderRoutes(RouteConfig)&#125;<span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这里使用的<code>react-router-config</code>的库提供的<code>renderRoutes</code>函数，其中的<code>RouteConfig</code>是配置的所有的静态路由<br>大体的思路就是这样，在用户开始访问的时候就控制，如果<code>token</code>(这里也可以是其他的判断条件)存在，继续访问，如果不存在就让他访问另一个路由<br>前端权限控制比较简单，权限更多的还是前后端一起来控制，比较保险</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;react 中可以通过路由来控制用户权限访问，主要使用的 &lt;code&gt;react-router&lt;/code&gt; 的 &lt;code&gt;switch&lt;/code&gt; 这里有个实用的例子&lt;/p&gt;
    
    </summary>
    
      <category term="react" scheme="http://www.tiankai.party/categories/react/"/>
    
    
      <category term="react" scheme="http://www.tiankai.party/tags/react/"/>
    
      <category term="react-router" scheme="http://www.tiankai.party/tags/react-router/"/>
    
  </entry>
  
  <entry>
    <title>nvmw管理node版本排坑</title>
    <link href="http://www.tiankai.party/posts/23140/"/>
    <id>http://www.tiankai.party/posts/23140/</id>
    <published>2018-12-11T07:24:43.000Z</published>
    <updated>2019-01-02T02:33:01.227Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>nvmw 是 nvm 专为 Windows 开发的版本，用来管理 node 的版本，这里总结一下排坑记录</p><a id="more"></a><h4 id="第一步：安装"><a href="#第一步：安装" class="headerlink" title="第一步：安装"></a>第一步：安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/hakobera/nvmw.git</span><br></pre></td></tr></table></figure><h4 id="第二步：配置环境变量"><a href="#第二步：配置环境变量" class="headerlink" title="第二步：配置环境变量"></a>第二步：配置环境变量</h4><p>重新打开命令行窗口，输入<code>nvmw</code>查看是否安装正确</p><h4 id="排坑"><a href="#排坑" class="headerlink" title="排坑"></a>排坑</h4><p>因为墙的原因，会导致我们安装 <code>node</code> 不成功，这里在 github 上作者也给出了解决方法，设置淘宝源，可能因为版本原因，网上搜到的答案都是比较过期的不能解决问题，这里我提供一种思路解决。</p><ul><li>首先是作者给出的解决办法</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> <span class="string">"NVMW_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node"</span></span><br><span class="line"><span class="built_in">set</span> <span class="string">"NVMW_IOJS_ORG_MIRROR=http://npm.taobao.org/mirrors/iojs"</span></span><br><span class="line"><span class="built_in">set</span> <span class="string">"NVMW_NPM_MIRROR=http://npm.taobao.org/mirrors/npm"</span></span><br><span class="line"></span><br><span class="line">nvmw install 0.11.14</span><br><span class="line">nvmw install node-v0.11.15</span><br><span class="line">nvmw install iojs</span><br><span class="line">nvmw install iojs-v1.0.2</span><br></pre></td></tr></table></figure><p>但是每次安装都需要执行一下 set 命令，比较麻烦我们直接修改配置文件。</p><ul><li><p>打开 get_npm.js 文件，搜索作者让我们这命令行 set 的那几个变量，</p><ul><li><p>修改这俩个变量为以下这样</p><figure class="highlight javascript"><figcaption><span>get_npm.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> NVMW_NPM_MIRROR = <span class="string">"http://npm.taobao.org/mirrors/npm"</span>;</span><br><span class="line"><span class="keyword">var</span> NVMW_IOJS_ORG_MIRROR = <span class="string">"http://npm.taobao.org/mirrors/iojs"</span>;</span><br></pre></td></tr></table></figure></li><li><p>修改判断<code>binType === &#39;iojs&#39;</code>这个表达式的 else 语句对应的位置：</p><figure class="highlight javascript"><figcaption><span>get_npm.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var pkgUri = util.format(NPM_PKG_JSON_URL, 'joyent/node',</span></span><br><span class="line"><span class="comment">//binVersion === 'latest' ? 'master' : binVersion);</span></span><br><span class="line"><span class="keyword">var</span> pkgUri = <span class="string">"https://npm.taobao.org/mirrors/node/index.json"</span>;</span><br><span class="line">wget(pkgUri, <span class="function"><span class="keyword">function</span>(<span class="params">filename, pkg</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//if (filename === null) &#123;</span></span><br><span class="line">  <span class="comment">//return noNpmAndExit();</span></span><br><span class="line">  <span class="comment">//&#125;</span></span><br><span class="line">  <span class="comment">//downloadNpmZip(JSON.parse(pkg).version);</span></span><br><span class="line">  <span class="keyword">if</span> (filename === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> noNpmAndExit();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> _pkg = <span class="built_in">JSON</span>.parse(pkg);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, n = _pkg.length; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> obj = _pkg[i];</span><br><span class="line">    <span class="keyword">if</span> (obj.version == binVersion) &#123;</span><br><span class="line">      downloadNpmZip(obj.npm);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li>修改 nvmw.bat 文件</li></ul><ul><li><p>x64 改为 win-x64</p><figure class="highlight bat"><figcaption><span>nvmw.bat</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> NODE_EXE_URL=<span class="variable">%NVMW_NODEJS_ORG_MIRROR%</span>/<span class="variable">%NODE_VERSION%</span>/win-x64/node.exe</span><br></pre></td></tr></table></figure></li><li><p>设置 NVMW_NODEJS_ORG_MIRROR/NVMW_IOJS_ORG_MIRROR 变量</p><figure class="highlight bat"><figcaption><span>nvmw.bat</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">原始为:</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">defined</span> NVMW_NODEJS_ORG_MIRROR (</span><br><span class="line">  <span class="built_in">set</span> "NVMW_NODEJS_ORG_MIRROR=https://nodejs.org/dist"</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">defined</span> NVMW_IOJS_ORG_MIRROR (</span><br><span class="line">  <span class="built_in">set</span> "NVMW_IOJS_ORG_MIRROR=https://iojs.org/dist"</span><br><span class="line">)</span><br><span class="line">修改为:</span><br><span class="line"><span class="built_in">set</span> "NVMW_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node"</span><br><span class="line"><span class="built_in">set</span> "NVMW_IOJS_ORG_MIRROR=http://npm.taobao.org/mirrors/iojs"</span><br></pre></td></tr></table></figure></li></ul><ul><li>修改 <code>fget.js</code> 文件 47 行，<code>XMLHTTP</code> 更改为 <code>ServerXMLHTTP</code></li></ul><h4 id="注意点："><a href="#注意点：" class="headerlink" title="注意点："></a>注意点：</h4><p>在修改完这几处地方后应该可以正常下载<code>node.exe</code>和<code>npm.zip</code>文件并解压了，但是一到最后总会提示，找不到该文件或者文件不存在或者进程被占用之类的，然后本来下载好的文件会都给你删掉。。。我仔细研究了一下代码发现问题出在这里</p><figure class="highlight bat"><figcaption><span>nvmw.bat</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="built_in">Start</span> unzip "<span class="variable">%NPM_ZIP_FILE%</span>" to "<span class="variable">%NODE_HOME%</span>"</span><br><span class="line">cscript //nologo "<span class="variable">%NVMW_HOME%</span>\unzip.js" "<span class="variable">%NPM_ZIP_FILE%</span>" "<span class="variable">%NODE_HOME%</span>"</span><br><span class="line"><span class="built_in">mkdir</span> "<span class="variable">%NODE_HOME%</span>\node_modules"</span><br><span class="line"><span class="built_in">rmdir</span> /s /q "<span class="variable">%NODE_HOME%</span>\node_modules\npm"</span><br><span class="line"><span class="built_in">move</span> npm-* "<span class="variable">%NODE_HOME%</span>\node_modules\npm"</span><br><span class="line"><span class="built_in">copy</span> "<span class="variable">%NODE_HOME%</span>\node_modules\npm\bin\npm.<span class="built_in">cmd</span>" "<span class="variable">%NODE_HOME%</span>\npm.<span class="built_in">cmd</span>"</span><br><span class="line"><span class="built_in">cd</span> "<span class="variable">%CD_ORG%</span>"</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exist</span> "<span class="variable">%NODE_HOME%</span>\npm.<span class="built_in">cmd</span>" <span class="keyword">goto</span> install_error</span><br><span class="line"><span class="built_in">echo</span> npm install ok</span><br></pre></td></tr></table></figure><p>先解释一下这段代码的意思，以下载 8.14.0 版本为例(<code>%NODE_HOME%</code>变量表示存放 node 的文件夹比如 v8.14.0，在下载的时候会自动创建该文件夹)</p><ol><li>在命令行输出 开始解压下载好的 npm.zip 文件</li><li>调用<code>unzip.js</code>文件开始解压缩 npm.zip,后面俩个是参数列表</li><li>新建 v8.14.0/node_modules 文件夹</li><li>删除 v8.14.0/node_modules 文件夹下的 npm 文件</li><li>将解压缩成功的 npm-* 文件夹移动到 新建好的 node_modules 文件夹下<br>问题出在这里安装 5.x 版本没有问题因为 npm.zip 的压缩包里就是 npm-5.6.1 类似的<br>而 8.14.0 版本 npm.zip 压缩包里面就是 cli-6.4.1 了<br>找不到文件自然就报错了，然后就会把下载好的 node 和 npm 压缩包一起删掉</li><li>将 node_modules/npm/bin/npm.cmd 拷贝到 v8.14.0 文件夹下</li></ol><h5 id="解决："><a href="#解决：" class="headerlink" title="解决："></a>解决：</h5><ul><li>可以把第五步第六步的代码注释了自己操作</li><li>也可以修改第五步代码 自动操作<figure class="highlight bat"><figcaption><span>nvmw.bat</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">move</span> *-* "<span class="variable">%NODE_HOME%</span>\node_modules\npm"</span><br></pre></td></tr></table></figure></li></ul><h4 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h4><p>安装 nodejs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvmw insall 6.9.2</span><br></pre></td></tr></table></figure><p>展示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvmw ls</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvmw use 6.9.2</span><br></pre></td></tr></table></figure><p><a href="https://github.com/tiakia/nvmw-china" target="_blank" rel="noopener">我修改后的版本</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;nvmw 是 nvm 专为 Windows 开发的版本，用来管理 node 的版本，这里总结一下排坑记录&lt;/p&gt;
    
    </summary>
    
    
      <category term="node" scheme="http://www.tiankai.party/tags/node/"/>
    
  </entry>
  
  <entry>
    <title>umi+dva的使用</title>
    <link href="http://www.tiankai.party/posts/59635/"/>
    <id>http://www.tiankai.party/posts/59635/</id>
    <published>2018-11-15T09:20:00.000Z</published>
    <updated>2019-01-21T09:28:14.988Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>umi</code>和<code>dva</code>都是阿里出的简化<code>react</code>开发的架构，以前都是直接开发的没使用这套，后来接触下来以后发现，开发感觉挺舒适的，刚开始使用的<code>dva</code>，有一个缺陷就是基于<code>roadhog</code>搭建的<code>webpack</code>架子，给我们自定义的接口实在有限,后来<code>umi</code>加入了<code>webpack-chain</code>可以自己添加、修改<code>webpack</code>的配置，值得一试。</p><a id="more"></a><p><code>umi+dva</code> 的架构中，<code>dva</code>被当成了数据流，集合了<code>redux</code>/<code>redux-saga</code>，处理异步操作,而且还有个方便的是集合了<code>dva-loading</code>这个插件，不用我们去手动的写<code>loading</code>状态的<code>show/hide</code>了</p><h3 id="dva"><a href="#dva" class="headerlink" title="dva"></a>dva</h3><p><code>dva</code> 首先是一个基于 <code>redux</code> 和 <code>redux-saga</code> 的数据流方案，然后为了简化开发体验，<code>dva</code> 还额外内置了 <code>react-router</code> 和 <code>fetch</code>，所以也可以理解为一个轻量级的应用框架。<br>我们只是用他集合<code>redux</code>和<code>redux-saga</code>的部分，其他的我们使用<code>umi</code>的就行，<code>dva</code> 将文件分为了<code>model</code>、<code>services</code>，<code>model</code>文件夹下建立的就是我们的 <code>redux</code> 文件，<code>services</code>下建立的是我们的<code>api</code>接口，我们看一下<code>dva</code>的<code>model</code>文件</p><figure class="highlight javascript"><figcaption><span>models/login.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; queryLogin &#125; <span class="keyword">from</span> <span class="string">"../services/login"</span>; <span class="comment">//导入loginService API 接口</span></span><br><span class="line"><span class="keyword">import</span> &#123; Toast &#125; <span class="keyword">from</span> <span class="string">"antd-mobile"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// namespace 用来标识reducer文件，connect的时候使用</span></span><br><span class="line">  <span class="comment">// 类似redux整合所有reducer文件中的key值</span></span><br><span class="line">  namespace: <span class="string">"login"</span>,</span><br><span class="line"></span><br><span class="line">  state: &#123;</span><br><span class="line">    <span class="comment">//相当于redux的InitialState</span></span><br><span class="line">    login: <span class="string">""</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  subscriptions: &#123;</span><br><span class="line">    <span class="comment">//可以在这里进行监听</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//这里进行的就是异步操作了，集成了 redux-saga</span></span><br><span class="line">  effects: &#123;</span><br><span class="line">    *fetch(&#123; payload, callback &#125;, &#123; call, put &#125;) &#123;</span><br><span class="line">      <span class="comment">// eslint-disable-line</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">yield</span> call(queryLogin, payload);</span><br><span class="line">        <span class="keyword">if</span> (response.code === <span class="string">"0000"</span>) &#123;</span><br><span class="line">          <span class="keyword">yield</span> put(&#123; <span class="attr">type</span>: <span class="string">"save"</span>, <span class="attr">payload</span>: response.data &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> errorObj = <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">          errorObj.msg = response.data.msg;</span><br><span class="line">          <span class="keyword">throw</span> errorObj;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Error</span>(e));</span><br><span class="line">        Toast.fail(e.msg || <span class="string">"登录请求失败，请重试"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// redux的 reducer 函数</span></span><br><span class="line">  reducers: &#123;</span><br><span class="line">    save(state, action) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, ...action.payload &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在组件中使用<code>dva</code>的<code>model</code>,只显示主要代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">  login = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; dispatch, form &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    form.validateFields(<span class="keyword">async</span> (err, fieldsValues) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123; phone, password &#125; = fieldsValues;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> handleError(err, fieldsValues);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> dispatch(&#123;</span><br><span class="line">          type: <span class="string">"login/fetch"</span>,</span><br><span class="line">          payload: &#123;</span><br><span class="line">            user_no: phone,</span><br><span class="line">            user_pass: password</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      loading: &#123; effects &#125;</span><br><span class="line">    &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        ...</span><br><span class="line">        &lt;WingBlank className=&#123;styles.logbox&#125;&gt;</span><br><span class="line">          &lt;Button</span><br><span class="line">            type=<span class="string">"primary"</span></span><br><span class="line">            className=&#123;styles.login&#125;</span><br><span class="line">            onClick=&#123;() =&gt; &#123;</span><br><span class="line">              <span class="keyword">this</span>.login();</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            登录</span><br><span class="line">          &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>WingBlank&gt;</span><br><span class="line">        &lt;ActivityIndicator</span><br><span class="line">          toast</span><br><span class="line">          text=<span class="string">"登录中..."</span></span><br><span class="line">          animating=&#123;effects[<span class="string">"login/fetch"</span>] || <span class="literal">false</span>&#125;</span><br><span class="line">        /&gt;&#123;<span class="string">" "</span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect((&#123; login, loading &#125;) =&gt; (&#123;</span></span><br><span class="line"><span class="regexp">  login,</span></span><br><span class="line"><span class="regexp">  loading</span></span><br><span class="line"><span class="regexp">&#125;))(createForm()(Login));</span></span><br></pre></td></tr></table></figure><ul><li>首先和<code>redux</code>一样我们需要<code>connect</code>组件注入你需要使用的<code>model</code>这里我们注入了<code>login</code>和<code>loading</code></li><li>在<code>connect</code>注入了<code>login</code>模块后，点击登录时，会调用 <code>login/fetch</code>的异步操作（调用 loginModels 下面的 fetch 方法），如此完成一次完整的流程操作</li><li>这个组件中我们可以看到<code>dva-loading</code>的使用，用户在点击登录后会调用<code>login</code>中的<code>fetch</code>异步操作，在<code>dva-loading</code>中就会自动监听这个 effects 直到他完成，我们就可以直接判断<code>effects[loing/fetch]</code>来监听这个异步操作是否完成，十分的方便</li></ul><h3 id="umi"><a href="#umi" class="headerlink" title="umi"></a>umi</h3><p>对与<code>umi</code>来说，最大的优势就是采用了 <code>next.js</code> 的约定式路由，文件目录即路由， 省却了我们自己去配置路由了，对与之前我们的路由这样的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> RouteConfig = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/"</span>,</span><br><span class="line">    component: Index,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/home"</span>,</span><br><span class="line">    component: Home,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/home/detail"</span>,</span><br><span class="line">    component: NoticeDetail,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/home/card"</span>,</span><br><span class="line">    component: CardListDetail,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/news"</span>,</span><br><span class="line">    component: NewScheduleList,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"/type/:type"</span>, <span class="comment">//重点关注这，umi处理动态路由</span></span><br><span class="line">    component: TypeList,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>而现在我们只需要在<code>page</code>文件夹下创建相应的文件就可以了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+ pages/</span><br><span class="line">  + home/</span><br><span class="line">    - index.js <span class="comment"># Home.js</span></span><br><span class="line">    + detail/</span><br><span class="line">      - index.js <span class="comment"># NoticeDetail.js</span></span><br><span class="line">    + card/</span><br><span class="line">      - index.js <span class="comment"># CardListDetail.js</span></span><br><span class="line">  + news/</span><br><span class="line">     - index.js <span class="comment"># NewScheduleList.js</span></span><br><span class="line">  + <span class="built_in">type</span>/</span><br><span class="line">    - <span class="variable">$type</span>.js <span class="comment"># TypeList.js 文件名加$标识是个动态路由</span></span><br><span class="line">  - index.js <span class="comment"># Index.js</span></span><br></pre></td></tr></table></figure><p>其他具体的路由约定规则，可以参考<a href="https://umijs.org/zh/guide/router.html#%E7%BA%A6%E5%AE%9A%E5%BC%8F%E8%B7%AF%E7%94%B1" target="_blank" rel="noopener">umi 官网</a></p><h4 id="webapck-chain配置"><a href="#webapck-chain配置" class="headerlink" title="webapck-chain配置"></a><code>webapck-chain</code>配置</h4><p>umi 最大的优点我觉得就是加入了<code>webapck-chain</code>可以自己扩展<code>webpack</code>配置，配置的地方在根目录的<code>config.js</code>或者<code>.umirc.js</code><br>具体的配置如下：</p><figure class="highlight javascript"><figcaption><span>.umirc.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ref: https://umijs.org/config/</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">"path"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// ref: https://umijs.org/plugin/umi-plugin-react.html</span></span><br><span class="line">    [</span><br><span class="line">      <span class="string">"umi-plugin-react"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        antd: <span class="literal">true</span>,</span><br><span class="line">        dva: &#123;</span><br><span class="line">          immer: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        title: <span class="string">"answers-mobile"</span>,</span><br><span class="line">        dll: <span class="literal">true</span>,</span><br><span class="line">        routes: &#123;</span><br><span class="line">          exclude: []</span><br><span class="line">        &#125;,</span><br><span class="line">        hardSource: <span class="literal">true</span>,</span><br><span class="line">        fastClick: <span class="literal">true</span>,</span><br><span class="line">        library: <span class="string">"react"</span>,</span><br><span class="line">        dynamicImport: &#123;</span><br><span class="line">          loadingComponent: <span class="string">"./components/Loading.js"</span>,</span><br><span class="line">          webpackChunkName: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  theme: &#123;&#125;,</span><br><span class="line">  alias: &#123;</span><br><span class="line">    src: path.resolve(__dirname, <span class="string">"src"</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//添加 webpack-bundle-analyzer 插件</span></span><br><span class="line">  <span class="comment">//更多的添加方式请查看 webpack-chain</span></span><br><span class="line">  chainWebpack(config, &#123; webpack &#125;) &#123;</span><br><span class="line">    config.merge(&#123;</span><br><span class="line">      plugin: &#123;</span><br><span class="line">        bundleAnalyzer: &#123;</span><br><span class="line">          plugin: <span class="built_in">require</span>(<span class="string">"webpack-bundle-analyzer"</span>).BundleAnalyzerPlugin,</span><br><span class="line">          args: [&#123; <span class="attr">analyzerPort</span>: <span class="number">9999</span> &#125;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//第二种方式添加</span></span><br><span class="line">    <span class="comment">/*config</span></span><br><span class="line"><span class="comment">      .plugin("webpack-bundle-analyzer")</span></span><br><span class="line"><span class="comment">      .use(require("webpack-bundle-analyzer").BundleAnalyzerPlugin, [</span></span><br><span class="line"><span class="comment">        &#123; analyzerPort: 9900 &#125;</span></span><br><span class="line"><span class="comment">      ]);*/</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>其实<code>umi</code>默认加载了<code>webpack-bundle-analyzer</code>插件，只需要在<code>.env</code>文件中添加</p><figure class="highlight javascript"><figcaption><span>.env</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ANALYZE = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>就可以启用打包分析了。其他的更多配置可以参考一下 <a href="https://umijs.org/zh/guide/env-variables.html#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">umi 官网的<code>.env</code>配置</a>。</p><h3 id="umi-和-dva-架构对比"><a href="#umi-和-dva-架构对比" class="headerlink" title="umi 和 dva 架构对比"></a>umi 和 dva 架构对比</h3><p>dva 项目之前通常都是这种扁平的组织方式，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ models</span><br><span class="line">  - global.js</span><br><span class="line">  - a1.js</span><br><span class="line">  - a2.js</span><br><span class="line">  - b.js</span><br><span class="line">+ services</span><br><span class="line">  - a.js</span><br><span class="line">  - b.js</span><br><span class="line">+ routes</span><br><span class="line">  - PageA.js</span><br><span class="line">  - PageB.js</span><br></pre></td></tr></table></figure><p>用了 umi 后，可以按页面维度进行组织，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ models/global.js</span><br><span class="line">+ pages</span><br><span class="line">  + a</span><br><span class="line">    - index.js</span><br><span class="line">    + models</span><br><span class="line">      - a1.js</span><br><span class="line">      - a2.js</span><br><span class="line">    + services</span><br><span class="line">      - a.js</span><br><span class="line">  + b</span><br><span class="line">    - index.js</span><br><span class="line">    - model.js</span><br><span class="line">    - service.js</span><br></pre></td></tr></table></figure><p>好处是更加结构更加清晰了，减少耦合，一删全删，方便 copy 和共享。</p><blockquote><p>参考链接</p></blockquote><p><a href="https://dvajs.com/guide/" target="_blank" rel="noopener">dva 官网</a><br><a href="https://umijs.org/zh/config/#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">umi 配置</a><br><a href="https://github.com/sorrycc/blog/issues/66" target="_blank" rel="noopener">umi 和 dva 更配</a><br><a href="https://github.com/neutrinojs/webpack-chain" target="_blank" rel="noopener">webpack-chain</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;umi&lt;/code&gt;和&lt;code&gt;dva&lt;/code&gt;都是阿里出的简化&lt;code&gt;react&lt;/code&gt;开发的架构，以前都是直接开发的没使用这套，后来接触下来以后发现，开发感觉挺舒适的，刚开始使用的&lt;code&gt;dva&lt;/code&gt;，有一个缺陷就是基于&lt;code&gt;roadhog&lt;/code&gt;搭建的&lt;code&gt;webpack&lt;/code&gt;架子，给我们自定义的接口实在有限,后来&lt;code&gt;umi&lt;/code&gt;加入了&lt;code&gt;webpack-chain&lt;/code&gt;可以自己添加、修改&lt;code&gt;webpack&lt;/code&gt;的配置，值得一试。&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.tiankai.party/categories/javascript/"/>
    
    
      <category term="umi" scheme="http://www.tiankai.party/tags/umi/"/>
    
      <category term="dva" scheme="http://www.tiankai.party/tags/dva/"/>
    
  </entry>
  
  <entry>
    <title>js中的事件执行机制</title>
    <link href="http://www.tiankai.party/posts/37168/"/>
    <id>http://www.tiankai.party/posts/37168/</id>
    <published>2018-11-15T08:58:00.000Z</published>
    <updated>2019-01-04T09:30:09.392Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>以前理解的事件只有同步任务和异步任务，后来知道我看到了一篇文章。。。<br>我们常见到的是这样的给你一段代码，说出执行顺序，</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"异步任务setTimeout"</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"同步任务"</span>);</span><br></pre></td></tr></table></figure><p>按照同步优先，异步靠后的规则，先执行完所有的同步任务后，再开始执行异步任务，很快的得出结论</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">同步任务</span><br><span class="line">异步任务setTimeout</span><br></pre></td></tr></table></figure><p>然后有一天你看到了这样的代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"setTimeout"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"同步任务"</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"promise"</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"promise-then"</span>));</span><br></pre></td></tr></table></figure><p><strong>黑人问号脸.jpg</strong><br>这就有点触及到我的知识盲区了。。。</p><p>先上答案</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">同步任务;</span><br><span class="line">promise;</span><br><span class="line">promise - then;</span><br><span class="line">setTimeout;</span><br></pre></td></tr></table></figure><h3 id="微任务-amp-amp-宏任务"><a href="#微任务-amp-amp-宏任务" class="headerlink" title="微任务 &amp;&amp; 宏任务"></a>微任务 &amp;&amp; 宏任务</h3><p>这里其实有个概念我们没认识就是微任务和宏任务，javascript 是一门单线程的语言，除了广义的同步任务和异步任务，我们对任务有更精细的定义：</p><ul><li>macro-task(宏任务)：包括整体代码 script，setTimeout，setInterval</li><li>micro-task(微任务)：Promise，process.nextTick(nodejs)</li></ul><p>js 的事件循环是这样的，进入后，进行宏任务事件循环，遇到宏任务异步代码，压入宏任务异步任务栈等待执行，遇到微任务异步压入微任务的异步任务栈等待执行，在完成第一次宏任务循环后，先查看微任务异步栈中有没有任务，如果有先执行所有的异步微任务，然后再开始第二次的宏任务循环，开始执行宏任务的异步任务。<br>我们跟着文章开始的代码来走一遍：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"setTimeout"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"同步任务"</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"promise"</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"promise-then"</span>));</span><br></pre></td></tr></table></figure><ul><li>第一次宏任务循环，遇到<code>setTimeout</code>，压入宏任务的异步栈，等待执行</li><li>继续遇到 <code>console.log</code> 执行 输出 <code>同步任务</code></li><li>遇到<code>Promise</code>，并且<code>resolve</code>直接输出<code>promise</code></li><li><code>Promise</code>的<code>then</code>压入微任务的异步栈等待执行</li><li>第一次宏任务循环结束，查看是否有微任务，执行<code>then</code>操作，输出<code>promise-then</code></li><li>开始第二次宏任务循环，在异步栈中发现了<code>setTimeout</code>，输出<code>setTimeout</code></li></ul><p>总结来说就是，先进行同步宏任务，宏任务完成后先查看一下是否有<code>prmise</code>之类的微任务，执行完微任务后再执行宏任务的异步任务。<br>我们一起来走一下这个例子看看是否已经搞懂了事件执行机制</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"1"</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"2"</span>);</span><br><span class="line">  process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"3"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"4"</span>);</span><br><span class="line">    resolve();</span><br><span class="line">  &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"5"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"6"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"7"</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"8"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"9"</span>);</span><br><span class="line">  process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"10"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"11"</span>);</span><br><span class="line">    resolve();</span><br><span class="line">  &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"12"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>事件开始执行，遇到 <code>console.log</code> 直接输出<code>1</code></li><li>遇到 <code>setTimeout</code> 压入宏任务异步栈等待执行</li><li>遇到<code>process.nextTick</code>压入微任务异步栈等待执行</li><li>遇到<code>Promise</code>,直接输出<code>7</code>，并且已经<code>resolve</code>，那么对应的<code>then</code>压入微任务异步栈等待执行</li><li>遇到<code>setTimeout</code>压入宏任务异步栈，这里标记为<code>setTimeout2</code></li><li>第一次宏任务事件结束，我们来查看一下事件栈，是否有微任务，如果有先执行</li></ul><table><thead><tr><th>宏任务异步栈</th><th>微任务异步栈</th></tr></thead><tbody><tr><td>setTimeout</td><td>process.nextTick</td></tr><tr><td>setTimeout2</td><td>promise.then</td></tr></tbody></table><ul><li><p>执行微任务异步栈，执行<code>process.nextTick</code>输出<code>6</code>,然后再执行 <code>promise.then</code>，输入<code>8</code></p></li><li><p>这样在第一次事件循环结束后，输出了<code>1</code>/<code>7</code>/<code>6</code>/<code>8</code></p></li><li><p>开始第二次的事件循环</p></li><li><p>执行<code>setTimeout</code>遇到<code>console</code>直接执行，输出<code>2</code>,遇到<code>process.nextTick</code>压入微任务异步栈</p></li><li><p>遇到<code>promise</code>,执行<code>console</code>输出<code>4</code>,并且已经<code>resolve</code>执行，将<code>then</code>压入微任务异步栈</p></li><li><p>这一次的宏任务事件执行结束查看一下是否微任务异步栈，是否有微任务等待执行</p></li></ul><table><thead><tr><th>宏任务异步栈</th><th>微任务异步栈</th></tr></thead><tbody><tr><td>setTimeout2</td><td>process.nextTick</td></tr><tr><td>空</td><td>promise.then</td></tr></tbody></table><ul><li><p>执行微任务异步栈，<code>process.nextTick</code>输出<code>3</code>,执行<code>promise.then</code>输出<code>5</code></p></li><li><p>第二次事件循环结束后，输出了<code>2</code>/<code>4</code>/<code>3</code>/<code>5</code></p></li><li><p>开始第三次宏任务事件</p></li><li><p><code>setTimeout2</code>中遇到<code>console</code>直接输出<code>9</code>,<code>process.nextTick</code>压入微任务异步栈等待执行</p></li><li><p>遇到<code>Promise</code>直接执行，输出<code>11</code>,已经<code>resolve</code>了把<code>then</code>代码压入微任务异步栈等待执行</p></li><li><p>这一次的宏任务事件执行结束查看一下是否微任务异步栈，是否有微任务等待执行</p></li></ul><table><thead><tr><th>宏任务异步栈</th><th>微任务异步栈</th></tr></thead><tbody><tr><td>空</td><td>process.nextTick</td></tr><tr><td>空</td><td>promise.then</td></tr></tbody></table><ul><li><p>执行<code>process.nextTick</code>输出<code>10</code>,执行<code>promise.then</code>输出<code>12</code></p></li><li><p>这一次事件循环结束后，输出<code>9</code>/<code>11</code>/<code>10</code>/<code>12</code></p></li><li>这样三次事件循环下来，依次输出了<code>1</code>/<code>7</code>/<code>6</code>/<code>8</code>/<code>2</code>/<code>4</code>/<code>3</code>/<code>5</code>/<code>9</code>/<code>11</code>/<code>10</code>/<code>12</code></li></ul><p>值得深思：</p><ol><li><code>setInterval(fn,ms)</code>来说，我们已经知道不是每过<code>ms</code>秒会执行一次<code>fn</code>，而是每过<code>m</code>s 秒，会有<code>fn</code>进入<code>Event Queue</code>。一旦<code>setInterval</code>的回调函数<code>fn</code>执行时间超过了延迟时间<code>ms</code>，那么就完全看不出来有时间间隔了</li><li><code>setTimeout(fn,0)</code>的含义是，指定某个任务在主线程最早可得的空闲时间执行，意思就是不用再等多少秒了，只要主线程执行栈内的同步任务全部执行完成，栈为空就马上执行</li></ol><blockquote><p>参考链接</p></blockquote><p><a href="https://juejin.im/post/59e85eebf265da430d571f89" target="_blank" rel="noopener">这一次彻底弄懂 JavaScript 执行机制</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;以前理解的事件只有同步任务和异步任务，后来知道我看到了一篇文章。。。&lt;br&gt;我们常见到的是这样的给你一段代码，说出执行顺序，&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;setTimeout(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&quot;异步任务setTimeout&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;, &lt;span class=&quot;number&quot;&gt;3000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&quot;同步任务&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;按照同步优先，异步靠后的规则，先执行完所有的同步任务后，再开始执行异步任务，很快的得出结论&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.tiankai.party/categories/javascript/"/>
    
    
      <category term="js" scheme="http://www.tiankai.party/tags/js/"/>
    
      <category term="promise" scheme="http://www.tiankai.party/tags/promise/"/>
    
      <category term="setTimeout" scheme="http://www.tiankai.party/tags/setTimeout/"/>
    
  </entry>
  
  <entry>
    <title>使用eslint来规范你的代码</title>
    <link href="http://www.tiankai.party/posts/42946/"/>
    <id>http://www.tiankai.party/posts/42946/</id>
    <published>2018-10-30T14:30:00.000Z</published>
    <updated>2019-01-07T03:47:04.688Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>使用自定义的<code>eslint</code>规则结合编辑器来规范你平时的代码编写风格，我这里配置了 <code>vscode</code> 和 <code>webstorm</code> 俩个编辑器的 在校验规则的同时，可以自动把你的代码格式化。如果你的电脑配置可以的话建议你使用<code>webstorm</code>，虽然<code>vscode</code>可以任意安装插件，但是论功能的完善还是<code>webstorm</code>更甚一筹</p><a id="more"></a><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>全局安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g eslint</span><br><span class="line">npm install -g prettier</span><br><span class="line">npm install -g eslint-plugin-prettier</span><br></pre></td></tr></table></figure><p>react 相关</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install -g babel-eslint</span><br><span class="line">npm install -g eslint-plugin-react</span><br><span class="line">npm install -g eslint-plugin-jsx-a11y</span><br><span class="line">npm install -g eslint-plugin-import</span><br></pre></td></tr></table></figure><h3 id="编辑自己的eslint规则"><a href="#编辑自己的eslint规则" class="headerlink" title="编辑自己的eslint规则"></a>编辑自己的<code>eslint</code>规则</h3><figure class="highlight javascript"><figcaption><span>.eslintrc.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    <span class="comment">// 检查 ES6 语法</span></span><br><span class="line">    ecmaVersion: <span class="number">6</span>,</span><br><span class="line">    sourceType: <span class="string">"module"</span>,</span><br><span class="line">    ecmaFeatures: &#123;</span><br><span class="line">      experimentalObjectRestSpread: <span class="literal">true</span>,</span><br><span class="line">      jsx: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  parser: <span class="string">"babel-eslint"</span>,</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    node: <span class="literal">true</span>,</span><br><span class="line">    es6: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// extending airbnb config and config derived from eslint-config-prettier</span></span><br><span class="line">  <span class="comment">// 这里是 vue</span></span><br><span class="line">  <span class="comment">//extends: ["plugin:vue/essential", "airbnb-base", "prettier"],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 选择 eslint 插件</span></span><br><span class="line">  <span class="comment">//plugins: ["prettier", "vue"],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// react</span></span><br><span class="line">  extends: [<span class="string">"prettier"</span>, <span class="string">"eslint:recommended"</span>, <span class="string">"plugin:react/recommended"</span>],</span><br><span class="line">  plugins: [<span class="string">"prettier"</span>, <span class="string">"react"</span>, <span class="string">"jsx-a11y"</span>],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不需要框架</span></span><br><span class="line">  <span class="comment">// extends: ['airbnb-base', 'prettier'],</span></span><br><span class="line">  <span class="comment">// plugins: ['prettier'],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 自定义 eslint 检查规则</span></span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">//箭头函数前后俩个空格</span></span><br><span class="line">    <span class="string">"arrow-spacing"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        before: <span class="literal">true</span>,</span><br><span class="line">        after: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//大括号前后有空格</span></span><br><span class="line">    <span class="string">"block-spacing"</span>: [<span class="number">2</span>, <span class="string">"always"</span>],</span><br><span class="line">    <span class="comment">//规定 else 关键字 要与花括号保持在同一行</span></span><br><span class="line">    <span class="string">"brace-style"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      <span class="string">"1tbs"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        allowSingleLine: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// react 如果在项目中文件名后缀是 .js 而不是 .jsx 避免报错</span></span><br><span class="line">    <span class="string">"react/jsx-filename-extension"</span>: [</span><br><span class="line">      <span class="number">1</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        extensions: [<span class="string">".js"</span>, <span class="string">".jsx"</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//react props validation 错误</span></span><br><span class="line">    <span class="string">"react/prop-types"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"no-eval"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"no-console"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"comma-dangle"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="comment">//规定逗号后面必须加空格</span></span><br><span class="line">    <span class="string">"comma-spacing"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        before: <span class="literal">false</span>,</span><br><span class="line">        after: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定子类构造函数中必须调用super，非子类不要调用super。</span></span><br><span class="line">    <span class="string">"constructor-super"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定避免不必要的 .call() 和 .apply()</span></span><br><span class="line">    <span class="string">"no-useless-call"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="comment">//规定不要定义未使用的变量</span></span><br><span class="line">    <span class="string">"no-unused-vars"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        vars: <span class="string">"all"</span>,</span><br><span class="line">        args: <span class="string">"none"</span>,</span><br><span class="line">        ignoreRestSiblings: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//"no-useless-constructor": "error"</span></span><br><span class="line">    <span class="string">"no-useless-constructor"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="comment">//规定点号操作符须与属性需在同一行</span></span><br><span class="line">    <span class="string">"dot-location"</span>: [<span class="number">2</span>, <span class="string">"property"</span>],</span><br><span class="line">    <span class="comment">//使用一致的缩进</span></span><br><span class="line">    <span class="comment">/* 'indent': [2, 2, &#123;</span></span><br><span class="line"><span class="comment">     *     'SwitchCase': 1</span></span><br><span class="line"><span class="comment">     * &#125;], */</span></span><br><span class="line">    <span class="comment">//规定键值对中冒号与值之间要留空白</span></span><br><span class="line">    <span class="string">"key-spacing"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        beforeColon: <span class="literal">false</span>,</span><br><span class="line">        afterColon: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//关键字前后实用一致的间距</span></span><br><span class="line">    <span class="string">"keyword-spacing"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        before: <span class="literal">true</span>,</span><br><span class="line">        after: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"new-cap"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        newIsCap: <span class="literal">true</span>,</span><br><span class="line">        capIsNew: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定多行 if 语句的 括号不能省略</span></span><br><span class="line">    curly: [<span class="number">2</span>, <span class="string">"multi-line"</span>],</span><br><span class="line">    <span class="comment">//规定文件末尾空一行，以防文件解析错误</span></span><br><span class="line">    <span class="string">"eol-last"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="comment">//规定函数调用时标识符与括号间不留间隔。第二个参数取值“never”和“always”，"never"表不留空格，"always"表要留空格</span></span><br><span class="line">    <span class="string">"func-call-spacing"</span>: [<span class="number">2</span>, <span class="string">"never"</span>],</span><br><span class="line">    <span class="comment">//规定不能混合使用空格与制表符做为缩进</span></span><br><span class="line">    <span class="string">"no-mixed-spaces-and-tabs"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定除了缩进，不要使用多个空格</span></span><br><span class="line">    <span class="string">"no-multi-spaces"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不允许有连续多行空行且文件头部不允许空行</span></span><br><span class="line">    <span class="string">"no-multiple-empty-lines"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        max: <span class="number">1</span>,</span><br><span class="line">        maxEOF: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定行末不留空格。</span></span><br><span class="line">    <span class="string">"no-trailing-spaces"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定属性前面不能加空格</span></span><br><span class="line">    <span class="string">"no-whitespace-before-property"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定对象属性换行时注意统一代码风格(要么都换行，要么都不换)。</span></span><br><span class="line">    <span class="string">"object-property-newline"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        allowMultiplePropertiesPerLine: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定对于三元运算符 ? 和 : 与他们所负责的代码处于同一行</span></span><br><span class="line">    <span class="comment">/* "operator-linebreak": [2, "after", &#123;</span></span><br><span class="line"><span class="comment">     *     "overrides": &#123;</span></span><br><span class="line"><span class="comment">     *         "?": "before",</span></span><br><span class="line"><span class="comment">     *         ":": "before"</span></span><br><span class="line"><span class="comment">     *     &#125;</span></span><br><span class="line"><span class="comment">     * &#125;], */</span></span><br><span class="line">    <span class="comment">//规则定义代码中不要出现多余留白,“blocks”表代码块，“classes”表类，“switches”表switch语句，取值都为“never”或“always”，表示是否需要留空行.</span></span><br><span class="line">    <span class="string">"padded-blocks"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        blocks: <span class="string">"never"</span>,</span><br><span class="line">        switches: <span class="string">"never"</span>,</span><br><span class="line">        classes: <span class="string">"never"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定展开运算符与它的表达式间不要留空白。第二个参数取值“never”和“always”，表是否需要留白。</span></span><br><span class="line">    <span class="string">"rest-spread-spacing"</span>: [<span class="number">2</span>, <span class="string">"never"</span>],</span><br><span class="line">    <span class="comment">//规定分号前不留空格，后面留一个空格。</span></span><br><span class="line">    <span class="string">"semi-spacing"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        before: <span class="literal">false</span>,</span><br><span class="line">        after: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定必须添加分号</span></span><br><span class="line">    semi: [<span class="string">"error"</span>, <span class="string">"always"</span>],</span><br><span class="line">    <span class="comment">//规定代码块收尾需留空格。</span></span><br><span class="line">    <span class="string">"space-before-blocks"</span>: [<span class="number">2</span>, <span class="string">"always"</span>],</span><br><span class="line">    <span class="comment">//规定圆括号之间不留空格</span></span><br><span class="line">    <span class="string">"space-in-parens"</span>: [<span class="number">2</span>, <span class="string">"never"</span>],</span><br><span class="line">    <span class="comment">//规定字符串拼接操作符 (Infix operators) 之间要留空格</span></span><br><span class="line">    <span class="string">"space-infix-ops"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定get和set成对出现</span></span><br><span class="line">    <span class="string">"accessor-pairs"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不允许多余的行末逗号。</span></span><br><span class="line">    <span class="string">"comma-dangle"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        arrays: <span class="string">"never"</span>,</span><br><span class="line">        objects: <span class="string">"never"</span>,</span><br><span class="line">        imports: <span class="string">"never"</span>,</span><br><span class="line">        exports: <span class="string">"never"</span>,</span><br><span class="line">        functions: <span class="string">"never"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定始终将逗号置于行末。</span></span><br><span class="line">    <span class="string">"comma-style"</span>: [<span class="number">2</span>, <span class="string">"last"</span>],</span><br><span class="line">    <span class="comment">//规定始终使用 === 替代 ==，null除外。第二个参数配置是否使用 === ，第三个参数配置是否忽略空值判断。(这里暂时是 warning 状态)</span></span><br><span class="line">    eqeqeq: [</span><br><span class="line">      <span class="number">1</span>,</span><br><span class="line">      <span class="string">"always"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="literal">null</span>: <span class="string">"ignore"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定函数里面的异常信息不要忘记处理。第二个参数配置匹配那些参数的正则表达式.</span></span><br><span class="line">    <span class="string">"handle-callback-err"</span>: [<span class="string">"error"</span>, <span class="string">"^(err|error)$"</span>],</span><br><span class="line">    <span class="comment">//规定避免修改使用 const 声明的变量。</span></span><br><span class="line">    <span class="string">"no-const-assign"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定避免对类名重新赋值。</span></span><br><span class="line">    <span class="string">"no-class-assign"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定使用数组字面量而不是构造器</span></span><br><span class="line">    <span class="string">"no-array-constructor"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定无参的构造函数调用时要带上括号</span></span><br><span class="line">    <span class="string">"new-parens"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要对变量使用 delete 操作。(waring)</span></span><br><span class="line">    <span class="string">"no-delete-var"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="comment">//规定不要定义重复的函数参数</span></span><br><span class="line">    <span class="string">"no-dupe-args"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定类中不要定义重复的属性</span></span><br><span class="line">    <span class="string">"no-dupe-class-members"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定对象字面量中不要定义重复的属性</span></span><br><span class="line">    <span class="string">"no-dupe-keys"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定switch 语句中不要定义重复的 case 分支</span></span><br><span class="line">    <span class="string">"no-duplicate-case"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定正则中不要使用空字符。</span></span><br><span class="line">    <span class="string">"no-empty-character-class"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要解构空值</span></span><br><span class="line">    <span class="string">"no-empty-pattern"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//定义catch 中不要对错误重新赋值</span></span><br><span class="line">    <span class="string">"no-ex-assign"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定switch一定要使用 break 来将条件分支正常中断</span></span><br><span class="line">    <span class="string">"no-fallthrough"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定避免对声明过的函数重新赋值</span></span><br><span class="line">    <span class="string">"no-func-assign"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要对全局只读对象重新赋值</span></span><br><span class="line">    <span class="string">"no-global-assign"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要向 RegExp 构造器传入非法的正则表达式。</span></span><br><span class="line">    <span class="string">"no-invalid-regexp"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定禁止使用 iterator。</span></span><br><span class="line">    <span class="string">"no-iterator"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定避免将变量赋值给自己</span></span><br><span class="line">    <span class="string">"no-self-assign"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定避免将变量与自己进行比较</span></span><br><span class="line">    <span class="string">"no-self-compare"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定禁止随意更改关键字的值</span></span><br><span class="line">    <span class="string">"no-shadow-restricted-names"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定禁止使用稀疏数组</span></span><br><span class="line">    <span class="string">"no-sparse-arrays"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定正确使用 ES6 中的字符串模板</span></span><br><span class="line">    <span class="string">"no-template-curly-in-string"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定用throw 抛错时，抛出 Error 对象而不是字符串。</span></span><br><span class="line">    <span class="string">"no-throw-literal"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要使用 (, [, or ` 等作为一行的开始。在没有分号的情况下代码压缩后会导致报错，而坚持这一规范则可避免出错。</span></span><br><span class="line">    <span class="string">"no-unexpected-multiline"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定循环语句中注意更新循环变量</span></span><br><span class="line">    <span class="string">"no-unmodified-loop-condition"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定return，throw，continue 和 break 后不要再跟代码。</span></span><br><span class="line">    <span class="string">"no-unreachable"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定finally 代码块中不要再改变程序执行流程</span></span><br><span class="line">    <span class="string">"no-unsafe-finally"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定未定义前不能使用</span></span><br><span class="line">    <span class="string">"no-use-before-define"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        functions: <span class="literal">false</span>,</span><br><span class="line">        classes: <span class="literal">false</span>,</span><br><span class="line">        variables: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定禁止无用的表达式。</span></span><br><span class="line">    <span class="string">"no-unused-expressions"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        allowShortCircuit: <span class="literal">true</span>,</span><br><span class="line">        allowTernary: <span class="literal">true</span>,</span><br><span class="line">        allowTaggedTemplates: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定禁止在正则表达式中使用控制字符</span></span><br><span class="line">    <span class="string">"no-control-regex"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定避免使用 arguments.callee 和 arguments.caller</span></span><br><span class="line">    <span class="string">"no-caller"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定条件语句中赋值语句使用括号包起来。</span></span><br><span class="line">    <span class="string">"no-cond-assign"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要使用 debugger。</span></span><br><span class="line">    <span class="string">"no-debugger"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要扩展原生对象。</span></span><br><span class="line">    <span class="string">"no-extend-native"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定避免不必要的布尔转换。</span></span><br><span class="line">    <span class="string">"no-extra-boolean-cast"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定避免多余的函数上下文绑定</span></span><br><span class="line">    <span class="string">"no-extra-bind"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要使用多余的括号包裹函数</span></span><br><span class="line">    <span class="string">"no-extra-parens"</span>: [<span class="number">2</span>, <span class="string">"functions"</span>],</span><br><span class="line">    <span class="comment">//规定不要省去小数点前面的0（增强可读性）</span></span><br><span class="line">    <span class="string">"no-floating-decimal"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定避免使用隐式的 eval()。</span></span><br><span class="line">    <span class="string">"no-implied-eval"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定嵌套的代码块中禁止再定义函数</span></span><br><span class="line">    <span class="string">"no-inner-declarations"</span>: [<span class="number">2</span>, <span class="string">"functions"</span>],</span><br><span class="line">    <span class="comment">//规定不要使用非法的空白符</span></span><br><span class="line">    <span class="string">"no-irregular-whitespace"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要使用标签语句</span></span><br><span class="line">    <span class="string">"no-labels"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        allowLoop: <span class="literal">false</span>,</span><br><span class="line">        allowSwitch: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定不要书写不必要的嵌套代码块</span></span><br><span class="line">    <span class="string">"no-lone-blocks"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要使用多行字符串</span></span><br><span class="line">    <span class="string">"no-multi-str"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定new 创建对象实例后需要赋值给变量</span></span><br><span class="line">    <span class="string">"no-new"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定禁止使用 Function 构造器</span></span><br><span class="line">    <span class="string">"no-new-func"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定禁止使用 Object 构造器</span></span><br><span class="line">    <span class="string">"no-new-object"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定禁止使用 new require</span></span><br><span class="line">    <span class="string">"no-new-require"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定禁止使用 Symbol 构造器</span></span><br><span class="line">    <span class="string">"no-new-symbol"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定禁止使用原始包装器</span></span><br><span class="line">    <span class="string">"no-new-wrappers"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要将全局对象的属性作为函数调用</span></span><br><span class="line">    <span class="string">"no-obj-calls"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要使用八进制字面量</span></span><br><span class="line">    <span class="string">"no-octal"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定不要重复声明变量</span></span><br><span class="line">    <span class="string">"no-redeclare"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//规定return 语句中的赋值必需有括号包裹</span></span><br><span class="line">    <span class="string">"no-return-assign"</span>: [<span class="number">2</span>, <span class="string">"except-parens"</span>],</span><br><span class="line">    <span class="comment">//规定如果有更好的实现，尽量不要使用三元表达式</span></span><br><span class="line">    <span class="string">"no-unneeded-ternary"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        defaultAssignment: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//规定不要使用 undefined 来初始化变量。</span></span><br><span class="line">    <span class="string">"no-undef-init"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"jsx-quotes"</span>: [<span class="number">1</span>, <span class="string">"prefer-double"</span>], <span class="comment">//强制在JSX属性（jsx-quotes）中一致使用双引号</span></span><br><span class="line">    <span class="string">"react/display-name"</span>: <span class="number">0</span>, <span class="comment">//防止在React组件定义中丢失displayName</span></span><br><span class="line">    <span class="string">"react/forbid-prop-types"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        forbid: [<span class="string">"any"</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ], <span class="comment">//禁止某些propTypes</span></span><br><span class="line">    <span class="string">"react/jsx-boolean-value"</span>: <span class="number">2</span>, <span class="comment">//在JSX中强制布尔属性符号</span></span><br><span class="line">    <span class="string">"react/jsx-closing-bracket-location"</span>: <span class="number">1</span>, <span class="comment">//在JSX中验证右括号位置</span></span><br><span class="line">    <span class="string">"react/jsx-curly-spacing"</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        when: <span class="string">"never"</span>,</span><br><span class="line">        children: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ], <span class="comment">//在JSX属性和表达式中加强或禁止大括号内的空格。</span></span><br><span class="line">    <span class="string">"react/jsx-indent-props"</span>: [<span class="number">2</span>, <span class="number">2</span>], <span class="comment">//验证JSX中的props缩进</span></span><br><span class="line">    <span class="string">"react/jsx-key"</span>: <span class="number">2</span>, <span class="comment">//在数组或迭代器中验证JSX具有key属性</span></span><br><span class="line">    <span class="string">"react/jsx-max-props-per-line"</span>: [</span><br><span class="line">      <span class="number">1</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        maximum: <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    ], <span class="comment">// 限制JSX中单行上的props的最大数量</span></span><br><span class="line">    <span class="string">"react/jsx-no-bind"</span>: <span class="number">0</span>, <span class="comment">//JSX中不允许使用箭头函数和bind</span></span><br><span class="line">    <span class="string">"react/jsx-no-duplicate-props"</span>: <span class="number">2</span>, <span class="comment">//防止在JSX中重复的props</span></span><br><span class="line">    <span class="string">"react/jsx-no-literals"</span>: <span class="number">0</span>, <span class="comment">//防止使用未包装的JSX字符串</span></span><br><span class="line">    <span class="string">"react/jsx-no-undef"</span>: <span class="number">1</span>, <span class="comment">//在JSX中禁止未声明的变量</span></span><br><span class="line">    <span class="string">"react/jsx-pascal-case"</span>: <span class="number">0</span>, <span class="comment">//为用户定义的JSX组件强制使用PascalCase</span></span><br><span class="line">    <span class="string">"react/jsx-sort-props"</span>: <span class="number">0</span>, <span class="comment">//强化props按字母排序</span></span><br><span class="line">    <span class="string">"react/jsx-uses-react"</span>: <span class="number">1</span>, <span class="comment">//防止反应被错误地标记为未使用</span></span><br><span class="line">    <span class="string">"react/jsx-uses-vars"</span>: <span class="number">2</span>, <span class="comment">//防止在JSX中使用的变量被错误地标记为未使用</span></span><br><span class="line">    <span class="string">"react/no-danger"</span>: <span class="number">0</span>, <span class="comment">//防止使用危险的JSX属性</span></span><br><span class="line">    <span class="string">"react/no-did-mount-set-state"</span>: <span class="number">0</span>, <span class="comment">//防止在componentDidMount中使用setState</span></span><br><span class="line">    <span class="string">"react/no-did-update-set-state"</span>: <span class="number">1</span>, <span class="comment">//防止在componentDidUpdate中使用setState</span></span><br><span class="line">    <span class="string">"react/no-direct-mutation-state"</span>: <span class="number">2</span>, <span class="comment">//防止this.state的直接变异</span></span><br><span class="line">    <span class="string">"react/no-multi-comp"</span>: <span class="number">1</span>, <span class="comment">//防止每个文件有多个组件定义</span></span><br><span class="line">    <span class="string">"react/no-set-state"</span>: <span class="number">0</span>, <span class="comment">//防止使用setState</span></span><br><span class="line">    <span class="string">"react/no-unknown-property"</span>: <span class="number">2</span>, <span class="comment">//防止使用未知的DOM属性</span></span><br><span class="line">    <span class="string">"react/prefer-es6-class"</span>: <span class="number">2</span>, <span class="comment">//为React组件强制执行ES5或ES6类</span></span><br><span class="line">    <span class="string">"react/prop-types"</span>: <span class="number">0</span>, <span class="comment">//防止在React组件定义中丢失props验证</span></span><br><span class="line">    <span class="string">"react/react-in-jsx-scope"</span>: <span class="number">2</span>, <span class="comment">//使用JSX时防止丢失React</span></span><br><span class="line">    <span class="string">"react/self-closing-comp"</span>: <span class="number">0</span>, <span class="comment">//防止没有children的组件的额外结束标签</span></span><br><span class="line">    <span class="string">"react/sort-comp"</span>: <span class="number">2</span>, <span class="comment">//强制组件方法顺序</span></span><br><span class="line">    <span class="string">"no-extra-boolean-cast"</span>: <span class="number">0</span>, <span class="comment">//禁止不必要的bool转换</span></span><br><span class="line">    <span class="string">"react/no-array-index-key"</span>: <span class="number">0</span>, <span class="comment">//防止在数组中遍历中使用数组key做索引</span></span><br><span class="line">    <span class="string">"react/no-deprecated"</span>: <span class="number">1</span>, <span class="comment">//不使用弃用的方法</span></span><br><span class="line">    <span class="string">"react/jsx-equals-spacing"</span>: <span class="number">2</span>, <span class="comment">//在JSX属性中强制或禁止等号周围的空格</span></span><br><span class="line">    <span class="string">"import/imports-first"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"import/newline-after-import"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"import/no-dynamic-require"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"import/no-extraneous-dependencies"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"import/no-named-as-default"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"import/no-unresolved"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"import/prefer-default-export"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"import/extensions"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"jsx-a11y/aria-props"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"jsx-a11y/heading-has-content"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"jsx-a11y/href-no-hash"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"jsx-a11y/label-has-for"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"jsx-a11y/mouse-events-have-key-events"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"jsx-a11y/role-has-required-aria-props"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"jsx-a11y/role-supports-aria-props"</span>: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="vscode"><a href="#vscode" class="headerlink" title="vscode"></a>vscode</h3><ul><li>安装 <code>eslint</code>/<code>prettier</code> 插件</li><li>打开 <code>文件 --- 首选项 --- 设置 --- 在 settings.json 中 编辑</code></li></ul><figure class="highlight javascript"><figcaption><span>settings.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"editor.formatOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"prettier.eslintIntegration"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"eslint.autoFixOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"eslint.options"</span>: &#123;<span class="comment">//路径指向自定义的 eslint 规则</span></span><br><span class="line"><span class="string">"eslintConfig"</span>: <span class="string">"c:/Users/TK/.eslintrc.js"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"javascript.format.enable"</span>: <span class="literal">false</span></span><br></pre></td></tr></table></figure><blockquote><p>tips： 在编辑 react 文件的时候 vscode 需要把右下角的解析器 <code>Javascript(Babel)</code> 改为 <code>JavaScript React</code>,这样在保存的时候格式才不会乱</p></blockquote><h3 id="webstorm"><a href="#webstorm" class="headerlink" title="webstorm"></a>webstorm</h3><p>相较于<code>vscode</code>来说<code>webstorm</code>的配置就有点复杂了。</p><h4 id="第一步："><a href="#第一步：" class="headerlink" title="第一步："></a>第一步：</h4><p>编辑器安装<code>eslint</code> 和 <code>pretteir</code> 插件</p><ul><li>WebStorm 2018.1 和以上的版本</li><li>Webstorm 2017.3 和更早的版本</li></ul><blockquote><p>Prettier</p></blockquote><ol><li>WebStorm 2018.1 和以上的版本</li></ol><ul><li>官方已经默认支持了 <code>prettier</code>,可以在<code>File --- settings --- Languages &amp; Frameworks --- JavaScript --- Prettier</code> 中找到，找到后需要配置一下。</li><li><code>Node interpreter</code> — 找到你安装的 <code>node.exe</code> 的目录。<ul><li>eg: <code>C:\Pragram Files\nodejs\node.exe</code></li></ul></li><li><p><code>Prettier package</code> — 找到你全局安装的 prettier 目录</p><ul><li>eg: <code>~\AppData\Roaming\npm\node_modules\prettier</code></li></ul></li></ul><ol start="2"><li>Webstorm 2017.3 和更早的版本这个没跟着配过，我的版本是 2018 的，这个是从官网扒下来的，文末有链接。</li></ol><ul><li>转到<code>首选项 | 工具 | 外部工具</code>,</li><li>然后单击<code>+</code>添加新工具。<code>Name</code>填写为 Prettier,</li><li><code>Programs</code> 填写全局安装的 <code>prettier.cmd</code><ul><li>eg： <code>C:\Users\user_name\AppData\Roaming\npm\prettier.cmd</code></li></ul></li><li><code>Parameters</code> 填写 <code>--write $FilePathRelativeToProjectRoot$</code></li><li><code>Working directory</code> 填写 <code>$ProjectFileDir$</code></li><li>按<code>Cmd/Ctrl-Shift-A</code>（查找操作），搜索<code>Prettier</code>，然后点击<code>Enter</code>。</li><li><code>prettier</code> 将针对当前文件运行</li></ul><blockquote><p>eslint</p></blockquote><p><code>eslint</code>没找以前的版本，直接找的 2018 的，感兴趣的可以去配一下，和<code>prettier</code>大同小异</p><ul><li>在<code>File --- settings --- Languages &amp; Frameworks --- JavaScript --- Code Quality Tools --- ESLint</code> 中找到配置<code>eslint</code></li><li><code>Node interpreter</code> — 找到你安装的 <code>node.exe</code> 的目录。<ul><li>eg: <code>C:\Pragram Files\nodejs\node.exe</code></li></ul></li><li><code>ESLint package</code> — 找到你全局安装的 prettier 目录<ul><li>eg: <code>~\AppData\Roaming\npm\node_modules\eslint</code></li></ul></li><li><code>Configuration file</code> 中选择 <code>Configuration file</code> 找到你自己配置的<code>eslintrc.js</code>文件</li></ul><h4 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h4><p>配置 <code>Ctrl + s</code> 自动格式化代码</p><ol><li><code>Edit - Macros - Start Macros Recording</code></li><li>按住 <code>Ctrl-Shift-Alt-p</code> 然后 再按 <code>Ctrl-s</code></li><li>点击右下角的红色圆点停止录制宏，输入名字 eg: <code>prettier code and Save</code></li><li>打开设置 <code>File --- settings --- Keymap</code>,搜索刚刚保存的 宏的名字</li><li>双击 选择 <code>Add Keyboard Shortcut</code> 弹出框出来后 键盘上按 <code>Ctrl-S</code>,选择 <code>Remove</code></li><li>finish 完成了。</li></ol><blockquote><p>参考链接</p></blockquote><p><a href="https://prettier.io/docs/en/webstorm.html" target="_blank" rel="noopener">webstorm 配置 prettier</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用自定义的&lt;code&gt;eslint&lt;/code&gt;规则结合编辑器来规范你平时的代码编写风格，我这里配置了 &lt;code&gt;vscode&lt;/code&gt; 和 &lt;code&gt;webstorm&lt;/code&gt; 俩个编辑器的 在校验规则的同时，可以自动把你的代码格式化。如果你的电脑配置可以的话建议你使用&lt;code&gt;webstorm&lt;/code&gt;，虽然&lt;code&gt;vscode&lt;/code&gt;可以任意安装插件，但是论功能的完善还是&lt;code&gt;webstorm&lt;/code&gt;更甚一筹&lt;/p&gt;
    
    </summary>
    
      <category term="工具" scheme="http://www.tiankai.party/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="工具" scheme="http://www.tiankai.party/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>react拾遗</title>
    <link href="http://www.tiankai.party/posts/17411/"/>
    <id>http://www.tiankai.party/posts/17411/</id>
    <published>2018-10-23T06:39:00.000Z</published>
    <updated>2019-01-02T03:09:47.194Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>总结一些 react 中常见的面试题吧，同时也是让自己多学习学习 react 相关的知识。查漏补缺。</p><a id="more"></a><h3 id="组件的命名"><a href="#组件的命名" class="headerlink" title="组件的命名"></a>组件的命名</h3><p>基于路径命名的方式，举个例子，组件的路径如果是 <code>components/User/List.jsx</code>，那么它就被命名为 <code>UserList</code>。</p><h3 id=""><a href="#" class="headerlink" title="!!()"></a>!!()</h3><p>!!(a)的作用是将 a 强制转换为布尔类型</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">123</span>;</span><br><span class="line"><span class="built_in">console</span>.log(!!a); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(!!b); <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c = <span class="string">'null'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(!!c); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(!!d); <span class="comment">//false</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br></pre></td></tr></table></figure><h3 id="PureComponent"><a href="#PureComponent" class="headerlink" title="PureComponent"></a>PureComponent</h3><p><code>React.PureComponent</code> 相较于 <code>React.Component</code> 做了一个<code>shouldComponentupdate()</code>的浅比较，避免了重复更新</p><h3 id="props-和-state"><a href="#props-和-state" class="headerlink" title="props 和 state"></a>props 和 state</h3><p>props 更多的类似是 函数 的 参数<br>state 类似函数内部声明的变量，在函数内部使用，控制函数状态</p><h3 id="setState-的-callback"><a href="#setState-的-callback" class="headerlink" title="setState 的 callback()"></a>setState 的 callback()</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(&#123; <span class="attr">name</span>: <span class="string">"Tian"</span> &#125;, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>setState</code>是异步的，但是可以在回调函数中获取<code>setState</code>后的 <code>state</code></p><h3 id="HTML-和-React-中的事件处理有什么区别"><a href="#HTML-和-React-中的事件处理有什么区别" class="headerlink" title="HTML 和 React 中的事件处理有什么区别"></a>HTML 和 React 中的事件处理有什么区别</h3><ul><li><code>react</code> 事件名称大写，eg: <code>onClick</code>/<code>onChange</code></li><li>在 HTML 中阻止事件可以<code>return false</code>,在 <code>react</code> 中 必须使用 <code>e.preventDefault()</code></li></ul><h3 id="react-中-函数绑定-this-的方法"><a href="#react-中-函数绑定-this-的方法" class="headerlink" title="react 中 函数绑定 this 的方法"></a>react 中 函数绑定 this 的方法</h3><ul><li>在 构造函数中</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.handleClick = <span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"click"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>箭头函数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"click"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>react 中函数的使用</p></blockquote><ul><li><code>&lt;button onCLick={this.handleClick}&gt;Click&lt;/button&gt;</code></li><li><code>&lt;input onChange={e =&gt; this.handleChange(e)}/&gt;</code></li></ul><h3 id="ref-的使用"><a href="#ref-的使用" class="headerlink" title="ref 的使用"></a>ref 的使用</h3><figure class="highlight javascript"><figcaption><span>MyComponent.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.myRef = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;this.myRef&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>SearchBar.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SearchBar</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.txtSearch = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">term</span>: <span class="string">""</span> &#125;;</span><br><span class="line">    <span class="keyword">this</span>.setInputSearchRef = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.txtSearch = e;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  onInputChange(event) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">term</span>: <span class="keyword">this</span>.txtSearch.value &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;input</span><br><span class="line">        value=&#123;<span class="keyword">this</span>.state.term&#125;</span><br><span class="line">        onChange=&#123;<span class="keyword">this</span>.onInputChange.bind(<span class="keyword">this</span>)&#125;</span><br><span class="line">        ref=&#123;<span class="keyword">this</span>.setInputSearchRef&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="受控组件-和-非受控组件"><a href="#受控组件-和-非受控组件" class="headerlink" title="受控组件 和 非受控组件"></a>受控组件 和 非受控组件</h3><p>使用 <code>setState</code> 控制内部状态的组件称为受控组件，</p><h4 id="controlled"><a href="#controlled" class="headerlink" title="controlled"></a>controlled</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">name</span>: <span class="string">""</span> &#125;;</span><br><span class="line">    <span class="keyword">this</span>.handleNameChange = <span class="keyword">this</span>.handleNameChange.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleNameChange(event) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">name</span>: event.target.value &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"text"</span></span><br><span class="line">          value=&#123;<span class="keyword">this</span>.state.name&#125;</span><br><span class="line">          onChange=&#123;<span class="keyword">this</span>.handleNameChange&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>当注释 <code>this.setState({value: event.target.value});</code> 这行代码，文本框再次输入时，页面不会重新渲染，所产生效果即是文本框输入不了值，即文本框值的改变受到 <code>setState()</code> 方法的控制，在未执行时，不重新渲染组件</p></blockquote><h4 id="uncontrolled"><a href="#uncontrolled" class="headerlink" title="uncontrolled"></a>uncontrolled</h4><p>表单数据由 DOM 本身处理。即不受<code>setState()</code>的控制，与传统的 HTML 表单输入相似，input 输入值即显示最新值（使用 <code>ref</code> 从 DOM 获取表单值）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.input = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.handleSubmit = <span class="keyword">this</span>.handleSubmit.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleSubmit(event) &#123;</span><br><span class="line">    alert(<span class="string">"A name was submitted: "</span> + <span class="keyword">this</span>.input.value);</span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;form onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          Name:</span><br><span class="line">          &lt;input type=<span class="string">"text"</span> ref=&#123;input =&gt; (<span class="keyword">this</span>.input = input)&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input type="submit" value="Submit" /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="React16-生命周期"><a href="#React16-生命周期" class="headerlink" title="React16 生命周期"></a>React16 生命周期</h3><p><a href="http://www.tiankai.party/react16.html">react16 生命周期</a></p><h3 id="React-高阶组件"><a href="#React-高阶组件" class="headerlink" title="React 高阶组件"></a>React 高阶组件</h3><p>在组件内部对旧的组件进行封装，返回一个新的组件。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HOC</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> newProps = &#123;</span><br><span class="line">        title: <span class="string">"New Header"</span>,</span><br><span class="line">        footer: <span class="literal">false</span>,</span><br><span class="line">        showFeatureX: <span class="literal">false</span>,</span><br><span class="line">        showFeatureY: <span class="literal">true</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.props</span>&#125; &#123;<span class="attr">...newProps</span>&#125; /&gt;</span>;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">  &#125;;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="react-16-6-lazy"><a href="#react-16-6-lazy" class="headerlink" title="react 16.6 lazy"></a>react 16.6 lazy</h3><p>类似于<code>react-loadable</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; lazy, Suspense &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> OtherComponent = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./OtherComponent"</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;OtherComponent /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="React-Context"><a href="#React-Context" class="headerlink" title="React Context"></a>React Context</h3><figure class="highlight javascript"><figcaption><span>ThemeContext.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> themes = &#123;</span><br><span class="line">  light: &#123;</span><br><span class="line">    foreground: <span class="string">"#000"</span>,</span><br><span class="line">    background: <span class="string">"#eee"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  dark: &#123;</span><br><span class="line">    foreground: <span class="string">"#fff"</span>,</span><br><span class="line">    background: <span class="string">"#222"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeContext = React.createContext(themes.dark);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>App.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PureComponent &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Tool <span class="keyword">from</span> <span class="string">"./Tool"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ThemeContext, themes &#125; <span class="keyword">from</span> <span class="string">"./modules/ThemeContext"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Provider &#125; = ThemeContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      theme: themes.light</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.changeTheme = <span class="keyword">this</span>.changeTheme.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  changeTheme() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function"><span class="params">prev</span> =&gt;</span> (&#123;</span><br><span class="line">      theme: prev.theme === themes.dark ? themes.light : themes.dark</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Provider value=&#123;<span class="keyword">this</span>.state.theme&#125;&gt;</span><br><span class="line">        &lt;Tool changeTheme=&#123;<span class="keyword">this</span>.changeTheme&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>Tool.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PureComponent &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ThemeContext, themes &#125; <span class="keyword">from</span> <span class="string">"./modules/ThemeContext"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Consumer &#125; = ThemeContext;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tool</span> <span class="keyword">extends</span> <span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Consumer&gt;</span><br><span class="line">        &#123;value =&gt; (</span><br><span class="line">          &lt;div</span><br><span class="line">            style=&#123;&#123;</span><br><span class="line">              backgroundColor: value.background,</span><br><span class="line">              width: <span class="string">"100%"</span>,</span><br><span class="line">              height: <span class="string">"100%"</span></span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;button</span><br><span class="line">              style=&#123;&#123;</span><br><span class="line">                backgroundColor: value.foreground,</span><br><span class="line">                color: value.background,</span><br><span class="line">                outline: <span class="string">"none"</span>,</span><br><span class="line">                padding: <span class="string">"5px 8px"</span>,</span><br><span class="line">                borderRadius: <span class="string">"5px"</span>,</span><br><span class="line">                border: <span class="number">0</span>,</span><br><span class="line">                margin: <span class="string">"20px"</span></span><br><span class="line">              &#125;&#125;</span><br><span class="line">              onClick=&#123;<span class="keyword">this</span>.props.changeTheme&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              Toggle - Theme -&#123;<span class="string">" "</span>&#125;</span><br><span class="line">              &#123;value.background === themes.dark.background ? <span class="string">"dark"</span> : <span class="string">"light"</span>&#125;</span><br><span class="line">            &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      &lt;<span class="regexp">/Consumer&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Tool.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  changeTheme: PropTypes.func,</span></span><br><span class="line"><span class="regexp">  errorAction: PropTypes.func</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Tool;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;总结一些 react 中常见的面试题吧，同时也是让自己多学习学习 react 相关的知识。查漏补缺。&lt;/p&gt;
    
    </summary>
    
      <category term="react" scheme="http://www.tiankai.party/categories/react/"/>
    
    
      <category term="react" scheme="http://www.tiankai.party/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>图片懒加载</title>
    <link href="http://www.tiankai.party/posts/8917/"/>
    <id>http://www.tiankai.party/posts/8917/</id>
    <published>2018-10-10T09:59:00.000Z</published>
    <updated>2019-01-02T02:54:45.250Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一直都想自己实现这个功能而不是知道原理不实践，这次突然看到掘金上的文章后，跟着走了一遍代码，原来不管什么效果只知道原理是远远不够的，你必须亲自实现一下，然后才知道其中的坑，也会学到更多。程序员就要勤于动手。</p><a id="more"></a><p>先放一张自己画的图，理清楚这几个高度的关系。</p><p><img src="/../images/window.png" alt="clientHeight"></p><ul><li>认识一个函数<code>let rectObj = element.getBoundingClientRect()</code><ul><li>返回的对象<code>rectObj.top</code> 表示的是 该元素 距离视口（浏览器窗口）的距离，即图中的 <code>clientBoundRect.top</code></li><li>视口的高度 <code>document.documentElement.clientHeight</code></li><li><code>document.body.clientHeight</code> 获取的 网页的高度</li></ul></li></ul><blockquote><p>这里参考了一下阮一峰大大的 获取元素 的绝对位置 和 相对位置</p></blockquote><ul><li>相对位置<br><code>element.getBoundingClientRect().top</code></li><li>绝对位置<br>相对位置 + 网页滚动过的距离<br><code>element.getBoundingClientRect().top + document.documentElement.scrollTop</code></li></ul><h3 id="传统的-监听-Scroll-事件"><a href="#传统的-监听-Scroll-事件" class="headerlink" title="传统的 监听 Scroll 事件"></a>传统的 监听 Scroll 事件</h3><p>在 scroll 事件中 我们只需要判断一下，元素距离浏览器窗口顶部的距离是否小于浏览器窗口的高度，就可以判断出 图片是否进入了 可视区域，<br>然后再使用节流函数， 每隔 200ms 调用一次 函数， 节省开销</p><figure class="highlight javascript"><figcaption><span>lazy.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//所有的图片</span></span><br><span class="line"><span class="keyword">this</span>.lazyImg.forEach(<span class="function">(<span class="params">val, idx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> rectObj = val.getBoundingClientRect();</span><br><span class="line">  <span class="comment">// 如果当前元素距 视口 的距离 小于 视口的 高度</span></span><br><span class="line">  <span class="comment">// 此时元素处于可见范围</span></span><br><span class="line">  <span class="keyword">if</span> (rectObj.top &lt; <span class="built_in">document</span>.documentElement.clientHeight) &#123;</span><br><span class="line">    <span class="keyword">let</span> actualSrc = val.dataset.src;</span><br><span class="line">    val.setAttribute(<span class="string">"src"</span>, actualSrc);</span><br><span class="line">    val.removeAttribute(<span class="string">"class"</span>);</span><br><span class="line">    <span class="comment">// 当滚动到最后一个图片后 移除 scroll 事件</span></span><br><span class="line">    <span class="keyword">if</span> (idx === <span class="keyword">this</span>.lazyImg.length - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">window</span>.removeEventListener(<span class="string">"scroll"</span>, <span class="built_in">window</span>.scrollFun);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="节流函数"><a href="#节流函数" class="headerlink" title="节流函数"></a>节流函数</h4><blockquote><p>Get: 重新认识了一下 节流函数 记忆理解更深了一层</p></blockquote><p>具体的节流函数可以查看我之前写的一篇<a href="http://www.tiankai.party/%E5%87%BD%E6%95%B0%E7%9A%84%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81.html">防抖节流的文章</a></p><figure class="highlight javascript"><figcaption><span>throttle.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, delay</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> start = +<span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">  that = <span class="keyword">this</span>,</span><br><span class="line">  timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> _args = args,</span><br><span class="line">    now = +<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">if</span>(now - start &gt; delay)&#123;</span><br><span class="line">      start = now;</span><br><span class="line">      clearTimeout(timer);</span><br><span class="line">      timer = setTimeout(() = &gt; &#123;</span><br><span class="line">        fn.apply(that, _args);</span><br><span class="line">      &#125;, delay);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用方式</span></span><br><span class="line"><span class="keyword">let</span> throttleFun = throttle(scrollFun, <span class="number">200</span>);</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'scroll'</span>, () =&gt; &#123;</span><br><span class="line">  throttleFun(args);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="新的-Intersection-Observer-API"><a href="#新的-Intersection-Observer-API" class="headerlink" title="新的 Intersection Observer API"></a>新的 Intersection Observer API</h3><p>使用分俩步：</p><ul><li>新建 <code>Intersection Observer</code> 观察对象 <code>oberver</code></li></ul><figure class="highlight javascript"><figcaption><span>observer.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// new IntersctionObserver(callback, options)</span></span><br><span class="line"><span class="keyword">let</span> observer = <span class="keyword">new</span> IntersctionObserver(<span class="function">(<span class="params">entries, observer</span>) =&gt;</span> &#123;</span><br><span class="line">  entries.forEach(<span class="function"><span class="params">entry</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// entry.isIntersecting 标识元素是否进入可见区域</span></span><br><span class="line">    <span class="comment">// entry.target 观察的当前元素</span></span><br><span class="line">    <span class="keyword">if</span> (entry.isIntersecting) &#123;</span><br><span class="line">      <span class="keyword">let</span> _target = entry.target;</span><br><span class="line">      <span class="keyword">let</span> actualSrc = _target.getAttribute(<span class="string">"data-src"</span>);</span><br><span class="line">      _target.removeAttribute(<span class="string">"class"</span>);</span><br><span class="line">      _target.setAttribute(<span class="string">"src"</span>, actualSrc);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><code>observer.observe(element)</code> 观察元素</li></ul><figure class="highlight javascript"><figcaption><span>observer.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.lazyImg.forEach(<span class="function"><span class="params">img</span> =&gt;</span> observer.boserve(img));</span><br></pre></td></tr></table></figure><p><a href="https://github.com/tiakia/some-demo/blob/master/lazyImg/lazyImage.html" target="_blank" rel="noopener">完整代码</a></p><blockquote><p>参考链接</p></blockquote><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener">intersectionObserver - MDN</a></p><p><a href="http://www.ruanyifeng.com/blog/2009/09/find_element_s_position_using_javascript.html" target="_blank" rel="noopener">阮一峰的网络日志</a></p><p><a href="https://juejin.im/post/5bbc60e8f265da0af609cd04?utm_source=gold_browser_extension" target="_blank" rel="noopener">掘金</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一直都想自己实现这个功能而不是知道原理不实践，这次突然看到掘金上的文章后，跟着走了一遍代码，原来不管什么效果只知道原理是远远不够的，你必须亲自实现一下，然后才知道其中的坑，也会学到更多。程序员就要勤于动手。&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.tiankai.party/categories/javascript/"/>
    
    
      <category term="js" scheme="http://www.tiankai.party/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>常见的排序算法</title>
    <link href="http://www.tiankai.party/posts/11962/"/>
    <id>http://www.tiankai.party/posts/11962/</id>
    <published>2018-09-26T01:46:00.000Z</published>
    <updated>2019-01-02T02:51:05.711Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>这里列举几种，前端常见的几种排序算法，记忆巩固一下吧,后期慢慢更新。算法才是最重要的。</p><a id="more"></a><p>1.冒泡排序</p><ul><li>比较相邻的元素，如果前一个比后一个大，就把它们两个调换位置。</li><li>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。这步做完后，最后的元素会是最大的数。</li><li>针对所有的元素重复以上的步骤，除了最后一个。</li><li>持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。</li></ul><figure class="highlight javascript"><figcaption><span>bubleSort.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 冒泡排序</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bubleSort</span>(<span class="params">arr</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> len = arr.length;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; len - <span class="number">1</span> - i; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[j] &gt; arr[j+<span class="number">1</span>])&#123;</span><br><span class="line">                [arr[j], arr[j+<span class="number">1</span>]] = [arr[j+<span class="number">1</span>], arr[j]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.快速排序</p><ul><li>选择 中间的值 做为 基准值，把数组拆分成左右俩个数组</li><li>比基准值大的放到 右边数组，比基准值小的放到 左边数组</li><li>最后 排序一下 然后 拼接成排序好的数组</li></ul><figure class="highlight javascript"><figcaption><span>quickSort.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quickSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> len = arr.length,</span><br><span class="line">    leftArr = [],</span><br><span class="line">    rightArr = [],</span><br><span class="line">    cenVal = arr[<span class="built_in">Math</span>.floor(len / <span class="number">2</span>)];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[i] &lt; cenVal) &#123;</span><br><span class="line">      leftArr.push(arr[i]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      rightArr.push(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  leftArr.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b &gt; <span class="number">0</span>);</span><br><span class="line">  rightArr.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b &gt; <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> [...leftArr, ...rightArr];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.插入排序</p><ul><li>默认数组第一个是已经排序好的，从第二个元素开始排序</li><li>第二个元素和第一个元素比较 如果第二个元素比第一个小 那么 这俩个元素互换位置</li><li>然后从第三个元素开始，和第一个，第二个比较，把第三个元素 插入到 该在的位置，这样前三个就是排好序的。</li><li>从第四个开始 重复上述步骤</li></ul><figure class="highlight javascript"><figcaption><span>insertSort.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.move = <span class="function"><span class="keyword">function</span>(<span class="params">old_index, new_index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (new_index &gt;= <span class="keyword">this</span>.length) &#123;</span><br><span class="line">    <span class="keyword">var</span> k = new_index - <span class="keyword">this</span>.length;</span><br><span class="line">    <span class="keyword">while</span> (k-- + <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.push(<span class="literal">undefined</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.splice(new_index, <span class="number">0</span>, <span class="keyword">this</span>.splice(old_index, <span class="number">1</span>)[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>; <span class="comment">// for testing purposes</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 插入排序</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insertSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> len = arr.length,</span><br><span class="line">    orderIndex;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[i] &lt; arr[j]) &#123;</span><br><span class="line">        orderIndex = j;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    arr.move(i, orderIndex);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.选择排序</p><ul><li>从第一个元素开始和后面的所有元素比较，记录最小的位置，然后交换位置</li><li>从第二个元素开始和后面的所有元素比较，继续循环比较</li><li>重复上述步骤</li></ul><figure class="highlight javascript"><figcaption><span>selectSort.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 选择排序法一</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 把小的数放到前面，下次遍历的时候从排好的数开始</span></span><br><span class="line"><span class="comment"> * 每个数和它后面的每个数比较，把小的数放在前面</span></span><br><span class="line"><span class="comment"> * 下次循环从已经比较好的数开始进行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unKonwSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> len = arr.length;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i + <span class="number">1</span>; j &lt; len; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[i] &gt; arr[j]) &#123;</span><br><span class="line">        [arr[i], arr[j]] = [arr[j], arr[i]];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//选择排序法二</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 循环只保留下标，在一次循环完成后再交换</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">selectSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> minIndex,</span><br><span class="line">    len = arr.length;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    minIndex = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i + <span class="number">1</span>; j &lt; len; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[j] &lt; arr[minIndex]) &#123;</span><br><span class="line">        minIndex = j;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [arr[i], arr[minIndex]] = [arr[minIndex], arr[i]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>参考链接</p></blockquote><p><a href="https://juejin.im/post/57dcd394a22b9d00610c5ec8#heading-10" target="_blank" rel="noopener">掘金</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这里列举几种，前端常见的几种排序算法，记忆巩固一下吧,后期慢慢更新。算法才是最重要的。&lt;/p&gt;
    
    </summary>
    
      <category term="算法" scheme="http://www.tiankai.party/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="算法" scheme="http://www.tiankai.party/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>compositionstart/end 处理中文输入问题</title>
    <link href="http://www.tiankai.party/posts/38500/"/>
    <id>http://www.tiankai.party/posts/38500/</id>
    <published>2018-09-06T07:43:00.000Z</published>
    <updated>2019-01-02T02:55:03.605Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>问题的引出在上一次写的 防抖 节流中，在防抖的 input 框输入的时候发现我输入的中文结果控制台显示出来的是拼音，然后就找到这俩个函数 <code>compositionstart</code> 和 <code>compositionend</code></p><a id="more"></a><h3 id="compositionstart"><a href="#compositionstart" class="headerlink" title="compositionstart"></a>compositionstart</h3><p>该事件仅在若干可见字符的输入之前，而这些可见字符的输入可能需要一连串的键盘操作、语音识别或者点击输入法的。</p><h3 id="compositionend"><a href="#compositionend" class="headerlink" title="compositionend"></a>compositionend</h3><p>该事件触发于可见字符输入完成之后。</p><p>和<code>input</code>三个事件发生的顺序是:</p><ul><li><code>compositionstart</code></li><li><code>input</code></li><li><code>compositionend</code></li></ul><p>触发<code>compositionstart</code>时，会同时触发<code>input</code>事件；最后输入完成时，触发<code>compositionend</code>。</p><p>选词结束的时候<code>input</code>会比<code>compositionend</code>先一步触发，此时 isLock 还未调整为 false，所以不能触发到 console，所以这里需要 <code>setTimeout</code> 的无阻塞模式，让 console 优先级排到最后，才能在<code>compositionend</code> 事件触发后打印出值</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理中文输入的问题</span></span><br><span class="line"><span class="keyword">let</span> inputChina = <span class="built_in">document</span>.getElementById(<span class="string">"inputChina"</span>),</span><br><span class="line">  isLock = <span class="literal">true</span>,</span><br><span class="line">  timer = <span class="literal">null</span>;</span><br><span class="line">inputChina.addEventListener(<span class="string">"compositionstart"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  isLock = <span class="literal">true</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"compositionstart: "</span> + e.target.value);</span><br><span class="line">&#125;);</span><br><span class="line">inputChina.addEventListener(<span class="string">"input"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"input: "</span> + e.target.value);</span><br><span class="line">  timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"correct: "</span> + e.target.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  timer = <span class="literal">null</span>;</span><br><span class="line">&#125;);</span><br><span class="line">inputChina.addEventListener(<span class="string">"compositionend"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  isLock = <span class="literal">false</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"compositionend: "</span> + e.target.value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>参考链接</p></blockquote><p><a href="https://www.cnblogs.com/lonhon/p/7643095.html" target="_blank" rel="noopener">博客园大神</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;问题的引出在上一次写的 防抖 节流中，在防抖的 input 框输入的时候发现我输入的中文结果控制台显示出来的是拼音，然后就找到这俩个函数 &lt;code&gt;compositionstart&lt;/code&gt; 和 &lt;code&gt;compositionend&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.tiankai.party/categories/javascript/"/>
    
    
      <category term="js" scheme="http://www.tiankai.party/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>函数的防抖和节流</title>
    <link href="http://www.tiankai.party/posts/43821/"/>
    <id>http://www.tiankai.party/posts/43821/</id>
    <published>2018-09-06T02:33:00.000Z</published>
    <updated>2019-01-02T03:08:40.516Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>今天看了掘金的文章函数的防抖和节流，然后想自己总结一篇，应证一下是否学会了。</p><a id="more"></a><p>先来 一个 普通情况下的截图</p><p><img src="/../images/normal.gif" alt="normal"></p><h4 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h4><p>含义：一个函数如果在一段时间内不断触发，那么我们就让这个事件在停止触发一段时间后发生，如果在这个时间内重新触发了那么这个时间重新开始计算。<br>案例： 搜索框联想搜索时，浏览器窗口 resize 事件、Scroll 事件等。</p><p><img src="/../images/debounce.gif" alt="debounce"></p><figure class="highlight javascript"><figcaption><span>debounce.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数的防抖</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fun, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="keyword">this</span>,</span><br><span class="line">      _args = args;</span><br><span class="line">    clearTimeout(timer);</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      fun.call(that, _args);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testInput</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Value: "</span> + e.target.value + <span class="string">"\n"</span> + <span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> debounceInput = <span class="built_in">document</span>.getElementById(<span class="string">"debounce"</span>);</span><br><span class="line"><span class="comment">// 调用方式</span></span><br><span class="line"><span class="keyword">let</span> debounceFunc = debounce(testInput, <span class="number">500</span>);</span><br><span class="line">debounceInput.addEventListener(</span><br><span class="line">  <span class="string">"input"</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    debounceFunc(e);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h4><p>含义： 规定函数在一定的时间段内执行一次，如果在这个时段内多次触发，也只会触发一次。</p><p><img src="/../images/throttle.gif" alt="throttle"></p><figure class="highlight javascript"><figcaption><span>throttle.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 节流函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fun, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> last = +<span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">    timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="keyword">this</span>,</span><br><span class="line">      _args = args,</span><br><span class="line">      now = +<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">if</span> (last &amp;&amp; now - last &gt; delay) &#123;</span><br><span class="line">      last = now;</span><br><span class="line">      clearTimeout(timer);</span><br><span class="line">      timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        fun.call(that, _args);</span><br><span class="line">      &#125;, delay);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用方式</span></span><br><span class="line"><span class="keyword">let</span> throttleInput = <span class="built_in">document</span>.getElementById(<span class="string">"throttle"</span>);</span><br><span class="line"><span class="keyword">let</span> throttleFunc = throttle(testInput, <span class="number">1000</span>);</span><br><span class="line">throttleInput.addEventListener(</span><br><span class="line">  <span class="string">"input"</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    throttleFunc(e);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><blockquote><p>注意： 在防抖和节流函数中，在闭包函数内留住 this 还是选择 闭包外留住 this，最后函数中 this 的指向不一样。闭包外留住 this 指向的是 外层函数所指的 this，闭包内留住的 this 指向的是 接受外层函数返回函数的 变量 所指的 this</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">lazy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(selector) &#123;</span><br><span class="line">      <span class="keyword">this</span>.lazyImg = <span class="built_in">document</span>.querySelectorAll(selector);</span><br><span class="line">      <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line">    init() &#123;</span><br><span class="line">      <span class="built_in">window</span>.scrollFun = <span class="keyword">this</span>.throttle(<span class="keyword">this</span>.judge, <span class="number">200</span>);</span><br><span class="line">      <span class="built_in">window</span>.addEventListener(<span class="string">"scroll"</span>, <span class="built_in">window</span>.scrollFun);</span><br><span class="line">    &#125;</span><br><span class="line">    judge() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    throttle(fn, delay) &#123;</span><br><span class="line">      <span class="comment">// 节流 每隔一段时后 触发一次函数</span></span><br><span class="line">      <span class="keyword">let</span> timer,</span><br><span class="line">        that = <span class="keyword">this</span>, <span class="comment">// 这里留住 this 指向的是 throttle的 this(lazy)</span></span><br><span class="line">        start = +<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> _args = args,</span><br><span class="line">          <span class="comment">//that = this, // 这里留住 this 指向的是 scrollFun 的 this(window)</span></span><br><span class="line">          now = +<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">if</span> (now - start &gt; delay) &#123;</span><br><span class="line">          start = now;</span><br><span class="line">          clearTimeout(timer);</span><br><span class="line">          timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            fn.call(that, _args);</span><br><span class="line">          &#125;, delay);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">new</span> lazy(<span class="string">"article img"</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天看了掘金的文章函数的防抖和节流，然后想自己总结一篇，应证一下是否学会了。&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.tiankai.party/categories/javascript/"/>
    
    
      <category term="js" scheme="http://www.tiankai.party/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>redux-saga处理异步请求(初级篇)</title>
    <link href="http://www.tiankai.party/posts/49250/"/>
    <id>http://www.tiankai.party/posts/49250/</id>
    <published>2018-09-05T08:56:00.000Z</published>
    <updated>2019-01-02T03:17:07.365Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>redux 是 react 中处理数据的方式，数据的获取有时候需要通过请求后台来获得，这个操作就是副作用，<code>redux-saga</code> 就是用来处理副作用的方式。</p><a id="more"></a><h4 id="使用-redux-saga-的方式："><a href="#使用-redux-saga-的方式：" class="headerlink" title="使用 redux-saga 的方式："></a>使用 <code>redux-saga</code> 的方式：</h4><figure class="highlight javascript"><figcaption><span>main.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createSagaMiddleware &#125; <span class="keyword">from</span> <span class="string">"redux-saga"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducers"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rootSaga <span class="keyword">from</span> <span class="string">"./sagas"</span>;</span><br><span class="line"><span class="comment">//创建 saga 中间件</span></span><br><span class="line"><span class="keyword">const</span> sagaMiddleware = createSagaMiddleware();</span><br><span class="line"><span class="comment">//redux 应用 saga 中间件</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, applyMiddleware(sagaMiddleware));</span><br><span class="line"></span><br><span class="line">sagaMiddleware.run(rootSaga);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> action = <span class="function"><span class="params">type</span> =&gt;</span> store.dispatch(&#123; type &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Counter = <span class="function">(<span class="params">&#123; value, onIncrement, onDecrement, onIncrementasync &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button onClick=&#123;onIncrementAsync&#125;&gt;increment after <span class="number">1</span> second&lt;<span class="regexp">/button&gt;&#123;" "&#125;</span></span><br><span class="line"><span class="regexp">    &lt;button onClick=&#123;onIncrement&#125;&gt;Increment&lt;/</span>button&gt;&#123;<span class="string">" "</span>&#125;</span><br><span class="line">    &lt;button onClick=&#123;onDecrement&#125;&gt;Decrement&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;hr /</span>&gt;</span><br><span class="line">    &lt;div&gt;Clicked: &#123;value&#125; times&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ReactDOM.render(</span><br><span class="line">    &lt;Counter</span><br><span class="line">      value=&#123;store.getState()&#125;</span><br><span class="line">      onIncrement=&#123;() =&gt; action(<span class="string">"INCREMENT"</span>)&#125;</span><br><span class="line">      onDecrement=&#123;() =&gt; action(<span class="string">"DECREMENT"</span>)&#125;</span><br><span class="line">      onIncrementAsync=&#123;() =&gt; action(<span class="string">"INCREMENTASYNC"</span>)&#125;</span><br><span class="line">    /&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>reducers.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">reducers</span>(<span class="params">state = <span class="number">0</span>, &#123; type &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"INCREMENT"</span>:</span><br><span class="line">      <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"DECREMENT"</span>:</span><br><span class="line">      <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>增加一个点击按钮 1s 后增加 1 的 saga</p><figure class="highlight javascript"><figcaption><span>sagas.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; put, takeEvery, all &#125; <span class="keyword">from</span> <span class="string">"redux-saga/effects"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span>* <span class="title">incrementAsync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> delay(<span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">yield</span> put(&#123; <span class="attr">type</span>: <span class="string">"INCREMENT"</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span>* <span class="title">watchIncrementAsync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> takeEvery(<span class="string">"INCREMENTASYNC"</span>, incrementAsync);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>* <span class="title">rootSaga</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> all([helloSaga(), watchIncrementAsync()]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Effects"><a href="#Effects" class="headerlink" title="Effects"></a>Effects</h4><p>saga 提供的工具函数，可以用来进行异步操作。</p><ul><li><code>call</code> 函数用来发起异步请求 阻塞的 阻塞函数执行知道返回 resolve 或 reject</li><li><code>fork</code> 无阻塞的发起异步请求，函数可以继续执行，而不会等待 fork 发起的异步任务结束</li><li><code>put</code> 类似 redux 的 dispatch 发起一个 action</li><li><code>take</code> 监听这个 action 的发生,一般放到一个 <code>while(true)</code>循环中，否则只能监听到第一次的 action</li><li><code>cancel()</code> fork 返回一个 task 列表，使用 cancel 可以中止任务执行</li><li><code>takeEvery</code> 监听每次触发的操作</li><li><code>takeLatest</code> 只监听最后一次触发的操作</li></ul><h4 id="创建一个-logger-日志记录-saga"><a href="#创建一个-logger-日志记录-saga" class="headerlink" title="创建一个 logger 日志记录 saga"></a>创建一个 logger 日志记录 saga</h4><figure class="highlight javascript"><figcaption><span>sgas.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span>* <span class="title">logger</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> action = <span class="keyword">yield</span> take(*);</span><br><span class="line">    <span class="keyword">const</span> state = <span class="keyword">yield</span> select();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"actions： "</span> + <span class="built_in">JSON</span>.stringify(action));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"state after: "</span> + state);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>* <span class="title">rootSaga</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> all([helloSaga(), watchIncrementasync(), logger()]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>take(*)可以监听所有的 action，搭配 while(true) 可以监听所有的 操作，记录日志</p></blockquote><p>使用了 saga， 那么逻辑就可以放在 saga 中，数据的状态和绑定数据到 react 放在 reducer 里面 而 react 只负责 UI 界面展示</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;redux 是 react 中处理数据的方式，数据的获取有时候需要通过请求后台来获得，这个操作就是副作用，&lt;code&gt;redux-saga&lt;/code&gt; 就是用来处理副作用的方式。&lt;/p&gt;
    
    </summary>
    
      <category term="react" scheme="http://www.tiankai.party/categories/react/"/>
    
    
      <category term="react" scheme="http://www.tiankai.party/tags/react/"/>
    
      <category term="redux-saga" scheme="http://www.tiankai.party/tags/redux-saga/"/>
    
  </entry>
  
  <entry>
    <title>使用canvas压缩图片</title>
    <link href="http://www.tiankai.party/posts/34974/"/>
    <id>http://www.tiankai.party/posts/34974/</id>
    <published>2018-09-04T06:22:00.000Z</published>
    <updated>2019-01-02T03:23:04.953Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>前俩天做了一个图片转 base64 上传的功能，发现如果图片的 base64 过大的话，请求会变的很慢，严重的直接超时了，所以想到了在上传前压缩一下图片，然后再上传到后台，这样可以大大的提高效率，在这里记录一下利用 canvas 压缩图片遇到的几个坑。完整代码会在文末给出。</p><a id="more"></a><h4 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h4><ol><li>第一个坑，在压缩图片的时候没获取图片本身的宽高，给了一个 <code>600*480</code> 的定宽定高，因为是手机端的，在上传图片的时候都是几兆的图片，所以这块没任何问题。出问题的地方在 修改头像的时候，测试的时候上传的图片都是小图片，然后就出现了 压缩后的图片显示不完全，大部分都是空白的现象，这就是因为在压缩的时候没有考虑图片原本的宽高的情况。</li><li>第二个坑，解决第一个坑的办法就是在图片加载完成后（onload），获取图片本身的宽高，然后赋值给<code>canvas</code>,这样进行操作，但是这有个坑就是，图片加载是异步的，在你<code>return</code>的时候，返回的可能是 <code>undefined</code> 而不是你需要的 压缩后的 base64。这里的解决方法是，新建一个 <code>Promise</code>，然后把结果 <code>resolve()</code> 返回去，在调用的时候 <code>.then()</code> 得到结果。</li></ol><h4 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h4><ol><li><code>canvas</code>的<code>toDataURL(&#39;image/png&#39;, 0.9)</code>; 把 canvas 画的图片转换为 base64,第一个参数表示的是图片的类型，第二个参数表示的是图片的清晰度。</li><li>规定一个最大尺寸，如果图片本身的宽高大于这个尺寸，按照最大的一个边进行缩放，另一个根据图片的 比例 进行设置，然后设置给 <code>canvas</code>.</li></ol><figure class="highlight javascript"><figcaption><span>miniImage.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">miniSize</span>(<span class="params">imgData, maxSize = <span class="number">200</span> * <span class="number">1024</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// const maxSize = 200 * 1024;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (imgData &amp;&amp; imgData.files &amp;&amp; imgData.files.size &lt; maxSize) &#123;</span><br><span class="line">    <span class="keyword">return</span> imgData.url;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"----------------压缩图片-------------------"</span>);</span><br><span class="line">    <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">"canvas"</span>);</span><br><span class="line">    <span class="keyword">let</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">    img.src = imgData.url;</span><br><span class="line">    <span class="keyword">let</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      img.addEventListener(</span><br><span class="line">        <span class="string">"load"</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="comment">//图片原始尺寸</span></span><br><span class="line">          <span class="keyword">let</span> originWidth = <span class="keyword">this</span>.width;</span><br><span class="line">          <span class="keyword">let</span> originHeight = <span class="keyword">this</span>.height;</span><br><span class="line">          <span class="comment">// 最大尺寸限制</span></span><br><span class="line">          <span class="keyword">let</span> maxWidth = <span class="number">400</span>,</span><br><span class="line">            maxHeight = <span class="number">400</span>;</span><br><span class="line">          <span class="comment">// 目标尺寸</span></span><br><span class="line">          <span class="keyword">let</span> targetWidth = originWidth,</span><br><span class="line">            targetHeight = originHeight;</span><br><span class="line">          <span class="comment">// 图片尺寸超过400x400的限制</span></span><br><span class="line">          <span class="keyword">if</span> (originWidth &gt; maxWidth || originHeight &gt; maxHeight) &#123;</span><br><span class="line">            <span class="keyword">if</span> (originWidth / originHeight &gt; maxWidth / maxHeight) &#123;</span><br><span class="line">              <span class="comment">// 更宽，按照宽度限定尺寸</span></span><br><span class="line">              targetWidth = maxWidth;</span><br><span class="line">              targetHeight = <span class="built_in">Math</span>.round(</span><br><span class="line">                maxWidth * (originHeight / originWidth)</span><br><span class="line">              );</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              targetHeight = maxHeight;</span><br><span class="line">              targetWidth = <span class="built_in">Math</span>.round(</span><br><span class="line">                maxHeight * (originWidth / originHeight)</span><br><span class="line">              );</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          canvas.width = targetWidth;</span><br><span class="line">          canvas.height = targetHeight;</span><br><span class="line">          ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, targetWidth, targetHeight);</span><br><span class="line">          <span class="keyword">let</span> base64 = canvas.toDataURL(<span class="string">"image/png"</span>, <span class="number">0.9</span>);</span><br><span class="line">          resolve(base64);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="literal">false</span></span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">onChangeImg = <span class="keyword">async</span> (files, type, index) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> previous = <span class="keyword">this</span>.props.imagePicker.files;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">"add"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = miniSize(files[files.length - <span class="number">1</span>]);</span><br><span class="line">    <span class="comment">//使用 .then() 调用获得结果</span></span><br><span class="line">    <span class="keyword">await</span> result.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      previous.push(&#123; <span class="attr">url</span>: res &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">"remove"</span>) &#123;</span><br><span class="line">    previous.splice(index, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">this</span>.props.dispatch(&#123;</span><br><span class="line">    type: <span class="string">"imagePicker/saveImage"</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      files: previous</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前俩天做了一个图片转 base64 上传的功能，发现如果图片的 base64 过大的话，请求会变的很慢，严重的直接超时了，所以想到了在上传前压缩一下图片，然后再上传到后台，这样可以大大的提高效率，在这里记录一下利用 canvas 压缩图片遇到的几个坑。完整代码会在文末给出。&lt;/p&gt;
    
    </summary>
    
      <category term="canvas" scheme="http://www.tiankai.party/categories/canvas/"/>
    
    
      <category term="canvas" scheme="http://www.tiankai.party/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>eslint配置记录</title>
    <link href="http://www.tiankai.party/posts/13347/"/>
    <id>http://www.tiankai.party/posts/13347/</id>
    <published>2018-08-16T01:39:00.000Z</published>
    <updated>2019-01-02T03:25:45.746Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>eslint 可以帮助进行我们检查代码，使我们的代码写的整洁，高效，在这里总结一篇关于 eslint 配置的一些事项，一些规则持续更新。</p><p>eslint 的配置文件放在根目录中，新建<code>.eslintrc.js</code>文件，然后开始配置，一般常见的配置如下:</p><a id="more"></a><figure class="highlight javascript"><figcaption><span>.eslintrc.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  parser: <span class="string">"babel-eslint"</span>,</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    node: <span class="literal">true</span>,</span><br><span class="line">    es6: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="string">"react"</span>, <span class="string">"jsx-a11y"</span>],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="string">"react/prop-types"</span>: [<span class="number">2</span>],</span><br><span class="line">    <span class="string">"jsx-a11y/href-no-hash"</span>: <span class="string">"off"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  extends: <span class="string">"react-app"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>我们来详细的看一下 各个字段所代表的意思：</p><h3 id="rules"><a href="#rules" class="headerlink" title="rules:"></a>rules:</h3><p>是你具体配置的 eslint 的规则对象，对象的属性名为具体的规则名称，其他的规则名称会在文末有个总结，属性值是定义规则的开闭原则可以使用以下的值：</p><ul><li><code>&quot;off&quot;</code> or <code>0</code>-关闭规则</li><li><code>&quot;warn&quot;</code> or <code>1</code>-将规则视为一个警告，不会影响编译</li><li><code>&quot;error&quot;</code> or <code>2</code>- 将规则视为一个错误，在打包编译的时候会报错</li></ul><h3 id="extends"><a href="#extends" class="headerlink" title="extends:"></a>extends:</h3><p>这个字段表示的是 eslint 的扩展，你可以通过这个来使用社区别人写好的规则，我这里使用的是 <code>create-react-app</code> 的 eslint 扩展。也可以使用 <code>&quot;extends&quot;: &quot;eslint:recommended&quot;</code>这样会开启 eslint 推荐打开的规则。</p><h3 id="parser"><a href="#parser" class="headerlink" title="parser:"></a>parser:</h3><p>规定 eslint 的解析器，默认是 <code>esprima</code>，在这个配置中使用的是<code>bael-eslint</code>解析器</p><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins:"></a>plugins:</h3><p>eslint 支持 第三方插件，在使用前必须安装他们，插件名称可以省略 <code>eslint-plugin-</code>前缀,常用的俩个插件就是 <code>eslint-plugin-react</code> 和 <code>eslint-plugin-jsx-a11y</code>,如果在 <code>rules</code> 规则对象中使用 插件中的规则的话，就如上面配置中的那样是 <code>react/prop-tyeps</code> 这样来使用。</p><h3 id="env"><a href="#env" class="headerlink" title="env:"></a>env:</h3><p>规定了 eslint 的启用环境</p><h3 id="eslintignore"><a href="#eslintignore" class="headerlink" title="eslintignore"></a>eslintignore</h3><p>配置 忽略 eslint 语法检查的文件，可以配置在 <code>package.json</code> 文件里,同样 eslint 的配置同样也可以放在 <code>package.json</code> 文件里</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"mypackage"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">  <span class="attr">"eslintConfig"</span>: &#123;</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">      <span class="attr">"browser"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"node"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"eslintIgnore"</span>: [<span class="string">"hello.js"</span>, <span class="string">"world.js"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rules-1"><a href="#rules-1" class="headerlink" title="rules"></a>rules</h3><p>这些规则 js 中的可能的错误或逻辑错误有关：</p><table><thead><tr><th>规则</th><th>解释</th></tr></thead><tbody><tr><td>for-direction</td><td>强制 <code>“for”</code> 循环中更新子句的计数器朝着正确的方向移动</td></tr><tr><td>getter-return</td><td>强制 getter 函数中出现  <code>return</code>  语句</td></tr><tr><td>no-await-in-loop</td><td>禁止在循环中出现  <code>await</code></td></tr><tr><td>no-compare-neg-zero</td><td>禁止与 -0 进行比较</td></tr><tr><td>no-cond-assign</td><td>禁止条件表达式中出现赋值操作符</td></tr><tr><td>no-console</td><td>禁用 <code>console</code></td></tr><tr><td>no-constant-condition</td><td>禁止在条件中使用常量表达式</td></tr><tr><td>no-control-regex</td><td>禁止在正则表达式中使用控制字符</td></tr><tr><td>no-debugger</td><td>禁用 <code>debugger</code></td></tr><tr><td>no-duplicate-case</td><td>禁止出现重复 <code>case</code> 标签</td></tr><tr><td>no-dupe-args</td><td>禁止 <code>function</code> 定义中出现重命名参数</td></tr><tr><td>no-dupe-keys</td><td>禁止对象字面量中出现重复的 <code>key</code></td></tr><tr><td>no-empty</td><td>禁止出现空语句块</td></tr><tr><td>no-empty-character-class</td><td>禁止在正则表达式中使用空字符集</td></tr><tr><td>no-ex-assign</td><td>禁止对 <code>catch</code> 字句的参数重新赋值</td></tr><tr><td>no-extra-boolean-cast</td><td>禁止不必要的布尔转换</td></tr><tr><td>no-extra-parens</td><td>禁止不必要的括号</td></tr><tr><td>no-extra-semi</td><td>禁止不必要的分号</td></tr><tr><td>no-func-assign</td><td>禁止对 <code>function</code> 声明重新赋值</td></tr><tr><td>no-inner-declarations</td><td>禁止在嵌套的块中出现变量声明或  <code>function</code>  声明</td></tr><tr><td>no-invalid-regexp</td><td>禁止  <code>RegExp</code>  构造函数中存在无效的正则表达式字符串</td></tr><tr><td>no-irregular-whitespace</td><td>禁止在字符串和注释之外不规则的空白</td></tr><tr><td>no-obj-calls</td><td>禁止把全局对象作为函数调用</td></tr><tr><td>no-prototype-builtins</td><td>禁止直接调用  <code>Object.prototypes</code>  的内置属性</td></tr><tr><td>no-regex-spaces</td><td>禁止正则表达式字面量中出现多个空格</td></tr><tr><td>no-sparse-arrays</td><td>禁用稀疏数组</td></tr><tr><td>no-template-curly-in-string</td><td>禁止在常规字符串中出现模板字面量占位符语法</td></tr><tr><td>no-unexpected-multiline</td><td>禁止出现令人困惑的多行表达式</td></tr><tr><td>no-unreachable</td><td>禁止在<code>return</code>、<code>throw</code>、<code>continue</code>  和  <code>break</code>  语句之后出现不可达代码</td></tr><tr><td>no-unsafe-finally</td><td>禁止在  <code>finally</code>  语句块中出现控制流语句</td></tr><tr><td>no-unsafe-negation</td><td>禁止对关系运算符的左操作数使用否定操作符</td></tr><tr><td>no-isnan</td><td>要求使用  <code>isNaN()</code>  检查  <code>NaN</code></td></tr><tr><td>valid-jsdoc</td><td>强制使用有效的 JSDoc 注释</td></tr><tr><td>valid-typeof</td><td>强制  <code>typeof</code>  表达式与有效的字符串进行比较</td></tr></tbody></table><p>这些规则是关于最佳实践的：</p><table><thead><tr><th>规则</th><th>解释</th></tr></thead><tbody><tr><td>accessor-pairs</td><td>强制 getter 和 setter 在对象中成对出现</td></tr><tr><td>array-callback-return</td><td>强制数组方法的回调函数中有  <code>return</code>  语句</td></tr><tr><td>block-scoped-var</td><td>强制把变量的使用限制在其定义的作用域范围内</td></tr><tr><td>class-methods-use-this</td><td>强制类方法使用  <code>this</code></td></tr><tr><td>complexity</td><td>指定程序中允许的最大环路复杂度</td></tr><tr><td>consistent-return</td><td>要求  <code>return</code>  语句要么总是指定返回的值，要么不指定</td></tr><tr><td>curly</td><td>强制所有控制语句使用一致的括号风格</td></tr><tr><td>default-case</td><td>要求  <code>switch</code>  语句中有  <code>default</code>  分支</td></tr><tr><td>dot-location</td><td>强制在点号之前和之后一致的换行</td></tr><tr><td>dot-notation</td><td>强制尽可能地使用点号</td></tr><tr><td>eqeqeq</td><td>要求使用  <code>===</code>  和  <code>!==</code></td></tr><tr><td>guard-for-in</td><td>要求  <code>for-in</code>  循环中有一个  <code>if</code>  语句</td></tr><tr><td>no-alert</td><td>禁用  <code>alert</code>、<code>confirm</code>  和  <code>prompt</code></td></tr><tr><td>no-caller</td><td>禁用  <code>arguments.caller</code>  或  <code>arguments.callee</code></td></tr><tr><td>no-case-declarations</td><td>不允许在 case 子句中使用词法声明</td></tr><tr><td>no-div-regex</td><td>禁止除法操作符显式的出现在正则表达式开始的位置</td></tr><tr><td>no-else-return</td><td>禁止  <code>if</code>  语句中  <code>return</code>  语句之后有  <code>else</code>  块</td></tr><tr><td>no-empty-pattern</td><td>禁止使用空解构模式</td></tr><tr><td>no-eq-null</td><td>禁止在没有类型检查操作符的情况下与  <code>null</code>  进行比较</td></tr><tr><td>no-eval</td><td>禁用  <code>eval()</code></td></tr><tr><td>no-extend-native</td><td>禁止扩展原生类型</td></tr><tr><td>no-extra-bind</td><td>禁止不必要的  <code>.bind()</code>  调用</td></tr><tr><td>no-extra-label</td><td>禁用不必要的标签</td></tr><tr><td>no-fallthrough</td><td>禁止  <code>case</code>  语句落空</td></tr><tr><td>no-floating-decimal</td><td>禁止数字字面量中使用前导和末尾小数点</td></tr><tr><td>no-global-assign</td><td>禁止对原生对象或只读的全局对象进行赋值</td></tr><tr><td>no-implicit-coercion</td><td>禁止使用短符号进行类型转换</td></tr><tr><td>no-implicit-globals</td><td>禁止在全局范围内使用变量声明和  <code>function</code>  声明</td></tr><tr><td>no-implied-eval</td><td>禁止使用类似  <code>eval()</code>  的方法</td></tr><tr><td>no-invalid-this</td><td>禁止  <code>this</code>  关键字出现在类和类对象之外</td></tr><tr><td>no-iterator</td><td>禁用  <code>__iterator__</code>  属性</td></tr><tr><td>no-labels</td><td>禁用标签语句</td></tr><tr><td>no-lone-blocks</td><td>禁用不必要的嵌套块</td></tr><tr><td>no-loop-func</td><td>禁止在循环中出现  <code>function</code>  声明和表达式</td></tr><tr><td>no-magic-numbers</td><td>禁用魔术数字</td></tr><tr><td>no-multi-spaces</td><td>禁止使用多个空格</td></tr><tr><td>no-multi-str</td><td>禁止使用多行字符串</td></tr><tr><td>no-new</td><td>禁止使用  <code>new</code>  以避免产生副作用</td></tr><tr><td>no-new-func</td><td>禁止对  <code>Function</code>  对象使用  <code>new</code>  操作符</td></tr><tr><td>no-new-wrappers</td><td>禁止对  <code>String</code>，<code>Number</code>  和  <code>Boolean</code>  使用  <code>new</code>  操作符</td></tr><tr><td>no-octal</td><td>禁用八进制字面量</td></tr><tr><td>no-octal-escape</td><td>禁止在字符串中使用八进制转义序列</td></tr><tr><td>no-param-reassign</td><td>禁止对  <code>function</code>  的参数进行重新赋值</td></tr><tr><td>no-proto</td><td>禁用  <code>__proto__</code>  属性</td></tr><tr><td>no-redeclare</td><td>禁止多次声明同一变量</td></tr><tr><td>no-restricted-properties</td><td>禁止使用对象的某些属性</td></tr><tr><td>no-return-assign</td><td>禁止在  <code>return</code>  语句中使用赋值语句</td></tr><tr><td>no-return-await</td><td>禁用不必要的  <code>return await</code></td></tr><tr><td>no-script-url</td><td>禁止使用  <code>javascript:</code> url</td></tr><tr><td>no-self-assign</td><td>禁止自我赋值</td></tr><tr><td>no-self-compare</td><td>禁止自身比较</td></tr><tr><td>no-sequences</td><td>禁用逗号操作符</td></tr><tr><td>no-throw-literal</td><td>禁止抛出异常字面量</td></tr><tr><td>no-unmodified-loop-condition</td><td>禁用一成不变的循环条件</td></tr><tr><td>no-unused-expressions</td><td>禁止出现未使用过的表达式</td></tr><tr><td>no-unused-labels</td><td>禁用出现未使用过的标</td></tr><tr><td>no-useless-call</td><td>禁止不必要的  <code>.call()</code>  和  <code>.apply()</code></td></tr><tr><td>no-useless-escape</td><td>禁用不必要的转义字符</td></tr><tr><td>no-useless-return</td><td>禁止多余的 return 语句</td></tr><tr><td>no-void</td><td>禁用  <code>void</code>  操作符</td></tr><tr><td>no-warning-comments</td><td>禁止在注释中使用特定的警告术语</td></tr><tr><td>no-with</td><td>禁用  <code>with</code>  语句</td></tr><tr><td>prefer-promise-reject-errors</td><td>要求使用 Error 对象作为 Promise 拒绝的原因</td></tr><tr><td>radix</td><td>强制在<code>parseInt()</code>使用基数参数</td></tr><tr><td>require-await</td><td>禁止使用不带  <code>await</code>  表达式的 async 函数</td></tr><tr><td>vars-on-top</td><td>要求所有的  <code>var</code>  声明出现在它们所在的作用域顶部</td></tr><tr><td>wrap-iife</td><td>要求 IIFE 使用括号括起来</td></tr><tr><td>yoda</td><td>要求或禁止 “Yoda” 条件</td></tr><tr><td>strict</td><td>要求或禁止使用严格模式指令</td></tr></tbody></table><p>变量声明有关的规则：</p><table><thead><tr><th>规则</th><th>解释</th></tr></thead><tbody><tr><td>init-declarations</td><td>要求或禁止  <code>var</code>  声明中的初始化</td></tr><tr><td>no-catch-shadow</td><td>禁止  <code>catch</code>  子句的参数与外层作用域中的变量同名</td></tr><tr><td>no-delete-var</td><td>禁止删除变量</td></tr><tr><td>no-label-var</td><td>不允许标签与变量同名</td></tr><tr><td>no-restricted-globals</td><td>禁用特定的全局变量</td></tr><tr><td>no-shadow</td><td>禁止变量声明与外层作用域的变量同名</td></tr><tr><td>no-shadow-restricted-names</td><td>禁止将标识符定义为受限的名字</td></tr><tr><td>no-undef</td><td>禁用未声明的变量，除非它们在  <code>/*global */</code>  注释中被提到</td></tr><tr><td>no-undef-init</td><td>禁止将变量初始化为  <code>undefined</code></td></tr><tr><td>no-undefined</td><td>禁止将  <code>undefined</code>  作为标识符</td></tr><tr><td>no-unused-vars</td><td>禁止出现未使用过的变量</td></tr><tr><td>no-use-before-define</td><td>禁止在变量定义之前使用它们</td></tr></tbody></table><p>关于 Node.js 规则的</p><table><thead><tr><th>规则</th><th>解释</th></tr></thead><tbody><tr><td>callback-return</td><td>强制数组方法回调函数中有 return 语句</td></tr><tr><td>global-require</td><td>要求<code>require()</code>出现在顶层模块作用域中</td></tr><tr><td>handle-callback-err</td><td>要求回调函数中有错误处理</td></tr><tr><td>no-buffer-constructor</td><td>禁用 <code>Buffer()</code> 构造函数</td></tr><tr><td>no-mixed-requires</td><td>禁止混合常规变量声明和<code>require</code>调用</td></tr><tr><td>no-new-require</td><td>禁止调用<code>require</code> 时 使用 <code>new</code> 操作符</td></tr><tr><td>no-path-concat</td><td>禁止对  <code>__dirname</code>  和  <code>__filename</code>  进行字符串连接</td></tr><tr><td>no-process-env</td><td>禁用  <code>process.env</code></td></tr><tr><td>no-process-exit</td><td>禁用  <code>process.exit()</code></td></tr><tr><td>no-restricted-modules</td><td>禁用通过  <code>require</code>  加载的指定模块</td></tr><tr><td>no-sync</td><td>禁用同步方法</td></tr></tbody></table><p>关于代码编写风格的：</p><table><thead><tr><th>规则</th><th>解释</th></tr></thead><tbody><tr><td>array-bracket-newline</td><td>在数组开括号后和闭括号前强制换行</td></tr><tr><td>array-bracket-spacing</td><td>强制数组方括号中使用一致的空格</td></tr><tr><td>array-element-newline</td><td>强制数组元素间出现换行</td></tr><tr><td>block-spacing</td><td>禁止或强制在代码块中开括号前和闭括号后有空格</td></tr><tr><td>brace-style</td><td>强制在代码块中使用一致的大括号风格</td></tr><tr><td>camelcase</td><td>强制使用骆驼拼写法命名约定</td></tr><tr><td>capitalized-comments</td><td>强制或禁止对注释的第一个字母大写</td></tr><tr><td>comma-dangle</td><td>要求或禁止末尾有逗号</td></tr><tr><td>comma-spacing</td><td>强制在逗号前后使用一致的空格</td></tr><tr><td>comma-style</td><td>强制使用一致的逗号风格</td></tr><tr><td>computed-property-spacing</td><td>强制在计算的属性的方括号中使用一致的空格</td></tr><tr><td>consistent-this</td><td>当获取当前执行环境的上下文时，强制使用一致的命名</td></tr><tr><td>eol-last</td><td>要求或禁止文件末尾存在空行</td></tr><tr><td>func-call-sapcing</td><td>要求或禁止在函数标识符和其调用之间有空格</td></tr><tr><td>func-names</td><td>要求或禁止使用命名的  <code>function</code>  表达式</td></tr><tr><td>func-name-matching</td><td>要求函数名与赋值给它们的变量名或属性名相匹配</td></tr><tr><td>func-style</td><td>强制一致地使用  <code>function</code>  声明或表达式</td></tr><tr><td>function-paren-newline</td><td>强制在函数括号内使用一致的换行</td></tr><tr><td>id-blacklist</td><td>禁用指定的标识符</td></tr><tr><td>id-length</td><td>强制标识符的最小和最大长度</td></tr><tr><td>id-match</td><td>要求标识符匹配一个指定的正则表达式</td></tr><tr><td>implicit-arrow-linebreak</td><td>强制隐式返回的箭头函数体的位置</td></tr><tr><td>indent</td><td>强制使用一致的缩进</td></tr><tr><td>jsx-quotes</td><td>强制在 JSX 属性中一致地使用双引号或单引号</td></tr><tr><td>key-spacing</td><td>强制在对象字面量的属性中键和值之间使用一致的间距</td></tr><tr><td>keyword-spacing</td><td>强制在关键字前后使用一致的空格</td></tr><tr><td>line-comment-position</td><td>强制行注释的位置</td></tr><tr><td>linebreak-style</td><td>强制使用一致的换行风格</td></tr><tr><td>lines-around-comment</td><td>要求在注释周围有空行</td></tr><tr><td>lines-between-class-members</td><td>要求或禁止类成员之间出现空行</td></tr><tr><td>max-depth</td><td>强制可嵌套的块的最大深度</td></tr><tr><td>max-len</td><td>强制一行的最大长度</td></tr><tr><td>max-lines</td><td>强制最大行数</td></tr><tr><td>max-nested-callbacks</td><td>强制回调函数最大嵌套深度</td></tr><tr><td>max-params</td><td>强制函数定义中最多允许的参数数量</td></tr><tr><td>max-statements</td><td>强制函数块最多允许的的语句数量</td></tr><tr><td>max-statements-per-line</td><td>强制每一行中所允许的最大语句数量</td></tr><tr><td>multiline-comment-style</td><td>强制对多行注释使用特定风格</td></tr><tr><td>multiline-ternary</td><td>要求或禁止在三元操作数中间换行</td></tr><tr><td>new-cap</td><td>要求构造函数首字母大写</td></tr><tr><td>new-parens</td><td>要求调用无参构造函数时有圆括号</td></tr><tr><td>newline-per-cahined-call</td><td>要求方法链中每个调用都有一个换行符</td></tr><tr><td>no-array-constructor</td><td>禁用  <code>Array</code>  构造函数</td></tr><tr><td>no-bitwise</td><td>禁用按位运算符</td></tr><tr><td>no-continue</td><td>禁用  <code>continue</code>  语句</td></tr><tr><td>no-inline-comments</td><td>禁止在代码后使用内联注释</td></tr><tr><td>no-lonely-if</td><td>禁止  <code>if</code>  作为唯一的语句出现在  <code>else</code>  语句中</td></tr><tr><td>no-mixed-operators</td><td>禁止混合使用不同的操作符</td></tr><tr><td>no-mixed-spaces-and-tabs</td><td>禁止空格和 tab 的混合缩进</td></tr><tr><td>no-multi-assign</td><td>禁止连续赋值</td></tr><tr><td>no-multiple-empty-lines</td><td>禁止出现多行空行</td></tr><tr><td>no-negated-condition</td><td>禁用否定的表达式</td></tr><tr><td>no-nested-ternary</td><td>禁用嵌套的三元表达式</td></tr><tr><td>no-new-object</td><td>禁用 Object 的构造函数</td></tr><tr><td>no-plusplus</td><td>禁用一元操作符 ++ 和 –</td></tr><tr><td>no-restricted-syntax</td><td>禁用特定的语法</td></tr><tr><td>no-tabs</td><td>禁用 tab</td></tr><tr><td>no-ternary</td><td>禁用三元操作符</td></tr><tr><td>no-trailing-spaces</td><td>禁用行尾空格</td></tr><tr><td>no-underscore-dangle</td><td>禁止标识符中有悬空下划线</td></tr><tr><td>no-unneeded-ternary</td><td>禁止可以在有更简单的可替代的表达式时使用三元操作符</td></tr><tr><td>no-whitespace-before-property</td><td>禁止属性前有空白</td></tr><tr><td>nonblock-statement-body-position</td><td>强制单个语句的位置</td></tr><tr><td>object-curly-newline</td><td>强制大括号内换行符的一致性</td></tr><tr><td>object-curly-spacing</td><td>强制在大括号中使用一致的空格</td></tr><tr><td>object-property-newline</td><td>强制将对象的属性放在不同的行上</td></tr><tr><td>one-var</td><td>强制函数中的变量要么一起声明要么分开声明</td></tr><tr><td>one-var-declaration-per-line</td><td>要求或禁止在变量声明周围换行</td></tr><tr><td>operator-assignment</td><td>要求或禁止在可能的情况下使用简化的赋值操作符</td></tr><tr><td>operator-linebreak</td><td>强制操作符使用一致的换行符</td></tr><tr><td>padded-blocks</td><td>要求或禁止块内填充</td></tr><tr><td>padding-line-between-statements</td><td>要求或禁止在语句间填充空行</td></tr><tr><td>quote-props</td><td>要求或禁止在语句间填充空行</td></tr><tr><td>quotes</td><td>强制使用一致的反勾号、双引号或单引号</td></tr><tr><td>require-jsdoc</td><td>要求使用 JSDoc 注释</td></tr><tr><td>semi</td><td>要求或禁止使用分号代替 ASI</td></tr><tr><td>semi-spacing</td><td>强制分号之前和之后使用一致的空格</td></tr><tr><td>semi-style</td><td>强制分号的位置</td></tr><tr><td>sort-keys</td><td>要求对象属性按序排列</td></tr><tr><td>sort-vars</td><td>要求同一个声明块中的变量按顺序排列</td></tr><tr><td>space-before-blocks</td><td>强制在块之前使用一致的空格</td></tr><tr><td>space-before-function-paren</td><td>强制在 function 的左括号之前使用一致的空格</td></tr><tr><td>space-in-parens</td><td>强制在圆括号内使用一致的空格</td></tr><tr><td>space-infix-ops</td><td>要求操作符周围有空格</td></tr><tr><td>space-unary-ops</td><td>强制在一元操作符前后使用一致的空格</td></tr><tr><td>spaced-comment</td><td>强制在注释中 // 或 /* 使用一致的空格</td></tr><tr><td>switch-colon-spacing</td><td>强制在 switch 的冒号左右有空格</td></tr><tr><td>template-tag-spacing</td><td>要求或禁止在模板标记和它们的字面量之间有空格</td></tr><tr><td>unicode-bom</td><td>要求或禁止 Unicode 字节顺序标记 (BOM)</td></tr><tr><td>wrap-regex</td><td>要求正则表达式被括号括起来</td></tr></tbody></table><p>ES6 规则：</p><table><thead><tr><th>规则</th><th>解释</th></tr></thead><tbody><tr><td>arrow-body-style</td><td>要求箭头函数体使用大括号</td></tr><tr><td>arrow-parens</td><td>要求箭头函数的参数使用圆括号</td></tr><tr><td>arrow-spacing</td><td>强制箭头函数的箭头前后使用一致的空格</td></tr><tr><td>constructor-super</td><td>要求在构造函数中有 super() 的调用</td></tr><tr><td>generator-star-spacing</td><td>强制 generator 函数中 * 号周围使用一致的空格</td></tr><tr><td>no-class-assign</td><td>禁止修改类声明的变量</td></tr><tr><td>no-confusing-arrow</td><td>禁止在可能与比较操作符相混淆的地方使用箭头函数</td></tr><tr><td>no-const-assign</td><td>禁止修改 const 声明的变量</td></tr><tr><td>no-dupe-class-members</td><td>禁止类成员中出现重复的名称</td></tr><tr><td>no-duplicate-imports</td><td>禁止重复模块导入</td></tr><tr><td>no-new-symbol</td><td>禁止 Symbolnew 操作符和 new 一起使用</td></tr><tr><td>no-restricted-imports</td><td>禁止使用指定的 import 加载的模块</td></tr><tr><td>no-this-before-super</td><td>禁止在构造函数中，在调用 super() 之前使用 this 或 super</td></tr><tr><td>no-useless-computed-key</td><td>禁止在对象中使用不必要的计算属性</td></tr><tr><td>no-useless-constructor</td><td>禁用不必要的构造函数</td></tr><tr><td>no-useless-rename</td><td>禁止在 import 和 export 和解构赋值时将引用重命名为相同的名字</td></tr><tr><td>no-var</td><td>要求使用 let 或 const 而不是 var</td></tr><tr><td>object-shorthand</td><td>要求或禁止对象字面量中方法和属性使用简写语法</td></tr><tr><td>prefer-arrow-callback</td><td>要求回调函数使用箭头函数</td></tr><tr><td>prefer-const</td><td>要求使用 const 声明那些声明后不再被修改的变量</td></tr><tr><td>prefer-destructuring</td><td>优先使用数组和对象解构</td></tr><tr><td>prefer-numeric-literals</td><td>禁用 parseInt() 和 Number.parseInt()，使用二进制，八进制和十六进制字面量</td></tr><tr><td>prefer-rest-params</td><td>要求使用剩余参数而不是 arguments</td></tr><tr><td>prefer-spread</td><td>要求使用扩展运算符而非 .apply()</td></tr><tr><td>prefer-template</td><td>要求使用模板字面量而非字符串连接</td></tr><tr><td>require-yield</td><td>要求 generator 函数内有 yield</td></tr><tr><td>rest-spread-spacing</td><td>强制剩余和扩展运算符及其表达式之间有空格</td></tr><tr><td>sort-imports</td><td>强制模块内的 import 排序</td></tr><tr><td>symbol-description</td><td>要求 symbol 描述</td></tr><tr><td>template-curly-spacing</td><td>要求或禁止模板字符串中的嵌入表达式周围空格的使用</td></tr><tr><td>yield-star-spacing</td><td>强制在 yield<em> 表达式中 </em> 周围使用空格</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;eslint 可以帮助进行我们检查代码，使我们的代码写的整洁，高效，在这里总结一篇关于 eslint 配置的一些事项，一些规则持续更新。&lt;/p&gt;
&lt;p&gt;eslint 的配置文件放在根目录中，新建&lt;code&gt;.eslintrc.js&lt;/code&gt;文件，然后开始配置，一般常见的配置如下:&lt;/p&gt;
    
    </summary>
    
      <category term="webpack" scheme="http://www.tiankai.party/categories/webpack/"/>
    
    
      <category term="eslint" scheme="http://www.tiankai.party/tags/eslint/"/>
    
      <category term="webpack" scheme="http://www.tiankai.party/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>react16 生命周期</title>
    <link href="http://www.tiankai.party/posts/5777/"/>
    <id>http://www.tiankai.party/posts/5777/</id>
    <published>2018-08-14T07:34:00.000Z</published>
    <updated>2019-01-02T03:38:35.480Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>react16 移除的生命周期</p><a id="more"></a><ul><li><p>componentWillMount</p></li><li><p>componentWillReceiveProps</p></li><li><p>componentWillUpdate</p></li></ul><p>react16 新的生命周期</p><ul><li><p>getDerivedStateFromProps</p></li><li><p>getSnapshotBeforeUpdate</p></li></ul><p>整体生命周期流程图：<br><img src="/../images/react16.png" alt="react16"></p><p>完整的生命周期流程（按顺序）</p><h3>组件进入挂载阶段（Mounting）</h3><p>调用的函数顺序</p><ul><li>constructor</li><li>getDerivedStateFromProps</li><li>render</li><li>componentDidMount</li></ul><blockquote><p>constructor</p></blockquote><p>组件的构造函数可以在这里进行 state 初始化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      isLoading: <span class="literal">false</span>,</span><br><span class="line">      goods: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>getDerivedStateFromProps</p></blockquote><p><code>static getDerivedStateFromProps(nextProps, prevState)</code></p><p>构造函数初始化后进入该生命周期，取代原先的 <code>componentWillReceiveProps</code></p><ul><li>不能在该函数中使用 <code>this</code></li><li>接收新的<code>props</code>，然后决定是否更新 旧的 <code>state</code></li><li>函数会返回一个对象用来更新当前的<code>state</code>状态，如果不需要可以返回 <code>null</code></li></ul><p>调用时机：</p><ul><li>组件挂载时</li><li>接收到新的 props 时</li><li>调用了 setState 和 forceUpdate 时</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      isLoading: <span class="literal">true</span>,</span><br><span class="line">      goods: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> getDerivedStateFromProps(nextProps, prevState) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextProps.goods !== prevState.goods) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        isLoading: <span class="literal">false</span>,</span><br><span class="line">        goods: nextProps.goods</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>render</p></blockquote><p>render 方法 返回组件要渲染的东西</p><blockquote><p>componentDidMount</p></blockquote><p>组件装载后调用，可以在这里请求数据，操作 DOM 节点。</p><h3 id="更新阶段（Update）"><a href="#更新阶段（Update）" class="headerlink" title="更新阶段（Update）"></a>更新阶段（Update）</h3><p><code>更新阶段生命周期函数调用：</code></p><ul><li>getDerivedStateFromProps</li><li>shouldComponentUpdate</li><li>render</li><li>getSnapshotBeforeUpdate</li><li>componentDidUpdate</li></ul><blockquote><p>getDerivedStateFromProps</p></blockquote><p><code>static getDerivedStateFromProps(nextProps, prevState)</code><br>当组件的 props 改变，或者组件内部调用了 setState 或者 forceUpdate 会发生</p><blockquote><p>shouldComponentUpdate</p></blockquote><p><code>shouldComponentUpdate(nextProps, nextState)</code></p><p>在组件 触发 render 之前都会调用这个函数 返回一个布尔值，如果返回 true 组件触发 render 渲染，返回 false 组件不触发 render 函数，默认返回 true，所以我们需要在函数中 比较 <code>this.props</code> 和 <code>nextProps</code> 以及 <code>this.state</code> 和 <code>nextState</code> 来决定是否需要 触发 render 函数渲染</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      isLoading: <span class="literal">true</span>,</span><br><span class="line">      goods: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  shouldComponentUpdate(nextProps, nextState) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.goods.length !== nextState.goods.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>官方推荐的是组件继承 <code>PureComponent</code> 来减少组件重复渲染的次数，而不是开发者自己手工书写。<code>PureComponent</code> 是官方提供的，在内部对 props 和 state 进行了 一层浅比较</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleComponent</span> <span class="keyword">extends</span> <span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      isLoading: <span class="literal">true</span>,</span><br><span class="line">      goods: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>render</p></blockquote><p>根据 <code>shouldComponentUpdate</code> 返回的值 是否觉得需要调用 render 渲染</p><blockquote><p>getSnapshotBeforeUpdate</p></blockquote><p><code>getSnapshotBeforeUpdate(prevProps, prevState)</code></p><p>这个方法在 render 之后，<code>componentDidUpdate</code> 之前调用，有两个参数 prevProps 和 prevState，表示之前的属性和之前的 state，这个函数有一个返回值，会作为第三个参数传给 <code>componentDidUpdate</code>，如果你不想要返回值，请返回 null，不写的话控制台会有警告</p><p>还有这个方法一定要和 <code>componentDidUpdate</code> 一起使用，否则控制台也会有警告</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleComponent</span> <span class="keyword">extends</span> <span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      messages: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.handleMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.interval = <span class="built_in">window</span>.setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.state.messages.length &gt; <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.clearInterval(<span class="keyword">this</span>.interval);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.handleMessage();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  getSnapshotBeforeUpdate(prevProps, prevState) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.rootNode.scrollHeight;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps, prevState, snapshot) &#123;</span><br><span class="line">    <span class="keyword">const</span> scrollTop = <span class="keyword">this</span>.rootNode.scrollTop;</span><br><span class="line">    <span class="keyword">if</span> (scrollTop &lt; <span class="number">5</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">this</span>.rootNode.scrollTop =</span><br><span class="line">      scrollTop + (<span class="keyword">this</span>.rootNode.scrollHeight - snapshot);</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillUnMount() &#123;</span><br><span class="line">    windows.clearInterval(<span class="keyword">this</span>.interval);</span><br><span class="line">  &#125;</span><br><span class="line">  handleMessage() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function"><span class="params">prev</span> =&gt;</span> (&#123;</span><br><span class="line">      message: [<span class="string">`msg <span class="subst">$&#123;prev.messages.length&#125;</span>`</span>, ...prev.messages]</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div ref=&#123;n =&gt; (<span class="keyword">this</span>.listRef = n)&#125;&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.message.map(<span class="function">(<span class="params">msg, idx</span>) =&gt;</span> (</span><br><span class="line">          &lt;div key=&#123;idx&#125;&gt;&#123;msg&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        ))&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>componentDidUpdate</p></blockquote><p><code>componentDidUpdate(prevProps, prevState, snapshot)</code></p><p>该方法在<code>getSnapshotBeforeUpdate</code>方法之后被调用，有三个参数<code>prevProps</code>，<code>prevState</code>，<code>snapshot</code>，表示之前的 props，之前的 state，和 snapshot。第三个参数是<code>getSnapshotBeforeUpdate</code>返回的，在这个函数里我们可以操作 DOM，和发起服务器请求，还可以<code>setState</code>，但是注意一定要用 if 语句控制，否则会导致无限循环</p><h3 id="卸载阶段（UnMount）"><a href="#卸载阶段（UnMount）" class="headerlink" title="卸载阶段（UnMount）"></a>卸载阶段（UnMount）</h3><p>组件卸载的时候只有一个生命周期函数</p><blockquote><p>componentWillUnmount</p></blockquote><p>当我们的组件被卸载或者销毁了就会调用，我们可以在这个函数里去清除一些定时器，取消网络请求，清理无效的 DOM 元素等垃圾清理工作</p><p>注意不要在这个函数里去调用 setState，因为组件不会重新渲染了</p><h3 id="错误收集"><a href="#错误收集" class="headerlink" title="错误收集"></a>错误收集</h3><p>在 react16 之前，如果代码报错时候，会直接出现红屏，react16 之后可以直接使用这个函数来收集错误设置错误显示时的<code>state</code>，这样在界面上就不会出现红屏,但是这里有个问题，就是在捕获到错误的瞬间，React 会在这次渲染周期中将这个组件渲染为<code>null</code></p><blockquote><p>componentDidCatch</p></blockquote><p>`componentDidCatch(error, info)</p><blockquote><p>getDerivedStateFromError</p></blockquote><p>为解决上述问题，react 在 16.6 版本新增了一个生命周期函数<br>这个方法跟<code>getDerivedStateFromProps</code>类似，唯一的区别是他只有在出现错误的时候才触发，他相对于<code>componentDidCatch</code>的优势是在当前的渲染周期中就可以修改<code>state</code>，以在当前渲染就可以出现错误的 UI，而不需要一个 null 的中间态。<br>而这个方法的出现，也意味着以后出现错误的时候，修改<code>state</code>展现错误时界面的状态应该放在这里去做，而后续收集错误信息之类的放到<code>componentDidCatch</code>里面。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;react16 移除的生命周期&lt;/p&gt;
    
    </summary>
    
      <category term="react" scheme="http://www.tiankai.party/categories/react/"/>
    
    
      <category term="react" scheme="http://www.tiankai.party/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>react-redux脚手架搭建问题总结</title>
    <link href="http://www.tiankai.party/posts/34080/"/>
    <id>http://www.tiankai.party/posts/34080/</id>
    <published>2018-07-23T08:27:00.000Z</published>
    <updated>2019-01-02T03:56:11.663Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>先列举功能点：</p><ol><li>react 热更新 react-hot-loader</li><li>css 提取</li><li>webpack4 的 splitcommonchunk</li><li>react-router-dom 和 redux 整合</li><li>redux-saga</li><li>react-router 动态配置 react-loadable</li><li>react-router-config 静态路由</li><li>sass/less</li><li>重复渲染问题处理</li><li>webpack 打包第三方库</li></ol><a id="more"></a><h5 id="babel-配置"><a href="#babel-配置" class="headerlink" title="babel 配置"></a>babel 配置</h5><figure class="highlight javascript"><figcaption><span>.babelrc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>:[</span><br><span class="line">  <span class="string">"react"</span>,</span><br><span class="line">  [<span class="string">"env"</span>, &#123;</span><br><span class="line">  <span class="string">"targets"</span>: &#123;</span><br><span class="line">    <span class="string">"browsers"</span>: [<span class="string">"last 2 versions"</span>, <span class="string">"safari &gt;= 7"</span>],</span><br><span class="line">    <span class="string">"node"</span>: <span class="string">"current"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"modules"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"debug"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"include"</span>: [</span><br><span class="line">    <span class="string">"transform-es2015-arrow-functions"</span>, <span class="comment">//箭头函数</span></span><br><span class="line">    <span class="string">"transform-es2015-spread"</span> <span class="comment">//扩展运算符</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"exclude"</span>: [],</span><br><span class="line">  <span class="string">"useBuiltIns"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;]</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>:[</span><br><span class="line">  [<span class="string">"transform-runtime"</span>, &#123;</span><br><span class="line">    <span class="string">"helpers"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"polyfill"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"regenerator"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"moduleName"</span>: <span class="string">"babel-runtime"</span></span><br><span class="line">  &#125;],</span><br><span class="line">  [<span class="string">"transform-object-rest-spread"</span>, &#123;<span class="string">"useBuiltIns"</span>: <span class="literal">true</span>&#125;],</span><br><span class="line">  <span class="string">"syntax-dynamic-import"</span> <span class="comment">// import() 函数</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="resolve-配置"><a href="#resolve-配置" class="headerlink" title="resolve 配置"></a>resolve 配置</h5><p>在文件中可以直接使用 <code>src</code> 关键字 来引入文件</p><figure class="highlight javascript"><figcaption><span>webpack.common.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">  alias: &#123;</span><br><span class="line">      <span class="keyword">static</span>: Path(<span class="string">'../static'</span>),</span><br><span class="line">      src: Path(<span class="string">'../src'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Path</code>是自己封装的</p><figure class="highlight javascript"><figcaption><span>webpack.common.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Path = <span class="function">(<span class="params">filePath</span>) =&gt;</span> path.join(path.resolve(\_\_dirname,filePath));</span><br></pre></td></tr></table></figure><h5 id="react-hot-loader"><a href="#react-hot-loader" class="headerlink" title="react-hot-loader"></a>react-hot-loader</h5><p>热更新使用的是 <code>react-hot-loader</code> 这个插件，可以在不刷新 state 的时候，刷新页面<br>入口文件配置：</p><figure class="highlight javascript"><figcaption><span>webpack.dev.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">    index: [</span><br><span class="line">        <span class="string">`webpack-dev-server/client?http://localhost:<span class="subst">$&#123;AppPort&#125;</span>`</span>,</span><br><span class="line">        <span class="string">'webpack/hot/only-dev-server'</span>,</span><br><span class="line">        <span class="string">'react-hot-loader/patch'</span>,</span><br><span class="line">        <span class="string">'babel-polyfill'</span>,</span><br><span class="line">        Path(<span class="string">'../src/main.js'</span>)</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><code>transform-runtime</code> 只会对 es6 的语法进行转换，而不会对新 api(Set、Maps 等)进行转换。如果需要转换新 api，就要引入<code>babel-polyfill</code></p><h5 id="为什么需要引入-babel-runtime"><a href="#为什么需要引入-babel-runtime" class="headerlink" title="为什么需要引入 babel-runtime ?"></a>为什么需要引入 babel-runtime ?</h5><p><code>babel-polyfill</code> 通过帮助函数(helper) 实现 es6 功能后，会重复出现在一些模块里，导致编译后的代码体积变大。Babel 为了解决这个问题，提供了单独的包 <code>babel-runtime</code> 供编译模块复用工具函数。这时候就需要使用 <code>transform-runtime</code>：启用 <code>babel-runtime</code>，以避免编译输出的重复问题</p><h6 id="热更新还需俩个插件"><a href="#热更新还需俩个插件" class="headerlink" title="热更新还需俩个插件"></a>热更新还需俩个插件</h6><figure class="highlight javascript"><figcaption><span>webpack.dev.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 显示 模块的 相对路径</span></span><br><span class="line"><span class="keyword">new</span> webpack.NamedModulesPlugin(),</span><br><span class="line"><span class="comment">// 浏览器 刷新</span></span><br><span class="line"><span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br></pre></td></tr></table></figure><h5 id="代码分割配置"><a href="#代码分割配置" class="headerlink" title="代码分割配置"></a>代码分割配置</h5><figure class="highlight javascript"><figcaption><span>webpack.dev.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">  minimize: <span class="literal">false</span>,</span><br><span class="line">  runtimeChunk: <span class="literal">true</span>,</span><br><span class="line">  mergeDuplicateChunks: <span class="literal">true</span>,</span><br><span class="line">  removeEmptyChunks: <span class="literal">true</span>,</span><br><span class="line">  splitChunks: &#123;</span><br><span class="line">    chunks: <span class="string">'async'</span>,</span><br><span class="line">    cacheGroups: &#123;</span><br><span class="line">      commons: &#123;</span><br><span class="line">          test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">          name: <span class="string">"vendor"</span>,</span><br><span class="line">          chunks: <span class="string">"all"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个暂定这个配置，后期优化后，会更新上来</p><h5 id="HthmlWebpackPlugin"><a href="#HthmlWebpackPlugin" class="headerlink" title="HthmlWebpackPlugin"></a>HthmlWebpackPlugin</h5><p>插入 js 使用 assetHtmlPlugin</p><figure class="highlight javascript"><figcaption><span>webpack.dev.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  title: <span class="string">'React-Redux-App'</span>,</span><br><span class="line">  inject: <span class="literal">true</span>,</span><br><span class="line">  template: Path(<span class="string">'../static/tpl.html'</span>),</span><br><span class="line">  chunksSortMode: <span class="string">'none'</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="keyword">new</span> AddAssetHtmlPlugin([</span><br><span class="line">  &#123;</span><br><span class="line">    filepath: Path(<span class="string">'../static/js/vendors_lib.js'</span>),</span><br><span class="line">    includeSourcemap: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    filepath: Path(<span class="string">'../build/\*.js'</span>),</span><br><span class="line">    includeSourcemap: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">]),</span><br></pre></td></tr></table></figure><h5 id="webpack-dll-config-js"><a href="#webpack-dll-config-js" class="headerlink" title="webpack.dll.config.js"></a>webpack.dll.config.js</h5><p>打包第三方公共的库</p><p>webpack.dev.js</p><figure class="highlight javascript"><figcaption><span>webpack.dev.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- tab js --&gt;</span><br><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">      context: __dirname,</span><br><span class="line">      manifest: <span class="built_in">require</span>(path.resolve(__dirname, <span class="string">'../static/vendors-manifest.json'</span>))</span><br><span class="line">  &#125;),</span><br><span class="line">&lt;!-- endtab --&gt;</span><br></pre></td></tr></table></figure><p>webpack.dll.config.js</p><figure class="highlight javascript"><figcaption><span>webpack.dll.config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">  vendors: [</span><br><span class="line">    <span class="string">'react'</span>,</span><br><span class="line">    <span class="string">'react-dom'</span>,</span><br><span class="line">    <span class="string">'react-router-dom'</span>,</span><br><span class="line">    <span class="string">'redux'</span>,</span><br><span class="line">    <span class="string">'react-redux'</span></span><br><span class="line">  ]</span><br><span class="line">  &#125;,</span><br><span class="line">  output:&#123;</span><br><span class="line">    filename: <span class="string">'[name]\_lib.js'</span>,</span><br><span class="line">    path: path.resolve(**dirname, <span class="string">'../static/js'</span>),</span><br><span class="line">    library: <span class="string">'[name]\_lib'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      context: **dirname,</span><br><span class="line">      path: path.resolve(\_\_dirname,<span class="string">'../static/[name]-manifest.json'</span>),</span><br><span class="line">      name: <span class="string">'[name]\_lib'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> UglifyJsPlugin(&#123;</span><br><span class="line">      parallel: <span class="literal">true</span>,</span><br><span class="line">      sourceMap: <span class="literal">true</span>,</span><br><span class="line">      uglifyOptions: &#123;</span><br><span class="line">        warnings: <span class="literal">false</span>,</span><br><span class="line">        output: &#123;</span><br><span class="line">          comments: <span class="literal">false</span>,</span><br><span class="line">          beautify: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        compress: &#123;</span><br><span class="line">          warnings: <span class="literal">false</span>,</span><br><span class="line">          drop_console: <span class="literal">true</span>,</span><br><span class="line">          collapse_vars: <span class="literal">true</span>,</span><br><span class="line">          reduce_vars: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  mode: <span class="string">'development'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>项目开始前 要先 运行一下 <code>webpack.dll.config.js</code></p><h5 id="生产配置"><a href="#生产配置" class="headerlink" title="生产配置"></a>生产配置</h5><p>css 压缩:<br>loaders</p><figure class="highlight javascript"><figcaption><span>webpack.pro.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            MiniCssExtractPlugin.loader,</span><br><span class="line">            <span class="string">'css-loader'</span>,</span><br><span class="line">            <span class="string">'postcss-loader'</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    test: <span class="regexp">/\.scss$/i</span>,</span><br><span class="line">    use: [</span><br><span class="line">      MiniCssExtractPlugin.loader,</span><br><span class="line">      <span class="string">'css-loader'</span>,</span><br><span class="line">      <span class="string">'postcss-loader'</span>,</span><br><span class="line">      <span class="string">'sass-loader'</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">    use: [</span><br><span class="line">      MiniCssExtractPlugin.loader,</span><br><span class="line">      <span class="string">'css-loader'</span>,</span><br><span class="line">      <span class="string">'postcss-loader'</span>,</span><br><span class="line">      <span class="string">'less-loader'</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>js 压缩：<br>plugins</p><figure class="highlight javascript"><figcaption><span>webpack.pro.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> UglifyJsPlugin(&#123;</span><br><span class="line">    sourceMap: <span class="literal">true</span>,</span><br><span class="line">    test: <span class="regexp">/\.jsx?$/i</span>,</span><br><span class="line">    parallel: <span class="literal">true</span>, <span class="comment">//使用多进程并行和文件换成提高构建速度</span></span><br><span class="line">    cache: <span class="literal">true</span>,</span><br><span class="line">    uglifyOptions: &#123;</span><br><span class="line">        nameCache: <span class="literal">true</span>,</span><br><span class="line">        warnings: <span class="literal">false</span>,</span><br><span class="line">        compress: &#123;</span><br><span class="line">            warnings: <span class="literal">false</span>,  <span class="comment">//删除无用代码时不输出警告</span></span><br><span class="line">            drop_console: <span class="literal">true</span>,  <span class="comment">//删除所有console语句，可以兼容IE</span></span><br><span class="line">            collapse_vars: <span class="literal">true</span>,  <span class="comment">//内嵌已定义但只使用一次的变量</span></span><br><span class="line">            reduce_vars: <span class="literal">true</span>,  <span class="comment">//提取使用多次但没定义的静态值到变量</span></span><br><span class="line">        &#125;,</span><br><span class="line">        output: &#123;</span><br><span class="line">            beautify: <span class="literal">false</span>, <span class="comment">//最紧凑的输出，不保留空格和制表符</span></span><br><span class="line">            comments: <span class="literal">false</span>, <span class="comment">//删除所有注释</span></span><br><span class="line">        &#125;,</span><br><span class="line">        ie8: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;),</span><br><span class="line"><span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">  filename: <span class="string">"[name].css"</span>,</span><br><span class="line">  chunkFilename: <span class="string">"[id].css"</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p><a href="https://github.com/tiakia/react-redux-app" target="_blank" rel="noopener">项目链接</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;先列举功能点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;react 热更新 react-hot-loader&lt;/li&gt;
&lt;li&gt;css 提取&lt;/li&gt;
&lt;li&gt;webpack4 的 splitcommonchunk&lt;/li&gt;
&lt;li&gt;react-router-dom 和 redux 整合&lt;/li&gt;
&lt;li&gt;redux-saga&lt;/li&gt;
&lt;li&gt;react-router 动态配置 react-loadable&lt;/li&gt;
&lt;li&gt;react-router-config 静态路由&lt;/li&gt;
&lt;li&gt;sass/less&lt;/li&gt;
&lt;li&gt;重复渲染问题处理&lt;/li&gt;
&lt;li&gt;webpack 打包第三方库&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="react" scheme="http://www.tiankai.party/categories/react/"/>
    
    
      <category term="react" scheme="http://www.tiankai.party/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>谷歌云免费一年搭建梯子</title>
    <link href="http://www.tiankai.party/posts/55404/"/>
    <id>http://www.tiankai.party/posts/55404/</id>
    <published>2018-06-29T03:15:00.000Z</published>
    <updated>2019-01-02T06:10:03.917Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>谷歌云现在有活动，新注册的可以免费使用一年，之前同事使用这个搭建了一个梯子，可以访问国外的网站，我今天自己搭建了一下，遇到不少坑，在这里记录一下,有俩个先决条件</p><ul><li>信用卡</li><li>可以翻墙访问谷歌</li></ul><p>信用卡这个是谷歌必须要求的，在注册的时候就需要绑定，绑定成功会扣到 1 美元，过几天会退回来，就是验证一下信用卡是否可用。<br>翻墙这个问题可以使用蓝灯，也可以使用一个谷歌的扩展程序<code>谷歌访问助手</code>这个我在后面会给出链接，这个访问助手智能访问谷歌搜索和谷歌邮箱，其他的油管之类的就不行了。话不多说，紧接着开始教程。</p><a id="more"></a><h2 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h2><ul><li>首先注册一个谷歌账号</li><li>登录<a href="https://cloud.google.com/" target="_blank" rel="noopener">谷歌云</a></li><li>点击免费试用<br><img src="/../images/googlecloud1.png" alt="图片1"></li><li>然后就是同意谷歌服务条款</li><li>绑定信用卡号，填写个人信息,账号类型为 个人</li><li>进入页面后，点击左上角的面包屑导航</li><li><p>点击 Compute Engine - VM 实例 - 创建</p><ul><li>名称随意</li><li>地区选择 推荐 asia-east1-c 亚洲东部</li><li>机器类型选择最低的 微型</li><li>启动磁盘选择 Debian GUN/Linux 8 的操作系统</li><li>点击勾选 http 和 https</li><li><p>点击 管理、磁盘、网络、SSH 秘钥的 网络的 tab 选项卡，点击网络接口，外部 ip 选择新建一个静态 ip 名称随意，内部 ip 临时(自动) 一个地区静态 ip 只能创建一个<br><img src="/../images/googlecloud2.png" alt="图片2"></p><p><img src="/../images/googlecloud3.png" alt="图片3"></p><p><img src="/../images/googlecloud4.png" alt="图片4"></p><p><img src="/../images/googlecloud5.png" alt="图片5"></p></li></ul></li><li><p>点击创建<br><img src="/../images/googlecloud6.png" alt="图片6"></p></li><li>创建成功后，再点击 左上角 的面包屑导航</li><li><p>点击网络 VPC 网络 - 防火墙规则 - 创建防火墙规则 - 名字随意起（其他没有提及的默认） - 流量方向 入站 - 目标标记 http-server - ip 地址范围 0.0.0.0/0 - 协议和端口 全部允许 - 点击保存<br><img src="/../images/googlecloud7.png" alt="图片7"></p><p><img src="/../images/googlecloud8.png" alt="图片8"></p></li><li><p>同样的方法再新建一个，只是 目标标记 改为 https-server</p></li><li>顺带看一眼 外部 ip 是不是 静态的<br><img src="/../images/googlecloud9.png" alt="图片9"></li></ul><h2 id="安装-bbr-加速"><a href="#安装-bbr-加速" class="headerlink" title="安装 bbr 加速"></a>安装 bbr 加速</h2><ul><li>然后返回 VM 实例 - 点击 在浏览器打开 ssh - 然后 输入以下命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/FunctionClub/YankeeBBR/master/bbr.sh &amp;&amp; bash bbr.sh install</span><br><span class="line"><span class="comment"># 如果出现蓝屏 选择 NO</span></span><br><span class="line"><span class="comment">#  需要重启 输入 y，关闭 重新打开一个ssh</span></span><br><span class="line">sudo -i</span><br><span class="line">bash bbr.sh start</span><br></pre></td></tr></table></figure><h2 id="安装-shadowsocksR"><a href="#安装-shadowsocksR" class="headerlink" title="安装 shadowsocksR"></a>安装 shadowsocksR</h2><blockquote><p>推荐俩个脚本 这是第一个</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocksR.sh &amp;&amp; chmod +x shadowsocksR.sh</span><br><span class="line">./shadowsocksR.sh 2&gt;&amp;1 | tee shadowsocksR.log</span><br></pre></td></tr></table></figure><p>完成后会要求输入 密码 - 端口号 然后剩下的回车就好 这里我输入的密码是 123456 端口是 455<br><img src="/../images/googlecloud12.png" alt="图片12"><br>完成后会出现如下图<br><img src="/../images/googlecloud13.png" alt="图片13"></p><blockquote><p>推荐第二个脚本 这俩个脚本 任选一个安装即可</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://softs.fun/Bash/ssrmu.sh &amp;&amp; chmod +x ssrmu.sh &amp;&amp; bash ssrmu.sh</span><br></pre></td></tr></table></figure><p>然后按照提示操作</p><ul><li>安装脚本</li><li>设置 用户名 密码 端口号</li><li>加密方式 协议 和 混淆 推荐按下图的选择<br><img src="/../images/googlecloud14.png" alt="图片14"><br>最后完成后如下图<br><img src="/../images/googlecloud11.png" alt="图片11"></li><li>取得这个二维码的链接，粘贴到浏览器</li><li>打开客户端软件，在文末的分享链接里有</li><li><code>ShadowsocksR-dotnet4.0.exe</code> 我的是 win7 系统 ，点击这个.exe 后缀的文件</li><li>在任务栏中右键 二维码扫描 然后 就会自动 配置好 服务器的 端口号 ip 这些</li><li>然后 把其他的 服务器信息删了 只保留你自己的 服务器信息</li><li>系统代理模式 选择 全局模式</li><li>代理规则 选择 绕过局域网 和 大陆</li><li>然后 就可以 访问 被墙的网站了</li><li>注意 要把 谷歌访问助手屏蔽掉</li></ul><h2 id="客户端-windows-安装的软件"><a href="#客户端-windows-安装的软件" class="headerlink" title="客户端 windows 安装的软件"></a>客户端 windows 安装的软件</h2><p><a href="https://github.com/tiakia/-" target="_blank" rel="noopener">客户端软件和谷歌访问助手</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;谷歌云现在有活动，新注册的可以免费使用一年，之前同事使用这个搭建了一个梯子，可以访问国外的网站，我今天自己搭建了一下，遇到不少坑，在这里记录一下,有俩个先决条件&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;信用卡&lt;/li&gt;
&lt;li&gt;可以翻墙访问谷歌&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;信用卡这个是谷歌必须要求的，在注册的时候就需要绑定，绑定成功会扣到 1 美元，过几天会退回来，就是验证一下信用卡是否可用。&lt;br&gt;翻墙这个问题可以使用蓝灯，也可以使用一个谷歌的扩展程序&lt;code&gt;谷歌访问助手&lt;/code&gt;这个我在后面会给出链接，这个访问助手智能访问谷歌搜索和谷歌邮箱，其他的油管之类的就不行了。话不多说，紧接着开始教程。&lt;/p&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://www.tiankai.party/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="随笔" scheme="http://www.tiankai.party/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
</feed>
